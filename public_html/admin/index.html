<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Oregon Tires Admin Dashboard</title>
  <meta name="robots" content="noindex, nofollow">
  <link rel="icon" href="/assets/favicon.png" type="image/png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            brand: '#0D3618',
            accent: '#FFFE03',
            'brand-light': '#007030',
          }
        }
      }
    }
  </script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    .tab-active { background-color: white; color: #007030; }
    .status-new, .status-pending { background: #dbeafe; color: #1e40af; }
    .status-confirmed { background: #d1fae5; color: #065f46; }
    .status-completed { background: #f3f4f6; color: #374151; }
    .status-cancelled { background: #fee2e2; color: #991b1b; }
    .status-priority { background: #fef3c7; color: #92400e; }
    .status-read, .status-replied { background: #e0e7ff; color: #3730a3; }
    .fade-in { animation: fadeIn 0.3s ease-in; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .modal-overlay { background: rgba(0,0,0,0.5); }
    .scrollbar-thin::-webkit-scrollbar { width: 6px; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
  </style>

  <!-- Google Analytics 4 ‚Äî replace G-CHYMTNB6LH with your real Measurement ID -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CHYMTNB6LH"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-CHYMTNB6LH');
  </script>

  <!-- Basic error tracking via GA4 -->
  <script>
    window.addEventListener('error', function(e) {
      if (typeof gtag === 'function') gtag('event', 'exception', {
        description: e.message + ' at ' + (e.filename || 'unknown') + ':' + (e.lineno || 0),
        fatal: false
      });
    });
    window.addEventListener('unhandledrejection', function(e) {
      if (typeof gtag === 'function') gtag('event', 'exception', {
        description: 'Unhandled promise rejection: ' + (e.reason?.message || e.reason || 'unknown'),
        fatal: false
      });
    });
  </script>
</head>
<body class="bg-gray-100 min-h-screen dark:bg-gray-900 dark:text-gray-100">

<!-- LOGIN SCREEN -->
<div id="login-screen" class="min-h-screen flex items-center justify-center bg-brand">
  <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-md dark:bg-gray-800 dark:border-gray-700">
    <div class="text-center mb-6">
      <img src="../assets/logo.png" alt="Oregon Tires" class="h-16 mx-auto mb-4">
      <h1 class="text-2xl font-bold text-brand dark:text-green-400" data-t="adminDashboard">Admin Dashboard</h1>
      <p class="text-gray-500 mt-1 dark:text-gray-400" data-t="signInSubtitle">Sign in to manage your business</p>
    </div>
    <form id="login-form" class="space-y-4">
      <div>
        <label for="login-email" class="block text-sm font-medium text-gray-700 mb-1" data-t="emailLabel">Email</label>
        <input type="email" id="login-email" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600">
      </div>
      <div>
        <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1" data-t="passwordLabel">Password</label>
        <input type="password" id="login-password" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600">
      </div>
      <button type="submit" id="login-btn" data-t="signIn" class="w-full bg-brand text-white py-3 rounded-lg font-semibold hover:opacity-90 transition">Sign In</button>
      <div id="lockout-message" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm mb-4"></div>
      <div id="login-error" class="text-red-600 text-sm text-center hidden"></div>
    </form>
    <div class="mt-4 text-center">
      <a href="/" class="text-brand text-sm hover:underline" data-t="backToWebsite">‚Üê Back to website</a>
    </div>
  </div>
</div>

<!-- ADMIN DASHBOARD -->
<div id="admin-dashboard" class="hidden">
  <!-- Header -->
  <header class="bg-brand-light text-white shadow-lg">
    <div class="container mx-auto px-4 py-4">
      <div class="flex justify-between items-center mb-4">
        <div class="flex items-center gap-3">
          <a href="/"><img src="../assets/logo.png" alt="Oregon Tires" class="h-12"></a>
          <div>
            <h1 class="text-2xl font-bold"><span data-t="headerTitle">Admin Dashboard</span></h1>
            <p class="text-white/80 text-sm" data-t="managementSubtitle">Oregon Tires Management</p>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <div class="bg-white/10 px-3 py-2 rounded-lg text-sm cursor-pointer hover:bg-white/20 transition" onclick="openAccountSettings()">
            <div class="font-medium" id="admin-email"></div>
            <div class="text-xs text-yellow-200" id="admin-role" data-t="accountSettings">‚öôÔ∏è Account Settings</div>
          </div>
          <button id="admin-dark-toggle" onclick="toggleAdminDarkMode()" aria-label="Toggle dark mode" class="text-sm text-white hover:text-green-200 transition-colors">üåô</button>
          <button id="admin-lang-toggle" onclick="toggleAdminLanguage()" aria-label="Toggle language" class="text-sm text-white hover:text-green-200 transition-colors">EN</button>
          <a href="/" class="text-sm hover:text-yellow-200 hidden md:inline" data-t="viewSite">View Site</a>
          <button onclick="signOut()" class="bg-red-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-red-700 transition" data-t="signOut">Sign Out</button>
        </div>
      </div>
      <!-- Navigation -->
      <nav class="flex flex-wrap gap-1" id="nav-tabs">
        <button onclick="switchTab('overview')" data-tab="overview" role="tab" aria-selected="true" class="tab-btn tab-active px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition">üìä <span data-t="tabOverview">Overview</span></button>
        <button onclick="switchTab('appointments')" data-tab="appointments" role="tab" aria-selected="false" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition text-white hover:bg-green-600">üìÖ <span data-t="tabAppointments">Appointments</span></button>
        <button onclick="switchTab('messages')" data-tab="messages" role="tab" aria-selected="false" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition text-white hover:bg-green-600">üí¨ <span data-t="tabMessages">Messages</span></button>
        <button onclick="switchTab('employees')" data-tab="employees" role="tab" aria-selected="false" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition text-white hover:bg-green-600">üë• <span data-t="tabEmployees">Employees</span></button>
        <button onclick="switchTab('gallery')" data-tab="gallery" role="tab" aria-selected="false" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition text-white hover:bg-green-600">üñº <span data-t="tabGallery">Gallery</span></button>
        <button onclick="switchTab('analytics')" data-tab="analytics" role="tab" aria-selected="false" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition text-white hover:bg-green-600">üìà <span data-t="tabAnalytics">Analytics</span></button>
        <button onclick="switchTab('docs')" data-tab="docs" role="tab" aria-selected="false" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition text-white hover:bg-green-600">üìñ <span data-t="tabDocs">Docs</span></button>
      </nav>
    </div>
  </header>

  <div class="container mx-auto px-4 py-6">

    <!-- OVERVIEW TAB -->
    <div id="tab-overview" class="tab-content fade-in">
      <h2 class="text-2xl font-bold text-brand mb-6" data-t="dashboardOverview">Dashboard Overview</h2>
      <div class="grid md:grid-cols-4 gap-4 mb-8">
        <div class="bg-white rounded-xl shadow p-6 dark:bg-gray-800 dark:border-gray-700"><div class="text-sm text-gray-500" data-t="totalAppointments">Total Appointments</div><div class="text-3xl font-bold text-brand" id="stat-total">0</div><p class="text-xs text-gray-400" data-t="next14Days">Next 14 days</p></div>
        <div class="bg-white rounded-xl shadow p-6 dark:bg-gray-800 dark:border-gray-700"><div class="text-sm text-gray-500" data-t="pending">Pending</div><div class="text-3xl font-bold text-blue-600" id="stat-pending">0</div><p class="text-xs text-gray-400" data-t="awaitingConfirmation">Awaiting confirmation</p></div>
        <div class="bg-white rounded-xl shadow p-6 dark:bg-gray-800 dark:border-gray-700"><div class="text-sm text-gray-500" data-t="confirmed">Confirmed</div><div class="text-3xl font-bold text-green-600" id="stat-confirmed">0</div><p class="text-xs text-gray-400" data-t="readyToGo">Ready to go</p></div>
        <div class="bg-white rounded-xl shadow p-6 dark:bg-gray-800 dark:border-gray-700"><div class="text-sm text-gray-500" data-t="completed">Completed</div><div class="text-3xl font-bold text-gray-600" id="stat-completed">0</div><p class="text-xs text-gray-400" data-t="finished">Finished</p></div>
      </div>
      <div class="grid lg:grid-cols-2 gap-6">
        <div class="bg-white rounded-xl shadow p-6 dark:bg-gray-800"><h3 class="text-lg font-bold text-brand mb-4" data-t="upcoming14Days">Upcoming Appointments (14 Days)</h3><div id="overview-upcoming" class="space-y-3 max-h-[500px] overflow-y-auto scrollbar-thin"></div></div>
        <div class="bg-white rounded-xl shadow p-6 dark:bg-gray-800"><h3 class="text-lg font-bold text-brand mb-4" data-t="employeeSchedule">Employee Schedule</h3><div id="overview-employees" class="space-y-3 max-h-[500px] overflow-y-auto scrollbar-thin"></div></div>
      </div>
    </div>

    <!-- APPOINTMENTS TAB (combined calendar + list) -->
    <div id="tab-appointments" class="tab-content hidden fade-in">
      <div class="bg-brand-light text-white px-6 py-4 rounded-t-xl flex justify-between items-center">
        <div><h2 class="text-2xl font-bold">üìÖ <span data-t="appointmentsHeading">Appointments</span></h2><p class="text-green-100" data-t="calendarSubtitle">Calendar view with employee assignment</p></div>
        <button onclick="loadAppointments()" class="bg-white/20 text-white px-4 py-2 rounded-lg text-sm hover:bg-white/30">‚Üª Refresh</button>
      </div>
      <div class="bg-white rounded-b-xl shadow dark:bg-gray-800">
        <!-- Sub-tabs: Calendar vs List view -->
        <div class="flex gap-2 p-4 border-b">
          <button onclick="switchApptView('calendar')" id="appt-view-calendar" class="px-4 py-2 rounded-lg text-sm font-medium bg-brand text-white">üìÖ <span data-t="calendarViewBtn">Calendar View</span></button>
          <button onclick="switchApptView('list')" id="appt-view-list" class="px-4 py-2 rounded-lg text-sm font-medium border hover:bg-gray-50">üìã <span data-t="listViewBtn">List View</span></button>
        </div>

        <!-- Calendar View -->
        <div id="appt-subtab-calendar" class="p-6">
          <div class="grid lg:grid-cols-3 gap-6">
            <!-- Mini Calendar -->
            <div class="bg-gray-50 rounded-xl p-4 border">
              <div class="flex justify-between items-center mb-4">
                <button onclick="calNavMonth(-1)" class="px-3 py-1 border rounded hover:bg-gray-100 bg-white">‚óÄ</button>
                <h3 class="font-bold text-brand" id="cal-month-label"></h3>
                <button onclick="calNavMonth(1)" class="px-3 py-1 border rounded hover:bg-gray-100 bg-white">‚ñ∂</button>
              </div>
              <div id="cal-grid" class="grid grid-cols-7 gap-1 text-center text-sm"></div>
              <!-- Legend -->
              <div class="mt-4 pt-3 border-t text-xs text-gray-500 space-y-1">
                <div class="flex items-center gap-2"><div class="w-3 h-3 rounded bg-green-100 border-2 border-green-500"></div> Has appointments</div>
                <div class="flex items-center gap-2"><div class="w-3 h-3 rounded ring-2 ring-yellow-400"></div> Today</div>
                <div class="flex items-center gap-2"><div class="w-3 h-3 rounded bg-brand"></div> Selected</div>
              </div>
            </div>
            <!-- Day Detail with Assignment -->
            <div class="lg:col-span-2">
              <div class="flex justify-between items-center mb-4">
                <button onclick="calNavDay(-1)" class="px-3 py-1 border rounded hover:bg-gray-100" data-t="prevDay">‚óÄ Prev Day</button>
                <h3 class="text-xl font-bold text-brand" id="cal-day-label"></h3>
                <button onclick="calNavDay(1)" class="px-3 py-1 border rounded hover:bg-gray-100" data-t="nextDay">Next Day ‚ñ∂</button>
              </div>
              <div id="cal-day-appointments" class="space-y-3"></div>
            </div>
          </div>
        </div>

        <!-- List View -->
        <div id="appt-subtab-list" class="hidden p-6">
          <div class="flex flex-wrap gap-3 mb-4">
            <input type="text" id="appt-search" data-t="searchPlaceholder" placeholder="Search by name, email, service..." onkeyup="renderAppointments()" class="border rounded-lg px-3 py-2 text-sm flex-1 min-w-[200px]">
            <select id="appt-filter" onchange="renderAppointments()" class="border rounded-lg px-3 py-2 text-sm">
              <option value="all">All Status</option><option value="new">New</option><option value="confirmed">Confirmed</option><option value="completed">Completed</option><option value="cancelled">Cancelled</option>
            </select>
            <select id="appt-month" onchange="renderAppointments()" class="border rounded-lg px-3 py-2 text-sm">
              <option value="all">All Months</option>
            </select>
            <select id="appt-per-page" onchange="apptPage=1;renderAppointments()" class="border rounded-lg px-3 py-2 text-sm">
              <option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option><option value="all">All</option>
            </select>
          </div>
          <!-- Bulk Action Toolbar -->
          <div id="bulk-toolbar" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4 flex items-center justify-between">
            <span id="bulk-count" class="text-sm font-medium text-blue-700" data-t="selectedCount">0 selected</span>
            <div class="flex gap-2">
              <select id="bulk-status" class="text-sm border border-gray-300 rounded-lg px-3 py-1.5">
                <option value="" data-t="changeStatus">Change Status</option>
                <option value="new">New</option>
                <option value="confirmed">Confirmed</option>
                <option value="completed">Completed</option>
                <option value="cancelled">Cancelled</option>
              </select>
              <button onclick="applyBulkStatus()" class="text-sm bg-blue-600 text-white px-3 py-1.5 rounded-lg hover:bg-blue-700" data-t="applyStatus">Apply</button>
              <select id="bulk-employee" class="text-sm border border-gray-300 rounded-lg px-3 py-1.5">
                <option value="" data-t="assignEmployee">Assign Employee</option>
              </select>
              <button onclick="applyBulkAssign()" class="text-sm bg-green-600 text-white px-3 py-1.5 rounded-lg hover:bg-green-700" data-t="applyAssign">Assign</button>
              <button onclick="exportAppointmentsCsv()" class="text-sm bg-gray-600 text-white px-3 py-1.5 rounded-lg hover:bg-gray-700" data-t="exportCsv">Export CSV</button>
            </div>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead><tr class="bg-yellow-100 border-b text-left dark:bg-gray-700 dark:text-gray-200">
                <th class="px-4 py-3"><input type="checkbox" id="select-all-appts" onchange="toggleSelectAll(this.checked)" class="rounded"></th>
                <th class="p-3 cursor-pointer" onclick="sortAppts('customer')" data-t="thCustomer">Customer ‚Üï</th>
                <th class="p-3 cursor-pointer" onclick="sortAppts('service')" data-t="thService">Service ‚Üï</th>
                <th class="p-3 cursor-pointer" onclick="sortAppts('date')" data-t="thDateTime">Date & Time ‚Üï</th>
                <th class="p-3" data-t="thContact">Contact</th>
                <th class="p-3" data-t="thEmployee">Employee</th>
                <th class="p-3 cursor-pointer" onclick="sortAppts('status')" data-t="thStatus">Status ‚Üï</th>
                <th class="p-3" data-t="thActions">Actions</th>
              </tr></thead>
              <tbody id="appointments-table"></tbody>
            </table>
          </div>
          <div id="appt-pagination" class="flex justify-center gap-2 mt-4"></div>
        </div>
      </div>
    </div>

    <!-- MESSAGES TAB (with Email Logs sub-tab) -->
    <div id="tab-messages" class="tab-content hidden fade-in">
      <div class="bg-brand-light text-white px-6 py-4 rounded-t-xl"><h2 class="text-2xl font-bold" data-t="messagesWebsiteChanges">Messages & Website Changes</h2><p class="text-green-100" data-t="messagesSubtitle">Manage all messages and website change history</p></div>
      <div class="bg-white rounded-b-xl shadow p-6 dark:bg-gray-800">
        <div class="flex gap-2 mb-6 border-b pb-3">
          <button onclick="switchMessagesSubTab('contacts')" id="msg-sub-contacts" class="px-4 py-2 rounded-lg text-sm font-medium bg-brand text-white">üí¨ <span data-t="contactMessages">Contact Messages</span></button>
          <button onclick="switchMessagesSubTab('emaillogs')" id="msg-sub-emaillogs" class="px-4 py-2 rounded-lg text-sm font-medium border hover:bg-gray-50">üìù <span data-t="websiteChanges">Website Changes</span></button>
        </div>
        <div id="msg-subtab-contacts">
          <div class="flex justify-end mb-4"><button onclick="loadMessages()" class="bg-brand text-white px-4 py-2 rounded-lg text-sm hover:opacity-90">‚Üª Refresh</button></div>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead><tr class="bg-yellow-100 border-b text-left dark:bg-gray-700 dark:text-gray-200">
                <th class="p-3" data-t="thCustomer">Customer</th><th class="p-3" data-t="thContact">Contact</th><th class="p-3" data-t="thMessage">Message</th><th class="p-3" data-t="thDate">Date</th><th class="p-3" data-t="thStatus">Status</th>
              </tr></thead>
              <tbody id="messages-table"></tbody>
            </table>
          </div>
        </div>
        <div id="msg-subtab-emaillogs" class="hidden">
          <div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold text-brand" data-t="websiteChanges">Website Changes</h2><button onclick="loadEmailLogs()" class="bg-brand text-white px-4 py-2 rounded-lg text-sm hover:opacity-90">‚Üª Refresh</button></div>
          <div id="email-logs-list" class="space-y-3"></div>
        </div>
      </div>
    </div>

    <!-- EMPLOYEES TAB -->
    <div id="tab-employees" class="tab-content hidden fade-in">
      <div class="bg-brand-light text-white px-6 py-4 rounded-t-xl flex justify-between items-center">
        <div><h2 class="text-2xl font-bold">üë• <span data-t="employeeAdminMgmt">Employee & Admin Management</span></h2><p class="text-green-100" data-t="employeesSubtitle">Manage team members and admin access</p></div>
      </div>
      <div class="bg-white rounded-b-xl shadow p-6 dark:bg-gray-800">
        <!-- Add Employee Form -->
        <div id="add-employee-form" class="hidden mb-6 p-4 border rounded-lg bg-gray-50">
          <h4 class="font-medium mb-3" data-t="addNewEmployee">Add New Employee</h4>
          <div class="grid md:grid-cols-4 gap-3">
            <div><label class="text-sm font-medium" data-t="nameRequired">Name *</label><input id="new-emp-name" class="w-full p-2 border rounded mt-1" placeholder="Employee name"></div>
            <div><label class="text-sm font-medium" data-t="emailLabel2">Email</label><input id="new-emp-email" type="email" class="w-full p-2 border rounded mt-1" placeholder="email@example.com"></div>
            <div><label class="text-sm font-medium" data-t="phone">Phone</label><input id="new-emp-phone" class="w-full p-2 border rounded mt-1" placeholder="(555) 123-4567"></div>
            <div><label class="text-sm font-medium" data-t="role">Role</label><select id="new-emp-role" class="w-full p-2 border rounded mt-1"><option value="Employee">Employee</option><option value="Manager">Manager</option></select></div>
          </div>
          <div class="flex gap-2 mt-3">
            <button onclick="addEmployee()" class="bg-brand text-white px-4 py-2 rounded-lg text-sm" data-t="save">üíæ Save</button>
            <button onclick="toggleAddEmployeeForm()" class="border px-4 py-2 rounded-lg text-sm" data-t="cancel">Cancel</button>
          </div>
        </div>
        <!-- Add Admin Form -->
        <div id="add-admin-form" class="hidden mb-6 p-4 border rounded-lg bg-blue-50">
          <h4 class="font-medium mb-3" data-t="createAdminAccount">Create Admin Account</h4>
          <div class="flex gap-3 items-end">
            <div class="flex-1"><label class="text-sm font-medium">Email Address *</label><input id="new-admin-email" type="email" class="w-full p-2 border rounded mt-1" placeholder="admin@company.com"><p class="text-xs text-gray-500 mt-1">Will create account if user doesn't exist, then grant admin access</p></div>
            <button onclick="addAdmin()" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm h-10">üõ° Create & Grant Admin</button>
            <button onclick="toggleAddAdminForm()" class="border px-4 py-2 rounded-lg text-sm h-10">Cancel</button>
          </div>
        </div>
        <div id="employees-content"></div>
      </div>
    </div>

    <!-- GALLERY TAB (with Service Images sub-tab) -->
    <div id="tab-gallery" class="tab-content hidden fade-in">
      <div class="bg-brand-light text-white px-6 py-4 rounded-t-xl flex justify-between items-center">
        <h2 class="text-2xl font-bold" data-t="galleryServiceImages">Gallery & Service Images</h2>
        <button onclick="toggleAddGalleryForm()" id="gallery-add-btn" class="bg-white text-brand-light px-4 py-2 rounded-lg text-sm font-medium">+ Add Image</button>
      </div>
      <div class="bg-white rounded-b-xl shadow p-6 dark:bg-gray-800">
        <div class="flex gap-2 mb-6 border-b pb-3">
          <button onclick="switchGallerySubTab('gallery')" id="gal-sub-gallery" class="px-4 py-2 rounded-lg text-sm font-medium bg-brand text-white">üñº <span data-t="gallerySubTab">Gallery</span></button>
          <button onclick="switchGallerySubTab('serviceimgs')" id="gal-sub-serviceimgs" class="px-4 py-2 rounded-lg text-sm font-medium border hover:bg-gray-50">üé® <span data-t="serviceImagesSubTab">Service Images</span></button>
        </div>
        <div id="gal-subtab-gallery">
          <div id="add-gallery-form" class="hidden mb-6 p-4 border rounded-lg bg-gray-50">
            <h4 class="font-medium mb-3" data-t="addNewImage">Add New Image</h4>
            <div class="space-y-3">
              <div><label class="text-sm font-medium" data-t="imageFile">Image File *</label><input type="file" id="gallery-file" accept="image/*" class="w-full p-2 border rounded mt-1"></div>
              <div class="grid md:grid-cols-2 gap-3">
                <div><label class="text-sm font-medium" data-t="titleRequired">Title *</label><input id="gallery-title" class="w-full p-2 border rounded mt-1" placeholder="Image title"></div>
                <div><label class="text-sm font-medium" data-t="language">Language</label><select id="gallery-lang" class="w-full p-2 border rounded mt-1"><option value="english">English</option><option value="spanish">Spanish</option></select></div>
              </div>
              <div><label class="text-sm font-medium" data-t="description">Description</label><textarea id="gallery-desc" rows="2" class="w-full p-2 border rounded mt-1" placeholder="Image description"></textarea></div>
              <div class="flex gap-2">
                <button onclick="uploadGalleryImage()" id="gallery-upload-btn" class="bg-brand text-white px-4 py-2 rounded-lg text-sm" data-t="uploadAndSave">üíæ Upload & Save</button>
                <button onclick="toggleAddGalleryForm()" class="border px-4 py-2 rounded-lg text-sm" data-t="cancel">Cancel</button>
              </div>
            </div>
          </div>
          <div id="gallery-grid" class="space-y-3"></div>
        </div>
        <div id="gal-subtab-serviceimgs" class="hidden">
          <div class="flex justify-between items-center mb-4"><div><h2 class="text-2xl font-bold text-brand">Service Images Manager</h2><p class="text-gray-600 mt-1">Manage the hero background and 7 service images displayed on the home page</p></div></div>
          <div id="service-images-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>
      </div>
    </div>

    <!-- ANALYTICS TAB -->
    <div id="tab-analytics" class="tab-content hidden fade-in">
      <div class="bg-brand-light text-white px-6 py-4 rounded-xl mb-6"><h2 class="text-2xl font-bold" data-t="analyticsDashboard">Analytics Dashboard</h2><p class="text-green-100" data-t="analyticsSubtitle">Overview of your business metrics</p></div>
      <div id="analytics-content"></div>
    </div>

    <!-- DOCUMENTATION TAB -->
    <div id="tab-docs" class="tab-content hidden fade-in">
      <div class="bg-brand-light text-white px-6 py-4 rounded-t-xl flex justify-between items-center">
        <div><h2 class="text-2xl font-bold">üìñ <span data-t="documentation">Documentation</span></h2><p class="text-green-100" data-t="docsSubtitle">Instruction manual, feature list, and improvement roadmap</p></div>
      </div>
      <div class="bg-white rounded-b-xl shadow dark:bg-gray-800">
        <!-- Sub-tabs: Manual / Features / Improvements -->
        <div class="flex gap-2 p-4 border-b">
          <button onclick="switchDocsView('manual')" id="docs-view-manual" class="px-4 py-2 rounded-lg text-sm font-medium bg-brand text-white">üìã <span data-t="docsManual">Manual</span></button>
          <button onclick="switchDocsView('features')" id="docs-view-features" class="px-4 py-2 rounded-lg text-sm font-medium border hover:bg-gray-50">‚úÖ <span data-t="docsFeatures">Features</span></button>
          <button onclick="switchDocsView('improvements')" id="docs-view-improvements" class="px-4 py-2 rounded-lg text-sm font-medium border hover:bg-gray-50">üîß <span data-t="docsImprovements">Improvements</span></button>
        </div>

        <!-- Manual Sub-Tab -->
        <div id="docs-subtab-manual" class="p-6 max-h-[75vh] overflow-y-auto scrollbar-thin">
<div class="doc-lang-es hidden">
<h1 class="text-3xl font-bold text-gray-800 mb-6 pb-3 border-b-2 border-gray-300">Oregon Tires Auto Care &mdash; Manual de Instrucciones del Sitio Web</h1>

<p class="text-gray-600 mb-4 leading-relaxed">
  <strong class="font-semibold text-gray-800">Oregon Tires Auto Care</strong><br>
  8536 SE 82nd Ave, Portland, OR 97266<br>
  Tel&eacute;fono: (503) 367-9714<br>
  Horario: Lunes&ndash;S&aacute;bado 7:00 AM &ndash; 7:00 PM | Domingo Cerrado
</p>

<p class="text-gray-600 mb-4 leading-relaxed">
  Contacto de Super Administrador:<br>
  Tyrone &ldquo;Mental Stamina&rdquo; Norris<br>
  (774) 277-9202<br>
  <a class="text-green-600 hover:text-green-800 underline" href="mailto:tyronenorris@gmail.com">tyronenorris@gmail.com</a>
</p>

<p class="text-gray-600 mb-4 leading-relaxed">
  Contacto en Espa&ntilde;ol:<br>
  Margarita Escalante<br>
  (541) 936-1884<br>
  <a class="text-green-600 hover:text-green-800 underline" href="mailto:growwithmagi@gmail.com">growwithmagi@gmail.com</a>
</p>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">Tabla de Contenidos</h2>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Primeros Pasos</li>
  <li>Gesti&oacute;n de Citas</li>
  <li>Gesti&oacute;n de Mensajes de Contacto</li>
  <li>Gesti&oacute;n de Empleados</li>
  <li>Gesti&oacute;n de Im&aacute;genes de la Galer&iacute;a</li>
  <li>Gesti&oacute;n de Im&aacute;genes de Servicios (Hero y Tarjetas)</li>
  <li>Ver Anal&iacute;ticas</li>
  <li>Configuraci&oacute;n de Cuenta</li>
  <li>Funciones del Sitio P&uacute;blico (Lo que ven sus clientes)</li>
  <li>Soluci&oacute;n de Problemas</li>
</ol>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">1. Primeros Pasos</h2>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">C&oacute;mo Acceder al Panel de Administraci&oacute;n</h3>
<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Abra su navegador web (Chrome, Firefox, Safari o Edge).</li>
  <li>En la barra de direcciones, escriba la direcci&oacute;n de su sitio web seguida de <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/admin/</code>. Por ejemplo: <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oregon.tires/admin/</code></li>
  <li>Ver&aacute; una pantalla de inicio de sesi&oacute;n.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">C&oacute;mo Iniciar Sesi&oacute;n</h3>
<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Ingrese su <strong class="font-semibold text-gray-800">correo electr&oacute;nico</strong> en el campo de email.</li>
  <li>Ingrese su <strong class="font-semibold text-gray-800">contrase&ntilde;a</strong> en el campo de contrase&ntilde;a.</li>
  <li>Haga clic en el bot&oacute;n <strong class="font-semibold text-gray-800">Iniciar Sesi&oacute;n</strong>.</li>
  <li>Si es su primera vez, la cuenta de super administrador es <strong class="font-semibold text-gray-800">tyronenorris@gmail.com</strong>. Si no sabe la contrase&ntilde;a, use la opci&oacute;n de restablecer contrase&ntilde;a.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Lo que Ve Despu&eacute;s de Iniciar Sesi&oacute;n</h3>
<p class="text-gray-600 mb-4 leading-relaxed">Despu&eacute;s de un inicio de sesi&oacute;n exitoso, llegar&aacute; a la pesta&ntilde;a <strong class="font-semibold text-gray-800">Resumen</strong>. Esta pantalla muestra un resumen de la actividad de su negocio durante los &uacute;ltimos 14 d&iacute;as, incluyendo:</p>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>N&uacute;mero de citas nuevas recibidas</li>
  <li>N&uacute;mero de mensajes de contacto nuevos</li>
  <li>Citas pendientes, confirmadas y completadas</li>
  <li>Horario de empleados</li>
</ul>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">2. Gesti&oacute;n de Citas</h2>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Vista de Calendario</h3>
<p class="text-gray-600 mb-4 leading-relaxed">Haga clic en la pesta&ntilde;a <strong class="font-semibold text-gray-800">Citas</strong> y seleccione <strong class="font-semibold text-gray-800">Vista Calendario</strong>. Muestra las citas del d&iacute;a con franjas horarias. Use los botones de navegaci&oacute;n para avanzar o retroceder un d&iacute;a.</p>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Vista de Lista</h3>
<p class="text-gray-600 mb-4 leading-relaxed">Seleccione <strong class="font-semibold text-gray-800">Vista Lista</strong> para ver todas las citas en una tabla con b&uacute;squeda, filtros por estado, y paginaci&oacute;n.</p>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Actualizar Estado de una Cita</h3>
<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Busque la cita en la vista de calendario o lista.</li>
  <li>Haga clic en el bot&oacute;n de estado para cambiar entre: <strong class="font-semibold text-gray-800">Nueva</strong>, <strong class="font-semibold text-gray-800">Confirmada</strong>, <strong class="font-semibold text-gray-800">Completada</strong>, o <strong class="font-semibold text-gray-800">Cancelada</strong>.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Asignar un Empleado</h3>
<p class="text-gray-600 mb-4 leading-relaxed">En la vista de lista, use el men&uacute; desplegable de empleado junto a cada cita para asignar un t&eacute;cnico. Tambi&eacute;n puede usar <strong class="font-semibold text-gray-800">operaciones masivas</strong> para asignar m&uacute;ltiples citas a la vez.</p>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Operaciones Masivas</h3>
<p class="text-gray-600 mb-4 leading-relaxed">Seleccione m&uacute;ltiples citas usando las casillas de verificaci&oacute;n, luego use los controles masivos para cambiar estado, asignar empleado, o exportar a CSV.</p>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">3. Gesti&oacute;n de Mensajes de Contacto</h2>
<p class="text-gray-600 mb-4 leading-relaxed">Haga clic en la pesta&ntilde;a <strong class="font-semibold text-gray-800">Mensajes</strong>. Ver&aacute; todos los mensajes enviados por clientes a trav&eacute;s del formulario de contacto del sitio web. Los mensajes nuevos se muestran como <strong class="font-semibold text-gray-800">Nuevo</strong>. Haga clic en un mensaje para verlo completo y marcar como le&iacute;do.</p>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">4. Gesti&oacute;n de Empleados</h2>
<p class="text-gray-600 mb-4 leading-relaxed">En la pesta&ntilde;a <strong class="font-semibold text-gray-800">Empleados</strong>, puede agregar, editar y eliminar empleados. Cada empleado tiene nombre, correo, tel&eacute;fono y rol (Empleado o Gerente). Tambi&eacute;n puede crear cuentas de administrador para otros usuarios.</p>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">5. Gesti&oacute;n de Im&aacute;genes de la Galer&iacute;a</h2>
<p class="text-gray-600 mb-4 leading-relaxed">En la pesta&ntilde;a <strong class="font-semibold text-gray-800">Galer&iacute;a</strong>, puede subir fotos de su trabajo. Cada imagen tiene t&iacute;tulo, descripci&oacute;n e idioma. Las im&aacute;genes aparecen en la secci&oacute;n de galer&iacute;a del sitio p&uacute;blico.</p>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">6. Gesti&oacute;n de Im&aacute;genes de Servicios</h2>
<p class="text-gray-600 mb-4 leading-relaxed">En <strong class="font-semibold text-gray-800">Galer&iacute;a &rarr; Im&aacute;genes de Servicios</strong>, puede administrar las im&aacute;genes que aparecen en las tarjetas de servicio del sitio web. Hay 8 im&aacute;genes: 1 imagen de fondo principal (hero) y 7 tarjetas de servicio. Para cada una puede subir una nueva imagen y ajustar la posici&oacute;n y zoom.</p>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">7. Ver Anal&iacute;ticas</h2>
<p class="text-gray-600 mb-4 leading-relaxed">La pesta&ntilde;a <strong class="font-semibold text-gray-800">Anal&iacute;ticas</strong> muestra m&eacute;tricas de su negocio: total de citas, citas por estado, clientes recurrentes, estad&iacute;sticas de empleados, servicios m&aacute;s populares, y tiempos promedio.</p>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">8. Configuraci&oacute;n de Cuenta</h2>
<p class="text-gray-600 mb-4 leading-relaxed">Haga clic en <strong class="font-semibold text-gray-800">Configuraci&oacute;n de Cuenta</strong> en la esquina superior derecha para actualizar su nombre, correo, contrase&ntilde;a, y correo de notificaciones de administrador.</p>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">9. Funciones del Sitio P&uacute;blico</h2>
<p class="text-gray-600 mb-4 leading-relaxed">El sitio p&uacute;blico incluye: imagen de fondo din&aacute;mica, 7 tarjetas de servicios con im&aacute;genes, rese&ntilde;as de clientes, galer&iacute;a de fotos, formulario de contacto, mapa de Google, y cambio de idioma (ingl&eacute;s/espa&ntilde;ol). Todo se actualiza autom&aacute;ticamente cuando cambia im&aacute;genes o contenido en el panel de administraci&oacute;n.</p>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">10. Soluci&oacute;n de Problemas</h2>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li><strong class="font-semibold text-gray-800">No puedo iniciar sesi&oacute;n:</strong> Verifique su correo y contrase&ntilde;a. Despu&eacute;s de 5 intentos fallidos, la cuenta se bloquea por 15 minutos.</li>
  <li><strong class="font-semibold text-gray-800">Las im&aacute;genes no se cargan:</strong> Verifique que el archivo sea JPG, PNG o WebP y que no exceda el l&iacute;mite de tama&ntilde;o.</li>
  <li><strong class="font-semibold text-gray-800">Los cambios no aparecen en el sitio:</strong> Limpie la cach&eacute; del navegador o espere unos minutos.</li>
  <li><strong class="font-semibold text-gray-800">Necesita soporte t&eacute;cnico:</strong> Contacte a Tyrone Norris al (774) 277-9202 o <a class="text-green-600 hover:text-green-800 underline" href="mailto:tyronenorris@gmail.com">tyronenorris@gmail.com</a></li>
  <li><strong class="font-semibold text-gray-800">Soporte en espa&ntilde;ol:</strong> Contacte a Margarita Escalante al (541) 936-1884 o <a class="text-green-600 hover:text-green-800 underline" href="mailto:growwithmagi@gmail.com">growwithmagi@gmail.com</a></li>
</ul>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">Flujos de Estado de las Citas</h2>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li><strong class="font-semibold text-gray-800">Nueva</strong>: Acaba de llegar. Necesita revisi&oacute;n.</li>
  <li><strong class="font-semibold text-gray-800">Pendiente</strong>: En espera de confirmaci&oacute;n o asignaci&oacute;n.</li>
  <li><strong class="font-semibold text-gray-800">Confirmada</strong>: Un empleado ha sido asignado. El cliente ha sido notificado.</li>
  <li><strong class="font-semibold text-gray-800">Completada</strong>: El servicio est&aacute; terminado.</li>
  <li><strong class="font-semibold text-gray-800">Cancelada</strong>: La cita fue cancelada.</li>
</ul>

<p class="text-gray-600 mb-4 leading-relaxed italic">Este manual fue escrito para el equipo de administraci&oacute;n de Oregon Tires Auto Care. Para soporte t&eacute;cnico, contacte a Tyrone Norris en <a class="text-green-600 hover:text-green-800 underline" href="mailto:tyronenorris@gmail.com">tyronenorris@gmail.com</a> o (774) 277-9202. Para soporte en espa&ntilde;ol, contacte a Margarita Escalante en <a class="text-green-600 hover:text-green-800 underline" href="mailto:growwithmagi@gmail.com">growwithmagi@gmail.com</a> o (541) 936-1884.</p>
</div>
<div class="doc-lang-en">
<h1 class="text-3xl font-bold text-gray-800 mb-6 pb-3 border-b-2 border-gray-300">Oregon Tires Auto Care &mdash; Website Instruction Manual</h1>

<p class="text-gray-600 mb-4 leading-relaxed">
  <strong class="font-semibold text-gray-800">Oregon Tires Auto Care</strong><br>
  8536 SE 82nd Ave, Portland, OR 97266<br>
  Phone: (503) 367-9714<br>
  Hours: Monday&ndash;Saturday 7:00 AM &ndash; 7:00 PM | Sunday Closed
</p>

<p class="text-gray-600 mb-4 leading-relaxed">
  Super Admin Contact:<br>
  Tyrone &ldquo;Mental Stamina&rdquo; Norris<br>
  (774) 277-9202<br>
  <a class="text-green-600 hover:text-green-800 underline" href="mailto:tyronenorris@gmail.com">tyronenorris@gmail.com</a>
</p>

<p class="text-gray-600 mb-4 leading-relaxed">
  Spanish Contact:<br>
  Margarita Escalante<br>
  (541) 936-1884<br>
  <a class="text-green-600 hover:text-green-800 underline" href="mailto:growwithmagi@gmail.com">growwithmagi@gmail.com</a>
</p>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">Table of Contents</h2>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li><a class="text-green-600 hover:text-green-800 underline" href="#getting-started">Getting Started</a></li>
  <li><a class="text-green-600 hover:text-green-800 underline" href="#managing-appointments">Managing Appointments</a></li>
  <li><a class="text-green-600 hover:text-green-800 underline" href="#managing-contact-messages">Managing Contact Messages</a></li>
  <li><a class="text-green-600 hover:text-green-800 underline" href="#managing-employees">Managing Employees</a></li>
  <li><a class="text-green-600 hover:text-green-800 underline" href="#managing-gallery-images">Managing Gallery Images</a></li>
  <li><a class="text-green-600 hover:text-green-800 underline" href="#managing-service-images">Managing Service Images (Hero &amp; Feature Cards)</a></li>
  <li><a class="text-green-600 hover:text-green-800 underline" href="#viewing-analytics">Viewing Analytics</a></li>
  <li><a class="text-green-600 hover:text-green-800 underline" href="#account-settings">Account Settings</a></li>
  <li><a class="text-green-600 hover:text-green-800 underline" href="#public-website-features">Public Website Features (What Your Customers See)</a></li>
  <li><a class="text-green-600 hover:text-green-800 underline" href="#troubleshooting">Troubleshooting</a></li>
</ol>

<hr class="border-t border-gray-200 my-8">

<!-- Section 1 -->
<h2 id="getting-started" class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">1. Getting Started</h2>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">How to Access the Admin Dashboard</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Open your web browser (Chrome, Firefox, Safari, or Edge all work).</li>
  <li>In the address bar, type your website address followed by <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/admin/</code>. For example: <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oregon.tires/admin/</code></li>
  <li>You will see a login screen.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">How to Log In</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Enter your <strong class="font-semibold text-gray-800">email address</strong> in the email field.</li>
  <li>Enter your <strong class="font-semibold text-gray-800">password</strong> in the password field.</li>
  <li>Click the <strong class="font-semibold text-gray-800">Log In</strong> button.</li>
  <li>If this is your first time, the super admin account email is <strong class="font-semibold text-gray-800">tyronenorris@gmail.com</strong>. If you do not know the password, use the password reset option or contact whoever set up the account.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">What You See After Logging In</h3>

<p class="text-gray-600 mb-4 leading-relaxed">After a successful login, you land on the <strong class="font-semibold text-gray-800">Overview</strong> tab. This screen shows you a snapshot of your business activity over the last 14 days, including:</p>

<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>Number of new appointments received</li>
  <li>Number of new contact messages</li>
  <li>Recent activity highlights</li>
</ul>

<p class="text-gray-600 mb-4 leading-relaxed">Use the <strong class="font-semibold text-gray-800">navigation tabs</strong> along the top of the dashboard to move between sections: Appointments, Messages, Employees, Gallery, Analytics, and Settings.</p>

<hr class="border-t border-gray-200 my-8">

<!-- Section 2 -->
<h2 id="managing-appointments" class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">2. Managing Appointments</h2>

<p class="text-gray-600 mb-4 leading-relaxed">The Appointments tab is where you view, organize, and manage all service appointments that customers have booked through the website. There are two ways to view appointments: <strong class="font-semibold text-gray-800">Calendar View</strong> and <strong class="font-semibold text-gray-800">List View</strong>.</p>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Calendar View</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Click the <strong class="font-semibold text-gray-800">Appointments</strong> tab in the dashboard.</li>
  <li>The calendar shows the current month by default.</li>
  <li>Use the <strong class="font-semibold text-gray-800">left arrow</strong> and <strong class="font-semibold text-gray-800">right arrow</strong> buttons to navigate to previous or future months.</li>
  <li><strong class="font-semibold text-gray-800">Color meanings on the calendar:</strong>
    <ul class="list-disc pl-6 mt-2 space-y-2 text-gray-600">
      <li><strong class="font-semibold text-gray-800">Green dot</strong> on a date = That date has one or more appointments scheduled.</li>
      <li><strong class="font-semibold text-gray-800">Yellow ring</strong> around a date = That date is today.</li>
    </ul>
  </li>
  <li>Click on any date to see all appointments scheduled for that day.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">List View</h3>

<p class="text-gray-600 mb-4 leading-relaxed">The List View shows all appointments in a table format, which is useful for searching and filtering.</p>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Switch to the <strong class="font-semibold text-gray-800">List View</strong> using the view toggle (if not already selected).</li>
  <li><strong class="font-semibold text-gray-800">Search</strong>: Use the search bar at the top to find appointments by customer name, phone number, or other details.</li>
  <li><strong class="font-semibold text-gray-800">Filter by Status</strong>: Use the status dropdown to show only appointments with a specific status (New, Confirmed, Completed, or Cancelled).</li>
  <li><strong class="font-semibold text-gray-800">Filter by Month</strong>: Use the month filter to narrow results to a specific month.</li>
  <li><strong class="font-semibold text-gray-800">Sort Columns</strong>: Click on any column header (like Date, Name, or Status) to sort the list by that column.</li>
  <li><strong class="font-semibold text-gray-800">Change Per-Page Count</strong>: At the bottom of the list, choose how many appointments to show per page (for example, 10, 25, or 50).</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Assigning an Employee to an Appointment</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Find the appointment in the list or calendar view.</li>
  <li>Look for the <strong class="font-semibold text-gray-800">employee dropdown</strong> next to the appointment.</li>
  <li>Click the dropdown and select the employee you want to assign.</li>
  <li>The appointment status will <strong class="font-semibold text-gray-800">automatically change to Confirmed</strong> when you assign an employee.</li>
  <li>The system will <strong class="font-semibold text-gray-800">automatically send an email</strong> to the assigned employee (if they have an email on file) notifying them about the appointment.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Changing Appointment Status</h3>

<p class="text-gray-600 mb-4 leading-relaxed">Each appointment moves through a workflow:</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">New</strong> &rarr; <strong class="font-semibold text-gray-800">Confirmed</strong> &rarr; <strong class="font-semibold text-gray-800">Completed</strong> or <strong class="font-semibold text-gray-800">Cancelled</strong></p>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Find the appointment you want to update.</li>
  <li>Click the <strong class="font-semibold text-gray-800">status dropdown</strong> on that appointment.</li>
  <li>Select the new status:
    <ul class="list-disc pl-6 mt-2 space-y-2 text-gray-600">
      <li><strong class="font-semibold text-gray-800">Confirmed</strong> &ndash; The appointment has been acknowledged and assigned.</li>
      <li><strong class="font-semibold text-gray-800">Completed</strong> &ndash; The service has been finished.</li>
      <li><strong class="font-semibold text-gray-800">Cancelled</strong> &ndash; The appointment was cancelled.</li>
    </ul>
  </li>
  <li>The change is saved automatically.</li>
  <li>When an appointment is marked as <strong class="font-semibold text-gray-800">Completed</strong>, the system automatically sends a completion email to the customer.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Adding Admin Notes to an Appointment</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Find the appointment you want to annotate.</li>
  <li>Click the <strong class="font-semibold text-gray-800">notes icon</strong> (it looks like a small notepad or pencil icon next to the appointment).</li>
  <li>A text box will appear where you can type your note. For example: &ldquo;Customer requested alignment check as well&rdquo; or &ldquo;Called to confirm &ndash; arriving at 3 PM.&rdquo;</li>
  <li>Click <strong class="font-semibold text-gray-800">Save</strong> to store the note.</li>
  <li>Notes are only visible to admins and employees &ndash; customers do not see them.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Quick Assign All (Bulk Assignment)</h3>

<p class="text-gray-600 mb-4 leading-relaxed">If you have several unassigned appointments and want to distribute them quickly:</p>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Click the <strong class="font-semibold text-gray-800">&ldquo;Quick Assign All&rdquo;</strong> button (located above the appointments list).</li>
  <li>The system will automatically distribute all unassigned appointments evenly among your active employees using a round-robin method (Employee A gets one, Employee B gets the next, Employee C gets the next, and so on).</li>
  <li>All assigned appointments will be set to <strong class="font-semibold text-gray-800">Confirmed</strong> status.</li>
  <li>Email notifications will be sent to each assigned employee.</li>
</ol>

<hr class="border-t border-gray-200 my-8">

<!-- Section 3 -->
<h2 id="managing-contact-messages" class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">3. Managing Contact Messages</h2>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Viewing Messages</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Click the <strong class="font-semibold text-gray-800">Messages</strong> tab in the dashboard.</li>
  <li>You will see a list of all messages submitted through the website's contact form.</li>
  <li>Each message shows:
    <ul class="list-disc pl-6 mt-2 space-y-2 text-gray-600">
      <li><strong class="font-semibold text-gray-800">Customer name</strong></li>
      <li><strong class="font-semibold text-gray-800">Contact information</strong> (email and/or phone)</li>
      <li><strong class="font-semibold text-gray-800">Message preview</strong> (first few lines of their message)</li>
      <li><strong class="font-semibold text-gray-800">Date received</strong></li>
      <li><strong class="font-semibold text-gray-800">Status</strong> (New, Priority, or Completed)</li>
    </ul>
  </li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Reading a Full Message</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Find the message you want to read.</li>
  <li>Click the <strong class="font-semibold text-gray-800">&ldquo;View&rdquo;</strong> button next to it.</li>
  <li>The full message will open so you can read all the details.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Changing Message Status</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Find the message you want to update.</li>
  <li>Use the <strong class="font-semibold text-gray-800">status dropdown</strong> or status buttons to change it:
    <ul class="list-disc pl-6 mt-2 space-y-2 text-gray-600">
      <li><strong class="font-semibold text-gray-800">New</strong> &ndash; The message has not been handled yet (this is the default).</li>
      <li><strong class="font-semibold text-gray-800">Priority</strong> &ndash; Mark this for urgent messages that need immediate attention.</li>
      <li><strong class="font-semibold text-gray-800">Completed</strong> &ndash; Mark this when you have responded to or handled the message.</li>
    </ul>
  </li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Email Logs Sub-Tab</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Within the Messages section, look for the <strong class="font-semibold text-gray-800">&ldquo;Email Logs&rdquo;</strong> sub-tab.</li>
  <li>Click it to view a record of every email the system has sent, including:
    <ul class="list-disc pl-6 mt-2 space-y-2 text-gray-600">
      <li>Appointment confirmation emails</li>
      <li>Employee assignment notification emails</li>
      <li>Appointment completion emails</li>
    </ul>
  </li>
  <li>This is useful for verifying that emails were sent or for troubleshooting if a customer says they did not receive a notification.</li>
</ol>

<hr class="border-t border-gray-200 my-8">

<!-- Section 4 -->
<h2 id="managing-employees" class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">4. Managing Employees</h2>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Adding a New Employee</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Click the <strong class="font-semibold text-gray-800">Employees</strong> tab in the dashboard.</li>
  <li>Click the <strong class="font-semibold text-gray-800">&ldquo;Add Employee&rdquo;</strong> button.</li>
  <li>Fill in the form:
    <ul class="list-disc pl-6 mt-2 space-y-2 text-gray-600">
      <li><strong class="font-semibold text-gray-800">Name</strong> (required) &ndash; The employee's full name.</li>
      <li><strong class="font-semibold text-gray-800">Email</strong> (optional but recommended) &ndash; If you provide an email, the system will automatically create a login account for the employee.</li>
      <li><strong class="font-semibold text-gray-800">Phone</strong> (optional) &ndash; The employee's phone number.</li>
      <li><strong class="font-semibold text-gray-800">Role</strong> &ndash; Choose either <strong class="font-semibold text-gray-800">Employee</strong> or <strong class="font-semibold text-gray-800">Manager</strong>.</li>
    </ul>
  </li>
  <li>Click <strong class="font-semibold text-gray-800">Save</strong>.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Editing an Employee</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Go to the <strong class="font-semibold text-gray-800">Employees</strong> tab.</li>
  <li>Find the employee card you want to update.</li>
  <li>Click the <strong class="font-semibold text-gray-800">&ldquo;Edit&rdquo;</strong> button on their card.</li>
  <li>Update any fields you need to change (name, email, phone, or role).</li>
  <li>Click <strong class="font-semibold text-gray-800">Save</strong> to apply the changes.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Deactivating an Employee</h3>

<p class="text-gray-600 mb-4 leading-relaxed">When an employee leaves or is no longer working, you should deactivate them rather than delete them. This preserves their appointment history.</p>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Go to the <strong class="font-semibold text-gray-800">Employees</strong> tab.</li>
  <li>Find the employee card.</li>
  <li>Click the <strong class="font-semibold text-gray-800">&ldquo;Deactivate&rdquo;</strong> button.</li>
  <li>The employee will no longer appear in assignment dropdowns when you are assigning appointments.</li>
  <li>All of their past appointment history is preserved.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Reactivating an Employee</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Go to the <strong class="font-semibold text-gray-800">Employees</strong> tab.</li>
  <li>Look for the inactive employee (they may be in a separate section or visually marked as inactive).</li>
  <li>Click the <strong class="font-semibold text-gray-800">&ldquo;Activate&rdquo;</strong> button on their card.</li>
  <li>They will reappear in the assignment dropdowns and be available for new appointments.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Granting Admin Dashboard Access to an Employee</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Go to the <strong class="font-semibold text-gray-800">Employees</strong> tab.</li>
  <li>Find the employee you want to promote.</li>
  <li>Click the <strong class="font-semibold text-gray-800">&ldquo;Make Admin&rdquo;</strong> button on their card.</li>
  <li>That employee can now log in to the admin dashboard at <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oregon.tires/admin/</code> using their email and password.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Adding a New Admin (Who Is Not an Existing Employee)</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Go to the <strong class="font-semibold text-gray-800">Employees</strong> tab.</li>
  <li>Find the <strong class="font-semibold text-gray-800">&ldquo;Add Admin&rdquo;</strong> form.</li>
  <li>Enter the person's <strong class="font-semibold text-gray-800">email address</strong>.</li>
  <li>Click <strong class="font-semibold text-gray-800">Add</strong>. The system will create an account if one does not already exist and grant admin dashboard access.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Revoking Admin Access</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Go to the <strong class="font-semibold text-gray-800">Employees</strong> tab.</li>
  <li>Find the admin whose access you want to remove.</li>
  <li>Click the <strong class="font-semibold text-gray-800">&ldquo;Revoke Admin&rdquo;</strong> button.</li>
  <li>That person will no longer be able to access the admin dashboard. They will still exist as an employee if they were one.</li>
</ol>

<hr class="border-t border-gray-200 my-8">

<!-- Section 5 -->
<h2 id="managing-gallery-images" class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">5. Managing Gallery Images</h2>

<p class="text-gray-600 mb-4 leading-relaxed">Gallery images appear on the public website in the Gallery section that customers can browse.</p>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Adding a New Image</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Click the <strong class="font-semibold text-gray-800">Gallery</strong> tab in the dashboard.</li>
  <li>Click the <strong class="font-semibold text-gray-800">&ldquo;Add Image&rdquo;</strong> button.</li>
  <li><strong class="font-semibold text-gray-800">Select a file</strong> from your computer (JPG, PNG, or similar image formats work best).</li>
  <li>Enter a <strong class="font-semibold text-gray-800">Title</strong> (required) &ndash; This is the name that appears with the image.</li>
  <li>Choose a <strong class="font-semibold text-gray-800">Language</strong>:
    <ul class="list-disc pl-6 mt-2 space-y-2 text-gray-600">
      <li><strong class="font-semibold text-gray-800">English</strong> &ndash; The image will appear when the site is in English.</li>
      <li><strong class="font-semibold text-gray-800">Spanish</strong> &ndash; The image will appear when the site is in Spanish.</li>
    </ul>
  </li>
  <li>Add an optional <strong class="font-semibold text-gray-800">Description</strong> if you want to include extra details about the image.</li>
  <li>Click <strong class="font-semibold text-gray-800">Upload</strong>.</li>
  <li>The image is stored securely in cloud storage (Supabase) and will appear on the website automatically.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Deleting an Image</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Go to the <strong class="font-semibold text-gray-800">Gallery</strong> tab.</li>
  <li>Find the image you want to remove.</li>
  <li>Click the <strong class="font-semibold text-gray-800">red delete button</strong> on the image.</li>
  <li>Confirm the deletion when prompted.</li>
  <li><strong class="font-semibold text-gray-800">Warning</strong>: This permanently removes the image. It cannot be undone.</li>
</ol>

<hr class="border-t border-gray-200 my-8">

<!-- Section 6 -->
<h2 id="managing-service-images" class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">6. Managing Service Images (Hero &amp; Feature Cards)</h2>

<p class="text-gray-600 mb-4 leading-relaxed">Service images control what visitors see on the main sections of the public website. These are different from gallery images &ndash; they are the large background and feature images that define the look and feel of the site.</p>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Accessing Service Images</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Click the <strong class="font-semibold text-gray-800">Gallery</strong> tab in the dashboard.</li>
  <li>Switch to the <strong class="font-semibold text-gray-800">&ldquo;Service Images&rdquo;</strong> sub-tab.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">The 8 Service Image Slots</h3>

<p class="text-gray-600 mb-4 leading-relaxed">There are 8 image slots, each controlling a specific part of the website:</p>

<table class="w-full border-collapse mb-6">
  <thead>
    <tr>
      <th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Slot Name</th>
      <th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">What It Controls</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Hero Background</td>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">The large banner image at the top of the homepage</td>
    </tr>
    <tr>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Expert Technicians</td>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">The feature card for expert technicians</td>
    </tr>
    <tr>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Fast Cars</td>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">The feature card for fast service</td>
    </tr>
    <tr>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Quality Parts</td>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">The feature card for quality parts</td>
    </tr>
    <tr>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Bilingual Support</td>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">The feature card for bilingual (English/Spanish) support</td>
    </tr>
    <tr>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Tire Shop</td>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">The tire services section image</td>
    </tr>
    <tr>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Auto Repair</td>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">The auto repair section image</td>
    </tr>
    <tr>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Specialized Tools</td>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">The specialized tools section image</td>
    </tr>
  </tbody>
</table>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Uploading a New Service Image</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Find the service image slot you want to update (for example, &ldquo;Hero Background&rdquo;).</li>
  <li>Click the <strong class="font-semibold text-gray-800">&ldquo;Choose File&rdquo;</strong> button next to that slot name.</li>
  <li>Select an image from your computer.</li>
  <li>Click <strong class="font-semibold text-gray-800">Upload</strong>.</li>
  <li>The new image will replace the old one immediately.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Adjusting Image Position and Zoom</h3>

<p class="text-gray-600 mb-4 leading-relaxed">After uploading, you may want to adjust how the image is framed so the most important part of the photo is visible:</p>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Find the service image you just uploaded.</li>
  <li>Use the <strong class="font-semibold text-gray-800">Horizontal slider</strong> to move the image left or right.</li>
  <li>Use the <strong class="font-semibold text-gray-800">Vertical slider</strong> to move the image up or down.</li>
  <li>Use the <strong class="font-semibold text-gray-800">Zoom slider</strong> to zoom in or out.</li>
  <li>You will see a live preview of your adjustments.</li>
  <li>When you are satisfied, click <strong class="font-semibold text-gray-800">&ldquo;Save Position &amp; Crop&rdquo;</strong> to save your adjustments.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Understanding the &ldquo;Live&rdquo; Badge</h3>

<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>A <strong class="font-semibold text-gray-800">&ldquo;Live&rdquo;</strong> badge next to a service image means that image is currently showing on the public website.</li>
  <li>If no custom image has been uploaded for a slot, the website automatically uses a built-in fallback image. You do not need to upload images for the site to work &ndash; fallbacks are already in place.</li>
</ul>

<hr class="border-t border-gray-200 my-8">

<!-- Section 7 -->
<h2 id="viewing-analytics" class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">7. Viewing Analytics</h2>

<p class="text-gray-600 mb-4 leading-relaxed">The Analytics tab gives you a bird's-eye view of your business performance.</p>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">How to View Analytics</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Click the <strong class="font-semibold text-gray-800">Analytics</strong> tab in the dashboard.</li>
  <li>Review the following sections:</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Appointment Statistics</h3>

<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li><strong class="font-semibold text-gray-800">Total Appointments</strong>: The overall number of appointments in the system.</li>
  <li><strong class="font-semibold text-gray-800">Breakdown by Status</strong>: See how many appointments are New, Confirmed, Completed, or Cancelled.</li>
  <li><strong class="font-semibold text-gray-800">This Week's Count</strong>: How many appointments are scheduled for the current week.</li>
</ul>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Customer Statistics</h3>

<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li><strong class="font-semibold text-gray-800">Total Unique Customers</strong>: How many different customers have booked with you.</li>
  <li><strong class="font-semibold text-gray-800">Returning Customers</strong>: How many customers have come back for additional appointments.</li>
</ul>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Employee Performance</h3>

<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li><strong class="font-semibold text-gray-800">Appointments Handled</strong>: How many appointments each employee has been assigned.</li>
  <li><strong class="font-semibold text-gray-800">Appointments Completed</strong>: How many each employee has finished.</li>
  <li><strong class="font-semibold text-gray-800">Average Time Per Appointment</strong>: The typical time from assignment to completion for each employee.</li>
</ul>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Popular Times</h3>

<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>Shows which appointment time slots are requested most often. This helps you plan staffing and availability.</li>
</ul>

<hr class="border-t border-gray-200 my-8">

<!-- Section 8 -->
<h2 id="account-settings" class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">8. Account Settings</h2>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Accessing Your Settings</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Look for your <strong class="font-semibold text-gray-800">email address</strong> displayed in the top-right corner of the dashboard.</li>
  <li>Click on it to open the settings panel.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Changing Your Notification Email</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>In the settings panel, find the <strong class="font-semibold text-gray-800">Notification Email</strong> field.</li>
  <li>Enter the email address where you want to receive admin notifications (such as new appointment alerts).</li>
  <li>Click <strong class="font-semibold text-gray-800">Save</strong>.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Updating Your Display Name</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Find the <strong class="font-semibold text-gray-800">Display Name</strong> field in settings.</li>
  <li>Type your preferred name (this is what appears in the dashboard).</li>
  <li>Click <strong class="font-semibold text-gray-800">Save</strong>.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Changing Your Login Email</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Find the <strong class="font-semibold text-gray-800">Email</strong> field in settings.</li>
  <li>Enter your new email address.</li>
  <li>You may need to confirm the change via a confirmation step.</li>
  <li>Click <strong class="font-semibold text-gray-800">Save</strong>.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Changing Your Password</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Find the <strong class="font-semibold text-gray-800">Password</strong> section in settings.</li>
  <li>Enter your new password. It must be at least <strong class="font-semibold text-gray-800">6 characters</strong> long.</li>
  <li>Confirm the new password by typing it again (if prompted).</li>
  <li>Click <strong class="font-semibold text-gray-800">Save</strong>.</li>
</ol>

<hr class="border-t border-gray-200 my-8">

<!-- Section 9 -->
<h2 id="public-website-features" class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">9. Public Website Features (What Your Customers See)</h2>

<p class="text-gray-600 mb-4 leading-relaxed">This section describes the features that your customers interact with on the public-facing website. Understanding these helps you know what your customers experience.</p>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Language Toggle (English / Spanish)</h3>

<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>Visitors will see a <strong class="font-semibold text-gray-800">globe icon</strong> in the top area of the website.</li>
  <li>Clicking the globe icon switches the entire website between <strong class="font-semibold text-gray-800">English</strong> and <strong class="font-semibold text-gray-800">Spanish</strong>.</li>
  <li>All text, labels, and headings change to the selected language.</li>
  <li>The site remembers the visitor's language choice as they browse.</li>
</ul>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Contact Form</h3>

<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>The website has a <strong class="font-semibold text-gray-800">contact form</strong> where visitors can send you a message.</li>
  <li>When a visitor submits the form, their message immediately appears in your <strong class="font-semibold text-gray-800">Messages</strong> tab in the admin dashboard.</li>
  <li>The form collects the visitor's name, contact details, and their message.</li>
</ul>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Schedule Service</h3>

<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>The <strong class="font-semibold text-gray-800">&ldquo;Schedule Service&rdquo;</strong> button or link on the website directs visitors to the contact form section so they can reach out to book an appointment.</li>
</ul>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Customer Reviews</h3>

<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>The website displays <strong class="font-semibold text-gray-800">3 randomly selected customer reviews</strong> each time a visitor loads the page.</li>
  <li>This keeps the reviews section fresh and varied for repeat visitors.</li>
</ul>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Gallery</h3>

<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>The <strong class="font-semibold text-gray-800">Gallery</strong> section on the public website displays the images you have uploaded through the Gallery tab in your admin dashboard.</li>
  <li>Images are shown in the language the visitor has selected (English or Spanish), based on the language you assigned when uploading.</li>
</ul>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Google Maps</h3>

<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>The website includes an embedded <strong class="font-semibold text-gray-800">Google Maps</strong> widget showing your shop location at 8536 SE 82nd Ave, Portland, OR 97266.</li>
  <li>This helps customers find directions to your shop.</li>
</ul>

<hr class="border-t border-gray-200 my-8">

<!-- Section 10 -->
<h2 id="troubleshooting" class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">10. Troubleshooting</h2>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">&ldquo;I can't log in to the admin dashboard.&rdquo;</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Double-check that you are going to the correct address: <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oregon.tires/admin/</code></li>
  <li>Make sure you are typing your email and password correctly (check for extra spaces or capitalization).</li>
  <li>Try resetting your password if the option is available.</li>
  <li>If you are still locked out, contact the super admin, Tyrone Norris, at <strong class="font-semibold text-gray-800">tyronenorris@gmail.com</strong> or <strong class="font-semibold text-gray-800">(774) 277-9202</strong> for help with your account.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">&ldquo;Images I uploaded are not showing on the website.&rdquo;</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>When you upload images through the admin dashboard, they are stored in the cloud database. The website loads them from there.</li>
  <li>If no images have been uploaded for a particular section, the website uses <strong class="font-semibold text-gray-800">fallback images</strong> from the <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/images/</code> folder on the server.</li>
  <li>Make sure the fallback images exist on the server if you have not uploaded replacements through the dashboard.</li>
  <li>Try refreshing the page (press Ctrl+F5 on Windows or Cmd+Shift+R on Mac to do a hard refresh that clears the cache).</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">&ldquo;The contact form is not working.&rdquo;</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>The contact form saves submissions to a cloud database, so it requires an <strong class="font-semibold text-gray-800">active internet connection</strong> to work.</li>
  <li>Ask the customer to check their internet connection.</li>
  <li>If the problem persists, open the browser's developer tools (press F12) and check the <strong class="font-semibold text-gray-800">Console</strong> tab for error messages. Share these with a developer if needed.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">&ldquo;The language toggle is not switching between English and Spanish.&rdquo;</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>The language toggle requires <strong class="font-semibold text-gray-800">JavaScript</strong> to be enabled in the visitor's browser.</li>
  <li>Most browsers have JavaScript enabled by default. If it has been disabled, the visitor needs to re-enable it in their browser settings.</li>
  <li>Try a different browser to confirm whether the issue is browser-specific.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">&ldquo;I see a '403 Forbidden' error when visiting the site.&rdquo;</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Make sure the file <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">index.html</code> exists in the root folder on the server.</li>
  <li>Make sure the <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">.htaccess</code> file is present and properly configured on the server.</li>
  <li>If you recently uploaded files, double-check that they were placed in the correct directory on the server.</li>
  <li>Contact your hosting provider if the issue persists.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">&ldquo;The site looks broken or unstyled on a device.&rdquo;</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>The website uses <strong class="font-semibold text-gray-800">Tailwind CSS</strong> loaded from an online source (CDN). If the visitor's internet connection is slow or the CDN is temporarily unavailable, the site may appear unstyled.</li>
  <li>Ask the visitor to refresh the page once their connection is stable.</li>
  <li>The site is designed to be <strong class="font-semibold text-gray-800">responsive</strong> (it adjusts to phones, tablets, and desktops). If something looks off on a specific device, take a screenshot and share it with a developer.</li>
</ol>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">&ldquo;An employee says they did not receive an email notification.&rdquo;</h3>

<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
  <li>Go to the <strong class="font-semibold text-gray-800">Messages</strong> tab and click the <strong class="font-semibold text-gray-800">Email Logs</strong> sub-tab to verify whether the system sent the email.</li>
  <li>Ask the employee to check their <strong class="font-semibold text-gray-800">spam or junk folder</strong>.</li>
  <li>Make sure the employee has a valid email address entered in their profile under the Employees tab.</li>
  <li>If emails are consistently not being delivered, there may be an issue with the SMTP (email server) configuration. Contact a developer to check the server settings.</li>
</ol>

<hr class="border-t border-gray-200 my-8">

<!-- Quick Reference: Admin Dashboard Tabs -->
<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">Quick Reference: Admin Dashboard Tabs</h2>

<table class="w-full border-collapse mb-6">
  <thead>
    <tr>
      <th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Tab</th>
      <th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">What It Does</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><strong class="font-semibold text-gray-800">Overview</strong></td>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Shows 14-day activity snapshot after login</td>
    </tr>
    <tr>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><strong class="font-semibold text-gray-800">Appointments</strong></td>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">View, assign, and manage customer appointments</td>
    </tr>
    <tr>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><strong class="font-semibold text-gray-800">Messages</strong></td>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Read and manage contact form submissions and email logs</td>
    </tr>
    <tr>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><strong class="font-semibold text-gray-800">Employees</strong></td>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Add, edit, activate/deactivate employees and manage admin access</td>
    </tr>
    <tr>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><strong class="font-semibold text-gray-800">Gallery</strong></td>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Upload and manage gallery images and service images</td>
    </tr>
    <tr>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><strong class="font-semibold text-gray-800">Analytics</strong></td>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">View appointment, customer, and employee performance stats</td>
    </tr>
    <tr>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><strong class="font-semibold text-gray-800">Settings</strong></td>
      <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Update your profile, email, and password</td>
    </tr>
  </tbody>
</table>

<hr class="border-t border-gray-200 my-8">

<!-- Quick Reference: Appointment Status Flow -->
<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">Quick Reference: Appointment Status Flow</h2>

<pre class="bg-gray-100 rounded-lg p-4 mb-4 overflow-x-auto text-sm font-mono text-gray-700">New  &rarr;  Confirmed  &rarr;  Completed
                     &rarr;  Cancelled</pre>

<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li><strong class="font-semibold text-gray-800">New</strong>: A customer just booked. No employee assigned yet.</li>
  <li><strong class="font-semibold text-gray-800">Confirmed</strong>: An employee has been assigned. The customer has been notified.</li>
  <li><strong class="font-semibold text-gray-800">Completed</strong>: The service is done. The customer receives a completion email.</li>
  <li><strong class="font-semibold text-gray-800">Cancelled</strong>: The appointment was cancelled and will not be serviced.</li>
</ul>

<hr class="border-t border-gray-200 my-8">

<p class="text-gray-600 mb-4 leading-relaxed italic">This manual was written for the Oregon Tires Auto Care admin team. For technical support, contact Tyrone Norris at <a class="text-green-600 hover:text-green-800 underline" href="mailto:tyronenorris@gmail.com">tyronenorris@gmail.com</a> or (774) 277-9202. For Spanish support, contact Margarita Escalante at <a class="text-green-600 hover:text-green-800 underline" href="mailto:growwithmagi@gmail.com">growwithmagi@gmail.com</a> or (541) 936-1884.</p>
</div>
        </div>

        <div id="docs-subtab-features" class="hidden p-6 max-h-[75vh] overflow-y-auto scrollbar-thin">
<div class="doc-lang-es hidden">
<h1 class="text-3xl font-bold text-gray-800 mb-6 pb-3 border-b-2 border-gray-300">Oregon Tires Auto Care &mdash; Lista de Caracter&iacute;sticas</h1>

<blockquote class="border-l-4 border-green-500 pl-4 py-2 mb-4 bg-green-50 rounded-r-lg text-gray-600">
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">&Uacute;ltima actualizaci&oacute;n:</strong> 2026-02-15<br>
<strong class="font-semibold text-gray-800">Stack:</strong> HTML/CSS/JS Est&aacute;tico | Supabase Backend | cPanel/Apache</p>
</blockquote>

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">Sitio Web P&uacute;blico</h2>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Secci&oacute;n Hero (Encabezado Principal)</h3>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>Imagen de fondo din&aacute;mica cargada desde la base de datos Supabase</li>
  <li>Posicionamiento ajustable (horizontal, vertical, zoom)</li>
  <li>Imagen de respaldo local si la base de datos no est&aacute; disponible</li>
  <li>T&iacute;tulo y subt&iacute;tulo traducibles (ingl&eacute;s/espa&ntilde;ol)</li>
</ul>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Tarjetas de Servicios (7 tarjetas)</h3>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>T&eacute;cnicos Expertos, Servicio R&aacute;pido, Partes de Calidad, Soporte Biling&uuml;e</li>
  <li>Servicios de Llantas, Mantenimiento Automotriz, Servicios Especializados</li>
  <li>Im&aacute;genes din&aacute;micas desde Supabase con im&aacute;genes de respaldo locales</li>
</ul>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Rese&ntilde;as de Clientes</h3>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>12 rese&ntilde;as verificadas (3 aleatorias se muestran cada vez)</li>
  <li>Calificaci&oacute;n general: 4.8 de 5 estrellas</li>
  <li>Enlace a rese&ntilde;as de Google</li>
</ul>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Galer&iacute;a de Fotos</h3>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>Im&aacute;genes cargadas din&aacute;micamente desde Supabase</li>
  <li>Cuadr&iacute;cula responsiva con efecto hover</li>
  <li>Soporte de t&iacute;tulo y descripci&oacute;n</li>
</ul>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Formulario de Contacto</h3>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>Validaci&oacute;n de campos (nombre, tel&eacute;fono, correo, mensaje)</li>
  <li>L&iacute;mite de env&iacute;o (30 segundos entre mensajes)</li>
  <li>Los mensajes se guardan en Supabase y aparecen en el panel admin</li>
</ul>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">Panel de Administraci&oacute;n</h2>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Autenticaci&oacute;n y Seguridad</h3>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>Inicio de sesi&oacute;n con correo y contrase&ntilde;a v&iacute;a Supabase Auth</li>
  <li>Bloqueo de cuenta despu&eacute;s de 5 intentos fallidos (15 minutos)</li>
  <li>Verificaci&oacute;n de rol de administrador v&iacute;a tabla de perfiles</li>
</ul>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Gesti&oacute;n de Citas</h3>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>Vista de calendario con navegaci&oacute;n por d&iacute;a</li>
  <li>Vista de lista con b&uacute;squeda, filtros, ordenamiento y paginaci&oacute;n</li>
  <li>Operaciones masivas: cambiar estado, asignar empleado, exportar CSV</li>
  <li>Asignaci&oacute;n r&aacute;pida de empleados desde el calendario</li>
  <li>Notas de administrador por cita</li>
</ul>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Gesti&oacute;n de Im&aacute;genes</h3>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>Subir y eliminar im&aacute;genes de la galer&iacute;a</li>
  <li>8 im&aacute;genes de servicio configurables (hero + 7 tarjetas)</li>
  <li>Ajuste de posici&oacute;n y zoom en tiempo real</li>
  <li>Vista previa antes de guardar</li>
</ul>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Anal&iacute;ticas</h3>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>Total de citas, por estado, clientes recurrentes</li>
  <li>Estad&iacute;sticas por empleado</li>
  <li>Servicios m&aacute;s populares y distribuci√≥n horaria</li>
</ul>

<p class="text-gray-600 mb-4 leading-relaxed"><em>Documento generado del an&aacute;lisis del c&oacute;digo fuente de Oregon Tires Auto Care.</em></p>
</div>
<div class="doc-lang-en">
<h1>Oregon Tires Auto Care -- Feature List</h1>
<blockquote class="border-l-4 border-green-500 pl-4 py-2 mb-4 bg-green-50 rounded-r-lg text-gray-600">
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Last updated:</strong> 2026-02-15
<strong class="font-semibold text-gray-800">Stack:</strong> Static HTML/CSS/JS | Supabase Backend | cPanel/Apache Hosting
<strong class="font-semibold text-gray-800">URL structure:</strong> <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">index.html</code> (public site), <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">admin/index.html</code> (dashboard), <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">book-appointment/index.html</code> (redirect stub)</p>
</blockquote>
<hr class="border-t border-gray-200 my-8">
<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">Table of Contents</h2>
<ol class="list-decimal pl-6 mb-4 space-y-2 text-gray-600">
<li><a href="#1-public-website">Public Website</a></li>
<li><a href="#11-navigation-and-layout">Navigation and Layout</a></li>
<li><a href="#12-hero-section">Hero Section</a></li>
<li><a href="#13-services-section">Services Section</a></li>
<li><a href="#14-about-section">About Section</a></li>
<li><a href="#15-reviews-section">Reviews Section</a></li>
<li><a href="#16-gallery-section">Gallery Section</a></li>
<li><a href="#17-contact-section">Contact Section</a></li>
<li><a href="#18-bilingual-system-englishspanish">Bilingual System</a></li>
<li><a href="#19-seo-and-structured-data">SEO and Structured Data</a></li>
<li><a href="#110-external-integrations">External Integrations</a></li>
<li><a href="#111-asset-management">Asset Management</a></li>
<li><a href="#2-admin-dashboard">Admin Dashboard</a></li>
<li><a href="#21-authentication">Authentication</a></li>
<li><a href="#22-overview-tab">Overview Tab</a></li>
<li><a href="#23-appointments-tab">Appointments Tab</a></li>
<li><a href="#24-messages-tab">Messages Tab</a></li>
<li><a href="#25-employees-tab">Employees Tab</a></li>
<li><a href="#26-gallery-tab">Gallery Tab</a></li>
<li><a href="#27-analytics-tab">Analytics Tab</a></li>
<li><a href="#28-realtime-updates">Realtime Updates</a></li>
<li><a href="#29-account-settings">Account Settings</a></li>
<li><a href="#210-utility-functions">Utility Functions</a></li>
<li><a href="#211-documentation-tab">Documentation Tab</a></li>
<li><a href="#3-book-appointment-page">Book Appointment Page</a></li>
<li><a href="#4-database-schema">Database Schema</a></li>
<li><a href="#5-infrastructure">Infrastructure</a></li>
</ol>
<hr class="border-t border-gray-200 my-8">
<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">1. Public Website</h2>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">File:</strong> <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">public_html/index.html</code> (697 lines -- single-file SPA)</p>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">1.1 Navigation and Layout</h3>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Feature</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Top info bar</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Phone, email, address, business hours, social links, language toggle</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Sticky header</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Logo + desktop nav, pinned to top on scroll (<code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">sticky top-0 z-50</code>)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Desktop nav links</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Home, Services, About, Reviews, Gallery, Contact, Schedule Service (CTA button)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Mobile hamburger menu</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Toggle-based <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">hidden</code> menu with identical link set</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Smooth scroll</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">html { scroll-behavior: smooth; }</code> with <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">scroll-mt-24</code> offsets on each section</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Responsive design</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Tailwind CSS breakpoints: <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">md:</code> (tablet), <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">lg:</code> (desktop), mobile-first</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Fade-in animations</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">.fade-in</code> keyframe animation on content elements (opacity + translateY)</td>
</tr>
</tbody>
</table>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">1.2 Hero Section</h3>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
<li>Dynamic background image loaded from Supabase <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_service_images</code> table (key: <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">hero-background</code>)</li>
<li>Local fallback image (<code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">assets/hero-bg.png</code>) if Supabase URL fails or is unavailable</li>
<li>Semi-transparent black overlay (<code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">bg-black/50</code>) for text readability</li>
<li>Bilingual headline and subtitle (swapped via <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">data-t</code> translation keys)</li>
<li>Two CTA buttons:</li>
<li><strong class="font-semibold text-gray-800">"Contact Us"</strong> -- smooth-scrolls to <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">#contact</code></li>
<li><strong class="font-semibold text-gray-800">"Schedule Service"</strong> -- navigates to <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/book-appointment</code></li>
</ul>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">1.3 Services Section</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">7 Feature Cards:</strong></p>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Card</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">ID</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Fallback Image</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Expert Technicians</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">svc-img-expert-technicians</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">images/expert-technicians.jpg</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Fast Service</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">svc-img-fast-cars</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">images/fast-cars.jpg</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Quality Parts</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">svc-img-quality-car-parts</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">images/quality-parts.jpg</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Bilingual Support</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">svc-img-bilingual-support</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">images/bilingual-service.jpg</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Tire Services</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">svc-img-tire-shop</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">images/tire-services.jpg</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Auto Maintenance</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">svc-img-auto-repair</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">images/auto-maintenance.jpg</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Specialized Services</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">svc-img-specialized-tools</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">images/specialized-services.jpg</code></td>
</tr>
</tbody>
</table>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
<li>Each card loads its background image dynamically from Supabase with position and scale controls</li>
<li><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">tryLoadImage()</code> validates every URL before applying -- broken URLs fall back to local images</li>
<li>Cards display a title and description, both fully translatable</li>
</ul>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Three Service Category Lists:</strong></p>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Category</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Services Listed</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Tire Services</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">New or Used Tires, Mount and Balance Tires, Tire Repair</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Auto Maintenance</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Oil Change, Brake Services, Tuneup</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Specialized Services</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Alignment, Mechanical Inspection, Mobile Service (At Your Home), Roadside Assistance (Any Location)</td>
</tr>
</tbody>
</table>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Emergency Service Callout:</strong>
- Red-bordered alert box in the Specialized Services card
- Direct phone number call-to-action: (503) 367-9714</p>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Service Promise Section:</strong>
- Three pillars displayed in a branded banner:
  - Quality Guarantee
  - Fair Pricing
  - Expert Service
- Descriptive text about commitment to quality, transparency, and satisfaction</p>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">1.4 About Section</h3>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
<li><strong class="font-semibold text-gray-800">Catchphrase:</strong> "We take care of your car, you enjoy the road."</li>
<li><strong class="font-semibold text-gray-800">Vision statement:</strong> "To be the most trusted tire shop in Portland, Oregon."</li>
<li><strong class="font-semibold text-gray-800">Mission statement:</strong> Dedication to high-quality tires, reliable mechanical services, and personalized attention</li>
<li><strong class="font-semibold text-gray-800">"Why Choose Us" list:</strong></li>
<li>Bilingual staff (English and Spanish)</li>
<li>Honest, transparent pricing</li>
<li>Quality workmanship guaranteed</li>
<li>Fast and reliable service</li>
<li><strong class="font-semibold text-gray-800">History block:</strong> "Serving Portland Since 2008" with 15+ years narrative</li>
</ul>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">1.5 Reviews Section</h3>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
<li><strong class="font-semibold text-gray-800">12 hardcoded reviews</strong> (mix of English and Spanish text)</li>
<li><strong class="font-semibold text-gray-800">Random selection:</strong> 3 reviews displayed per page load via <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">Array.sort(() =&gt; 0.5 - Math.random()).slice(0, 3)</code></li>
<li><strong class="font-semibold text-gray-800">Star rating display:</strong> Unicode filled stars and empty stars (e.g., five filled stars for a 5-star review)</li>
<li><strong class="font-semibold text-gray-800">"Verified" badge</strong> on each review card</li>
<li><strong class="font-semibold text-gray-800">Aggregated rating display:</strong></li>
<li>4.8 out of 5 stars</li>
<li>"Based on 150+ Google Reviews"</li>
<li>Five filled stars rendered in yellow</li>
<li><strong class="font-semibold text-gray-800">External link:</strong> "View All Reviews on Google" button linking to Google search results</li>
</ul>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">1.6 Gallery Section</h3>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
<li>Dynamic image grid loaded from Supabase (<code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_gallery_images</code> table)</li>
<li>Filters by <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">is_active = true</code>, ordered by <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">display_order</code></li>
<li><strong class="font-semibold text-gray-800">Hover zoom animation:</strong> <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">group-hover:scale-105</code> with CSS transition on images</li>
<li>Optional title and description displayed below each image (if populated)</li>
<li>Loading placeholder text: "Loading gallery..."</li>
<li>Fallback message: "No gallery images yet." when the table is empty</li>
<li><strong class="font-semibold text-gray-800">Gallery reloads on language switch</strong> to refresh any language-specific content</li>
</ul>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">1.7 Contact Section</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Contact Form (5 fields):</strong></p>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Field</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Type</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">First Name</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">text</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Yes</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Last Name</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">text</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Yes</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Phone</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">tel</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Yes</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Email</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">email</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Yes</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Message</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">textarea (4 rows)</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Yes</td>
</tr>
</tbody>
</table>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
<li>Form submits to Supabase <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_contact_messages</code> table via <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">sb.from().insert()</code></li>
<li>Stores the current language with the message (<code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">english</code> or <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">spanish</code>)</li>
<li><strong class="font-semibold text-gray-800">Success feedback:</strong> Green text -- "Message sent successfully!" / Spanish equivalent</li>
<li><strong class="font-semibold text-gray-800">Error feedback:</strong> Red text -- "Error sending message. Please try again." / Spanish equivalent</li>
</ul>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Contact Info Display:</strong></p>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Item</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Phone</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">(503) 367-9714 (clickable <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">tel:</code> link)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Email</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">oregontirespdx@gmail.com (clickable <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">mailto:</code> link in top bar and footer)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Address</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">8536 SE 82nd Ave, Portland, OR 97266</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Hours</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Mon-Sat 7AM-7PM, Sunday: Closed</td>
</tr>
</tbody>
</table>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Google Maps Embed:</strong>
- Full-width iframe pointing to 8536 SE 82nd Ave, Portland, OR 97266
- Lazy-loaded with <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">loading="lazy"</code> attribute
- Rounded corners matching site design</p>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">1.8 Bilingual System (English/Spanish)</h3>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Aspect</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Toggle button</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Top bar and footer -- switches between EN/ES</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Translation keys</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">74 keys covering all UI text</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Attribute system</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">data-t</code> attribute on all translatable elements</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Toggle function</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">toggleLanguage()</code> swaps all <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">data-t</code> elements simultaneously</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Language state</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">currentLang</code> variable (<code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">'en'</code> or <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">'es'</code>)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Gallery reload</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Gallery images reload on language switch</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Form messages</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Success/error messages display in the active language</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Contact storage</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Language is stored with each submitted contact message</td>
</tr>
</tbody>
</table>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">1.9 SEO and Structured Data</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Meta Tags:</strong>
- <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;title&gt;</code> -- "Oregon Tires Auto Care - Professional Tire &amp; Auto Services in Portland"
- <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;meta name="description"&gt;</code> -- full business description with phone number
- <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;meta name="keywords"&gt;</code> -- tires, auto care, brake service, oil change, Portland Oregon, bilingual
- <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;meta name="author"&gt;</code> -- Oregon Tires Auto Care
- <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;meta name="viewport"&gt;</code> -- responsive viewport</p>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Open Graph Tags:</strong>
- <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">og:title</code> -- Oregon Tires Auto Care
- <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">og:description</code> -- serving Portland since 2008
- <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">og:type</code> -- website
- <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">og:locale</code> -- en_US</p>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Schema.org JSON-LD:</strong>
- Type: <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">AutomotiveBusiness</code>
- Name, description, telephone, full postal address
- Opening hours: <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">Mo-Sa 07:00-19:00</code>
- Price range: <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">$$</code></p>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Semantic HTML:</strong> Proper use of <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;header&gt;</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;section&gt;</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;footer&gt;</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;nav&gt;</code>, heading hierarchy</p>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">1.10 External Integrations</h3>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Service</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Supabase JS SDK v2</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Database queries, storage, realtime subscriptions</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Tailwind CSS CDN</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">All styling via utility classes</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Google Maps Embed API</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Location iframe in contact section</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Instagram</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Social link to <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">instagram.com/oregontires</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Facebook</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Social link to business page</td>
</tr>
</tbody>
</table>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">1.11 Asset Management</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">normalizeAssetPath()</code> function:</strong>
- Converts Lovable platform <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/lovable-uploads/</code> UUID paths to clean <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/assets/</code> paths
- Used for backward compatibility with migrated assets</p>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">ASSET_PATH_MAP (3 core assets):</strong></p>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">UUID</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Clean Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">1290fb5e-e45c-4fc3-b523-e71d756ec1ef.png</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">logo.png</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">afc0de17-b407-4b29-b6a2-6f44d5dcad0d.png</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">hero-bg.png</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">b0182aa8-dde3-4175-8f09-21b6122f47f4.png</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">favicon.png</code></td>
</tr>
</tbody>
</table>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">tryLoadImage()</code> function:</strong>
- Creates a temporary <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">Image</code> object to validate URLs before applying as CSS backgrounds
- Returns a Promise that resolves on successful load, rejects on error
- On rejection, the fallback local image path is used instead</p>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Path strategy:</strong> All paths are relative (no leading <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/</code>) for cPanel subdirectory compatibility</p>
<hr class="border-t border-gray-200 my-8">
<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">2. Admin Dashboard</h2>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">File:</strong> <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">public_html/admin/index.html</code> (~3,870 lines -- single-file SPA with embedded documentation)
<strong class="font-semibold text-gray-800">Access:</strong> <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">noindex, nofollow</code> meta tag prevents search engine indexing</p>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">2.1 Authentication</h3>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Feature</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Login method</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Email/password via <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">sb.auth.signInWithPassword()</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Admin verification</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Checks <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_profiles.is_admin = true</code> for the user's UUID and <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">project_id = 'oregon-tires'</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Admin verification</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">All admins verified via <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_profiles.is_admin</code> database check (no hardcoded bypass)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Auto-session restore</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">On page load, calls <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">sb.auth.getSession()</code> and auto-shows dashboard if valid admin session exists</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Sign out</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">sb.auth.signOut()</code> clears session and returns to login screen</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Login feedback</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Error messages displayed below form; button shows "Signing in..." during auth</td>
</tr>
</tbody>
</table>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">2.2 Overview Tab</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">14-Day Appointment Statistics (4 stat cards):</strong></p>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Metric</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Color</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Total Appointments</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Brand green</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Count of all appointments in the next 14 days</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Pending</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Blue</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Appointments with status <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">new</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Confirmed</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Green</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Appointments with status <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">confirmed</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Completed</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Gray</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Appointments with status <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">completed</code></td>
</tr>
</tbody>
</table>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Upcoming Appointments Panel:</strong>
- Groups appointments by date for the next 14 days
- Each date shows day label, appointment count badge, and up to 3 appointment previews
- Today's date highlighted with yellow ring and star icon
- Dates with appointments have green left border; empty dates show "Open"
- Shows customer name, time, service, and status badge per appointment</p>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Employee Schedule Panel:</strong>
- Lists all active employees with their 14-day appointment counts
- Shows estimated hours (appointments x 1.5 hours)
- Displays next upcoming appointment date for each employee</p>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">2.3 Appointments Tab</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Two sub-views toggled via sub-tabs:</strong></p>
<h4 class="text-lg font-medium text-gray-600 mt-4 mb-2">Calendar View</h4>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Feature</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Monthly calendar grid</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">7-column grid (Sun-Sat) with day numbers</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Month navigation</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Previous/Next month buttons</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Day navigation</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Previous/Next day buttons for the detail panel</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Color coding</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Green background + border = has appointments; Yellow ring = today; Brand color fill = selected</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Appointment count</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Per-day count displayed inside calendar cells</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Legend</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Visual guide for color meanings</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Day detail panel</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Full appointment list for the selected day (spans 2 columns)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Per-appointment controls</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Employee assignment dropdown, status dropdown, notes button</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Quick Assign All</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Round-robin distribution of unassigned appointments across active employees for a given day</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Unassigned warning</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Orange banner showing count of unassigned appointments with quick-assign button</td>
</tr>
</tbody>
</table>
<h4 class="text-lg font-medium text-gray-600 mt-4 mb-2">List View</h4>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Feature</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Search</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Text search across name, email, phone, service, status</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Status filter</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Dropdown: All, New, Confirmed, Completed, Cancelled</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Month filter</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Dropdown populated with last 24 months</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Per-page control</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">10, 25, 50, 100, or All results</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Sortable columns</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Customer, Service, Date &amp; Time, Status (click to toggle asc/desc)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Pagination</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Numbered page buttons with Previous/Next navigation</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Per-row actions</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Status dropdown, employee assignment dropdown, notes button</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Duration display</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Completed appointments show actual duration in minutes</td>
</tr>
</tbody>
</table>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Appointment Actions:</strong>
- <strong class="font-semibold text-gray-800">Assign employee:</strong> Dropdown of active employees; auto-confirms status on assignment
- <strong class="font-semibold text-gray-800">Change status:</strong> New, Confirmed, Completed, Cancelled
- <strong class="font-semibold text-gray-800">Confirmation guard:</strong> Cannot confirm an appointment without an assigned employee
- <strong class="font-semibold text-gray-800">Admin notes:</strong> Modal with textarea for per-appointment notes, saved to <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">admin_notes</code> column
- <strong class="font-semibold text-gray-800">Email notifications:</strong> Triggered via Supabase edge function <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">send-appointment-emails</code> on:
  - Employee assignment (<code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">appointment_assigned</code>)
  - Completion (<code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">appointment_completed</code>)</p>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">2.4 Messages Tab</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Two sub-tabs:</strong></p>
<h4 class="text-lg font-medium text-gray-600 mt-4 mb-2">Contact Messages Sub-Tab</h4>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Feature</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Message table</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Columns: Customer, Contact (email + phone), Message (truncated), Date, Status</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Status management</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Dropdown per message: New, Priority, Completed</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Full message modal</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Shows name, email, phone, date, full message text, and status selector</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Read full link</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Appears when message exceeds 80 characters</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Refresh button</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Manual reload of messages from Supabase</td>
</tr>
</tbody>
</table>
<h4 class="text-lg font-medium text-gray-600 mt-4 mb-2">Website Changes Sub-Tab</h4>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Feature</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Email history list</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Card-based layout showing all sent emails</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Type badges</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Color-coded: Confirmation (blue), Assignment (yellow), Completion (green)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Recipient type badge</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Shows whether email was sent to customer or employee</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Email detail modal</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Shows subject, To, Type, Sent date, Resend Message ID, and full HTML body</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Refresh button</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Manual reload of email logs</td>
</tr>
</tbody>
</table>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">2.5 Employees Tab</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Employee Management:</strong></p>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Feature</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Add employee form</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Fields: Name (required), Email, Phone, Role (Employee/Manager)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Account creation</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">If email provided, invokes <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">create-employee-account</code> Supabase edge function to create auth account and send credentials</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Edit employee</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Inline edit form with Name, Email, Phone, Role fields</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Toggle active/inactive</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Activate or deactivate employees (soft delete)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Upcoming appointments</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Badge showing count and next appointment date per active employee</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Role display</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Badge showing Employee or Manager role</td>
</tr>
</tbody>
</table>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Admin Privilege Management:</strong></p>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Feature</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Add admin form</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Email input, creates account if user does not exist via edge function</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Grant admin access</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Calls <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">set_admin_by_email</code> RPC to set <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">is_admin = true</code> in <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_profiles</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Revoke admin access</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Sets <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">is_admin = false</code> with confirmation dialog</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Admin-only user display</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Separate section showing dashboard admins not in employee list</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Last login info</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Shows last sign-in date or account creation date for each admin</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Admin badge</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Green shield badge on employees who also have admin access</td>
</tr>
</tbody>
</table>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">2.6 Gallery Tab</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Two sub-tabs:</strong></p>
<h4 class="text-lg font-medium text-gray-600 mt-4 mb-2">Gallery Images Sub-Tab</h4>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Feature</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Upload form</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">File picker (image only), Title (required), Language (English/Spanish), Description</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Upload process</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">File uploaded to Supabase Storage <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">gallery-images</code> bucket, public URL stored in <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_gallery_images</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Image list</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Card layout with thumbnail, title, language, display order, active status, description</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Delete</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Removes from both Supabase Storage and database with confirmation dialog</td>
</tr>
</tbody>
</table>
<h4 class="text-lg font-medium text-gray-600 mt-4 mb-2">Service Images Sub-Tab</h4>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Manages 8 service hero images:</strong></p>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Position</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Service Key</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Display Title</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">1</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">hero-background</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Hero Background Image</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">2</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">expert-technicians</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Expert Technicians</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">3</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">fast-cars</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Quick Service</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">4</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">quality-car-parts</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Quality Parts</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">5</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">bilingual-support</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Bilingual Support</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">6</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">tire-shop</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Tire Services</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">7</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">auto-repair</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Auto Maintenance</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">8</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">specialized-tools</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Specialized Services</td>
</tr>
</tbody>
</table>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Feature</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Image preview</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Live preview showing current image with position and zoom applied</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Horizontal position slider</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Range 0-100%, controls <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">background-position-x</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Vertical position slider</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Range 0-100%, controls <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">background-position-y</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Zoom slider</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Range 100-300%, controls <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">background-size</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Live preview</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Slider changes update the preview image in real time</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">"Live" badge</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Green badge on images currently active on the website (<code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">is_current = true</code>)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Upload new image</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">File picker per service position; marks old image as not current, inserts new as current</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Save position</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Saves position_x, position_y, and scale to database</td>
</tr>
</tbody>
</table>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">2.7 Analytics Tab</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Appointment Statistics:</strong></p>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Metric</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Total Appointments</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">All-time count</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">This Week</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Appointments created in the last 7 days</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">By Status</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Breakdown into New, Confirmed, Completed, Cancelled (4 color-coded cards)</td>
</tr>
</tbody>
</table>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Customer Analysis:</strong></p>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Metric</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Total Customers</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Unique email addresses across all appointments</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Recurring Customers</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Customers with more than one appointment</td>
</tr>
</tbody>
</table>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Messages Overview:</strong></p>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Metric</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Total Messages</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">All contact messages received</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Unread Messages</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Messages with status <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">new</code></td>
</tr>
</tbody>
</table>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Time Tracking:</strong>
- Average appointment duration in minutes (from completed appointments with <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">actual_duration_minutes</code>)
- Shows sample size (number of completed appointments used in calculation)</p>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Employee Performance Table:</strong></p>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Column</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Employee</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Name</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Total</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Total assigned appointments</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Completed</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Completed appointments count</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Total Time</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Sum of all <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">actual_duration_minutes</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Avg Time</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Average minutes per completed appointment</td>
</tr>
</tbody>
</table>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Popular Appointment Times:</strong>
- Top 10 most frequently requested times
- Horizontal bar chart with percentage fill
- Shows formatted time (12-hour AM/PM) and count</p>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">2.8 Realtime Updates</h3>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Subscription</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Table</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Appointments</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_appointments</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Toast notification on INSERT showing customer name; reloads appointment data on any change (INSERT, UPDATE, DELETE)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Contact Messages</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_contact_messages</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Reloads messages on any change</td>
</tr>
</tbody>
</table>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
<li>Uses Supabase Realtime <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">postgres_changes</code> channel</li>
<li>Unique channel name per session via random string</li>
</ul>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">2.9 Account Settings</h3>
<p class="text-gray-600 mb-4 leading-relaxed">Accessible via clicking the admin email/role display in the header. Opens a modal with four setting panels:</p>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Setting</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Admin Notification Email</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">CC address for all appointment confirmations, employee emails, and assignment notifications; stored in <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_settings</code> table</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Update Display Name</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Updates <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">full_name</code> in Supabase Auth user metadata</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Update Email</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Sends confirmation email to both old and new addresses via <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">sb.auth.updateUser()</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Update Password</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Minimum 6 characters, confirmation field required to match; updates via <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">sb.auth.updateUser()</code></td>
</tr>
</tbody>
</table>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">2.10 Utility Functions</h3>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Function</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">showToast(msg, isError)</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Bottom-right toast notification, auto-hides after 3 seconds; green for success, red for error</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">statusBadge(status)</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Returns color-coded HTML badge (blue=new/pending, green=confirmed, gray=completed, red=cancelled, yellow=priority, indigo=read/replied)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">fmtDate(d)</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Formats date string to "Mon DD, YYYY"</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">fmtTime(t)</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Converts 24-hour time to 12-hour AM/PM format</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">fmtDateTime(d)</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Full locale date+time string</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">esc(s)</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">HTML escaping via <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">document.createElement('div').textContent</code> (XSS prevention)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">closeModal(id)</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Adds <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">hidden</code> class to modal by ID</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Modal overlay click</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">All modals close when clicking the semi-transparent overlay</td>
</tr>
</tbody>
</table>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">2.11 Documentation Tab</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Self-documenting admin panel</strong> with three sub-tabs toggled via <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">switchDocsView()</code>:</p>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Sub-Tab</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Content</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Manual</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Full instruction manual for the admin team (Getting Started, Appointments, Messages, Employees, Gallery, Service Images, Analytics, Account Settings, Public Website Features, Troubleshooting)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Features</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Complete feature list documenting every function of the public site, admin dashboard, database schema, and infrastructure</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Improvements</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Prioritized improvement roadmap with Critical, High Priority, Medium Priority, and Low Priority items plus a 4-week action plan</td>
</tr>
</tbody>
</table>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
<li>Sub-tab toggle: <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">switchDocsView(view)</code> shows/hides content divs and updates button styles</li>
<li>Manual sub-tab visible by default; Features and Improvements start hidden</li>
<li>Scrollable content areas with <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">max-h-[75vh] overflow-y-auto</code></li>
<li>All documentation rendered as styled HTML with Tailwind CSS classes</li>
</ul>
<hr class="border-t border-gray-200 my-8">
<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">3. Book Appointment Page</h2>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">File:</strong> <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">public_html/book-appointment/index.html</code> (11 lines)</p>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
<li>Immediate redirect to main site contact form (<code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/#contact</code>)</li>
<li><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;meta http-equiv="refresh" content="0; url=/#contact"&gt;</code> for instant redirect</li>
<li>Fallback <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;a href="/#contact"&gt;</code> link if meta refresh fails</li>
<li>No JavaScript redirect (meta-only approach)</li>
</ul>
<hr class="border-t border-gray-200 my-8">
<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">4. Database Schema</h2>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Backend:</strong> Supabase PostgreSQL
<strong class="font-semibold text-gray-800">Prefix:</strong> <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_</code> for Oregon Tires tables (some legacy tables use <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oregon_tires_</code> prefix)</p>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Tables Overview</h3>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">#</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Table</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Purpose</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Key Columns</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">1</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">admin_accounts</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Admin account registry</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">id, email, full_name, is_active, project_id, user_id</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">2</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_profiles</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">User profile with admin flag</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">id (UUID PK), is_admin, project_id</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">3</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_appointments</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Appointment records (25+ columns)</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">id, first/last_name, email, phone, service, preferred_date/time, status, assigned_employee_id, tire_size, license_plate, vin, service_location, customer_address/city/state/zip, vehicle_id, travel_distance/cost, started_at, completed_at, actual_duration_minutes/seconds, admin_notes</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">4</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_contact_messages</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Contact form submissions</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">id, first/last_name, email, phone, message, status, language</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">5</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_admin_notifications</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Admin notification records</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">id, type, title, message, read, appointment_id</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">6</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_employees</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Employee records</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">id, name, email, phone, role, is_active, color, user_id</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">7</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_employee_schedules</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Weekly employee availability</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">id, employee_id (FK), day_of_week, start_time, end_time, is_available</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">8</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_custom_hours</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Business custom hours per day</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">id, day_of_week (unique), open_time, close_time, is_closed, max_simultaneous_bookings</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">9</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_gallery_images</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Gallery image records</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">id, image_url, title, description, display_order, is_active</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">10</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_service_images</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Service section hero images</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">id, service_key (unique), image_url, alt_text, position_x, position_y, scale, is_current</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">11</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">customer_vehicles</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Customer vehicle records</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">id, customer_name, customer_email, make, model, year, license_plate, vin</td>
</tr>
</tbody>
</table>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Additional Database Objects</h3>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Object</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Type</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_email_logs</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Table</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Stores sent email history (subject, body, recipient, type, resend_message_id)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_settings</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Table</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Key-value settings store (e.g., <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">admin_email</code> notification address)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">get_admin_users</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">RPC Function</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Returns list of admin users with login metadata</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">set_admin_by_email</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">RPC Function</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Grants or revokes admin access by email for a specific project</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">app_role</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Enum Type</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">admin</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">user</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">artist</code></td>
</tr>
</tbody>
</table>
<hr class="border-t border-gray-200 my-8">
<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">5. Infrastructure</h2>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Architecture</h3>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Layer</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Technology</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Frontend</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Static HTML, CSS (Tailwind CDN), vanilla JavaScript</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Backend</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Supabase (PostgreSQL, Auth, Storage, Edge Functions, Realtime)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Hosting</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">cPanel with Apache (<code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">.htaccess</code> configuration)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Build step</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">None -- files served as-is</td>
</tr>
</tbody>
</table>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Supabase Services Used</h3>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Service</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">PostgreSQL</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">All data storage (11+ tables)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Auth</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Email/password login, session management, user metadata</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Storage</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">gallery-images</code> bucket for gallery and service image uploads</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Edge Functions</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">send-appointment-emails</code> (email notifications), <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">create-employee-account</code> (employee onboarding)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Realtime</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Live subscriptions to <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_appointments</code> and <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_contact_messages</code> changes</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">RPC</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">get_admin_users</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">set_admin_by_email</code> database functions</td>
</tr>
</tbody>
</table>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Hosting and Deployment</h3>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Aspect</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Server</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">cPanel/Apache shared hosting</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Source directory</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">public_html/</code> (local development)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Staging directory</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">_uploads/</code> (temporary staging for modified files only)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Deployment method</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Manual file upload -- only changed files, mirroring directory structure</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Path strategy</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Relative paths throughout (no leading <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/</code> on asset references) for cPanel compatibility</td>
</tr>
</tbody>
</table>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Testing</h3>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Framework</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Type</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Config File</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Vitest</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Unit tests</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">vitest.config.js</code></td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Playwright</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">End-to-end tests</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">playwright.config.js</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">playwright.deploy-clean.config.js</code></td>
</tr>
</tbody>
</table>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">File Structure</h3>
<pre class="bg-gray-100 rounded-lg p-4 mb-4 overflow-x-auto text-sm font-mono text-gray-700"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">public_html/
  index.html              # Public website (697 lines)
  admin/
    index.html            # Admin dashboard (~3,870 lines, includes embedded docs)
  book-appointment/
    index.html            # Redirect stub (11 lines)
  assets/
    logo.png              # Site logo
    hero-bg.png           # Hero background fallback
    favicon.png           # Browser favicon
  images/
    expert-technicians.jpg
    fast-cars.jpg
    quality-parts.jpg
    bilingual-service.jpg
    tire-services.jpg
    auto-maintenance.jpg
    specialized-services.jpg
</code></pre>
<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Security Measures</h3>
<table class="w-full border-collapse mb-6">
<thead>
<tr>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Measure</th>
<th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Location</th>
</tr>
</thead>
<tbody>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Admin role verification</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Dashboard login checks <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_profiles.is_admin</code> before granting access</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">XSS prevention</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">esc()</code> function uses <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">textContent</code> assignment for all user-generated content</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">noindex, nofollow</code></td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Admin page excluded from search engines</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Supabase RLS</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Row Level Security on database tables (managed in Supabase)</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Anon key only</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Frontend uses Supabase anonymous key; sensitive operations go through edge functions</td>
</tr>
<tr>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Modal overlay dismissal</td>
<td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Modals close on overlay click to prevent accidental data exposure</td>
</tr>
</tbody>
</table>
<hr class="border-t border-gray-200 my-8">
<p class="text-gray-600 mb-4 leading-relaxed"><em>Document generated from source code analysis of the Oregon Tires Auto Care codebase.</em></p>
</div>
        </div>

        <div id="docs-subtab-improvements" class="hidden p-6 max-h-[75vh] overflow-y-auto scrollbar-thin">
<div class="doc-lang-es hidden">
<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">Oregon Tires Auto Care - Lista de Mejoras</h2>

<blockquote class="border-l-4 border-green-500 pl-4 py-2 mb-4 bg-green-50 rounded-r-lg text-gray-600">
  <p class="text-gray-600 mb-0 leading-relaxed">Mejoras priorizadas basadas en una revisi&oacute;n completa del c&oacute;digo del sitio p&uacute;blico, panel de administraci&oacute;n, .htaccess y esquema de base de datos. Cada elemento incluye severidad, nivel de confianza y soluci&oacute;n sugerida.</p>
</blockquote>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">Cr&iacute;tico (Corregir Inmediatamente)</h2>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">1. Agregar Encabezado de Pol&iacute;tica de Seguridad de Contenido (CSP)</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Severidad:</strong> Cr&iacute;tico | <strong class="font-semibold text-gray-800">Confianza:</strong> 95%</p>
<p class="text-gray-600 mb-4 leading-relaxed">El sitio carga CDNs externos sin restricci&oacute;n de CSP, lo que permite ataques XSS.</p>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">2. Protecci&oacute;n contra Fuerza Bruta en Login de Admin</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Severidad:</strong> Cr&iacute;tico | <strong class="font-semibold text-gray-800">Confianza:</strong> 95%</p>
<p class="text-gray-600 mb-4 leading-relaxed">Implementar l&iacute;mite de intentos de inicio de sesi&oacute;n para prevenir ataques de fuerza bruta. <strong class="font-semibold text-gray-800">Estado:</strong> Implementado (5 intentos, bloqueo de 15 minutos).</p>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">Alto (Corregir Pronto)</h2>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">3. Habilitar Pol&iacute;ticas RLS en Tablas de Supabase</h3>
<p class="text-gray-600 mb-4 leading-relaxed">Asegurar que todas las tablas tengan pol&iacute;ticas de seguridad a nivel de fila (RLS) para prevenir acceso no autorizado.</p>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">4. Validaci&oacute;n de Datos del Lado del Servidor</h3>
<p class="text-gray-600 mb-4 leading-relaxed">Agregar restricciones CHECK y validaci&oacute;n en la base de datos para todos los campos de entrada.</p>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">5. Servicio Worker Mejorado</h3>
<p class="text-gray-600 mb-4 leading-relaxed">Mejorar el service worker para soporte offline completo y actualizaciones de cach&eacute;.</p>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">Medio (Mejoras Recomendadas)</h2>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">6. Optimizaci&oacute;n de Rendimiento</h3>
<p class="text-gray-600 mb-4 leading-relaxed">Minificar JavaScript, optimizar im&aacute;genes, implementar carga diferida para mejorar tiempos de carga.</p>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">7. Accesibilidad (WCAG)</h3>
<p class="text-gray-600 mb-4 leading-relaxed">Mejorar atributos ARIA, contraste de colores, y navegaci&oacute;n por teclado.</p>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">8. Sistema de Notificaciones por Email</h3>
<p class="text-gray-600 mb-4 leading-relaxed">Confirmaciones autom&aacute;ticas por correo para citas nuevas, cambios de estado y mensajes de contacto.</p>

<hr class="border-t border-gray-200 my-8">

<p class="text-gray-600 mb-4 leading-relaxed"><em>Generado a partir de una revisi&oacute;n completa del c&oacute;digo de Oregon Tires Auto Care.</em></p>
</div>
<div class="doc-lang-en">
<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">Oregon Tires Auto Care - Improvements List</h2>

<blockquote class="border-l-4 border-green-500 pl-4 py-2 mb-4 bg-green-50 rounded-r-lg text-gray-600">
  <p class="text-gray-600 mb-0 leading-relaxed">Prioritized improvements based on a full code review of the public site, admin dashboard, .htaccess, and database schema. Each item includes severity, confidence level, and a suggested fix.</p>
</blockquote>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">Critical (Fix Immediately)</h2>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">1. Add Content Security Policy (CSP) Header</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Severity:</strong> Critical | <strong class="font-semibold text-gray-800">Confidence:</strong> 95%</p>

<p class="text-gray-600 mb-4 leading-relaxed">No CSP header exists to prevent XSS attacks. The site loads external CDNs (Tailwind, Supabase) without restriction.</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Add to <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">.htaccess</code>:</p>
<pre class="bg-gray-100 rounded-lg p-4 mb-4 overflow-x-auto text-sm font-mono text-gray-700">Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://unpkg.com; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; img-src 'self' data: https://*.supabase.co; connect-src 'self' https://*.supabase.co; frame-src https://www.google.com; object-src 'none';"</pre>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">2. Add Rate Limiting / Brute-Force Protection on Admin Login</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Severity:</strong> Critical | <strong class="font-semibold text-gray-800">Confidence:</strong> 90%</p>

<p class="text-gray-600 mb-4 leading-relaxed">The <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/admin/</code> login form has no rate limiting, CAPTCHA, or account lockout. Attackers can brute-force passwords indefinitely.</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong></p>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>Add hCaptcha or Cloudflare Turnstile to the login form</li>
  <li>Track failed login attempts in a Supabase table and lock after 5 failures in 15 minutes</li>
  <li>Use a generic error message ("Invalid credentials") to prevent email enumeration</li>
  <li>Remove the hardcoded superadmin email from client-side code</li>
</ul>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">3. Force HTTPS Redirect</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Severity:</strong> Critical | <strong class="font-semibold text-gray-800">Confidence:</strong> 85%</p>

<p class="text-gray-600 mb-4 leading-relaxed">No HTTPS redirect configured. Admin login credentials could be sent in plaintext over HTTP.</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Add to top of <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">.htaccess</code>:</p>
<pre class="bg-gray-100 rounded-lg p-4 mb-4 overflow-x-auto text-sm font-mono text-gray-700">&lt;IfModule mod_rewrite.c&gt;
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
&lt;/IfModule&gt;</pre>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">High Priority (Fix This Week)</h2>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">4. Add Missing SEO Meta Tags</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 100%</p>

<p class="text-gray-600 mb-4 leading-relaxed">Missing: <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">og:url</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">og:image</code>, Twitter Card tags, canonical URL, robots meta tag. Social media shares will have no preview image.</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Add to <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;head&gt;</code>:</p>
<pre class="bg-gray-100 rounded-lg p-4 mb-4 overflow-x-auto text-sm font-mono text-gray-700">&lt;link rel="canonical" href="https://oregontires.com/"&gt;
&lt;meta property="og:url" content="https://oregontires.com/"&gt;
&lt;meta property="og:image" content="https://oregontires.com/assets/og-image.jpg"&gt;
&lt;meta property="og:site_name" content="Oregon Tires Auto Care"&gt;
&lt;meta name="twitter:card" content="summary_large_image"&gt;
&lt;meta name="twitter:title" content="Oregon Tires Auto Care"&gt;
&lt;meta name="twitter:image" content="https://oregontires.com/assets/og-image.jpg"&gt;
&lt;meta name="robots" content="index, follow"&gt;</pre>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Action Required:</strong> Create a 1200x630px branded OG image.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">5. Create robots.txt and sitemap.xml</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 100%</p>

<p class="text-gray-600 mb-4 leading-relaxed">Neither file exists. Search engines can't efficiently crawl the site and crawl budget is wasted on admin pages.</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Create <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">public_html/robots.txt</code>:</p>
<pre class="bg-gray-100 rounded-lg p-4 mb-4 overflow-x-auto text-sm font-mono text-gray-700">User-agent: *
Allow: /
Disallow: /admin/
Sitemap: https://oregontires.com/sitemap.xml</pre>

<p class="text-gray-600 mb-4 leading-relaxed">Create <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">public_html/sitemap.xml</code> with URLs for <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/#services</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/#about</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/#contact</code>.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">6. Add Image Lazy Loading</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 95%</p>

<p class="text-gray-600 mb-4 leading-relaxed">Gallery images load immediately on page load regardless of scroll position. No <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">loading="lazy"</code>, no responsive <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">srcset</code>, no modern image formats (WebP).</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong></p>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>Add <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">loading="lazy" decoding="async"</code> to all gallery <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;img&gt;</code> tags</li>
  <li>Add <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">loading="eager" fetchpriority="high"</code> to the logo (above the fold)</li>
  <li>Convert images to WebP for ~80% size reduction</li>
</ul>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">7. Fix Render-Blocking CDN Scripts</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 90%</p>

<p class="text-gray-600 mb-4 leading-relaxed">Tailwind CSS and Supabase SDK loaded in <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;head&gt;</code> without <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">async</code> or <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">defer</code>, blocking first paint by 500-800ms.</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix (quick):</strong> Add <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">defer</code> to both script tags.</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix (production):</strong> Build Tailwind CSS at compile time (<code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">npx tailwindcss -o styles.css --minify</code>) and load as a <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;link&gt;</code> stylesheet. This eliminates the CDN dependency entirely.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">8. Fix Accessibility: ARIA Labels and Focus Management</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 85%</p>

<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>Mobile menu button has no <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">aria-label</code> or <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">aria-expanded</code></li>
  <li>Language toggle has no <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">aria-label</code></li>
  <li>Admin modals have no <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">role="dialog"</code>, no focus trap, no Escape key close</li>
  <li>No skip-to-content link for keyboard users</li>
</ul>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Add <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">aria-label</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">aria-expanded</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">aria-controls</code> to interactive elements. Add focus trap to modals. Add skip-to-content link after <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;body&gt;</code>.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">9. Fix Color Contrast Failures</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 90%</p>

<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>Yellow-400 button with black text = 1.9:1 ratio (WCAG requires 4.5:1)</li>
  <li>Yellow-200 hover text on dark green = 2.8:1 ratio (fails)</li>
</ul>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Use <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">text-gray-900 font-bold</code> on yellow buttons. Use <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">yellow-300</code> instead of <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">yellow-200</code> for hover states.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">10. Add Form Validation Feedback and Loading State</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 95%</p>

<p class="text-gray-600 mb-4 leading-relaxed">Contact form has no real-time validation, no loading spinner during submission, and the submit button doesn't disable (allowing double-submit).</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong></p>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>Disable submit button and show "Sending..." during async submission</li>
  <li>Add <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">pattern</code> attributes for email and phone validation</li>
  <li>Re-enable button in <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">finally</code> block</li>
</ul>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">Medium Priority (Fix This Month)</h2>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">11. Extract Inline JavaScript to Separate Files</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 85%</p>

<p class="text-gray-600 mb-4 leading-relaxed"><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">index.html</code> has 264 lines of inline JS. <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">admin/index.html</code> has 900+ lines. This prevents browser caching, minification, and requires <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">unsafe-inline</code> in CSP.</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Extract to <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/js/main.js</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/js/admin.js</code>, and shared <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/js/supabase-client.js</code>. Load with <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;script type="module" src="..."&gt;</code>.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">12. Complete Spanish Translations</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 80%</p>

<p class="text-gray-600 mb-4 leading-relaxed">Several UI elements are hardcoded in English:</p>
<ul class="list-disc pl-6 mb-4 space-y-2 text-gray-600">
  <li>"Based on 150+ Google Reviews"</li>
  <li>"View All Reviews on Google"</li>
  <li>Form placeholders</li>
  <li><code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;html lang="en"&gt;</code> never updates when toggling to Spanish</li>
</ul>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Add missing translation keys and update <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">toggleLanguage()</code> to set <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">document.documentElement.lang</code>.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">13. Add Bulk Operations to Admin Panel</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 85%</p>

<p class="text-gray-600 mb-4 leading-relaxed">Admins must update each appointment individually. No bulk select, bulk assign, bulk status change, or CSV export.</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Add checkbox column to appointments table, bulk action toolbar with assign/status/export buttons.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">14. Add Analytics and Error Tracking</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 90%</p>

<p class="text-gray-600 mb-4 leading-relaxed">No Google Analytics, no error tracking (Sentry), no visibility into user behavior, form conversion rates, or JavaScript errors in production.</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Add Google Analytics 4 with custom events for form submissions, language switches, and service views. Add Sentry for JS error tracking.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">15. Enhance Structured Data (Schema.org)</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 85%</p>

<p class="text-gray-600 mb-4 leading-relaxed">Missing: <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">url</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">image</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">geo</code> coordinates, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">aggregateRating</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">sameAs</code> (social profiles), service catalog.</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Add complete AutomotiveBusiness schema with geo coordinates (45.46123, -122.57895), aggregate rating (4.8/5, 150+ reviews), social profiles, and service offerings.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">16. Lazy-Load Google Maps</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 80%</p>

<p class="text-gray-600 mb-4 leading-relaxed">Google Maps iframe loads immediately (~500KB), even for users who never scroll to the contact section.</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Use IntersectionObserver to load the iframe only when the contact section enters the viewport. Show a "Click to load map" placeholder until then.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">17. Add Loading Skeletons for Gallery</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 80%</p>

<p class="text-gray-600 mb-4 leading-relaxed">Gallery shows plain "Loading gallery..." text during Supabase fetch. No visual feedback.</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Replace with animated skeleton cards (<code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">animate-pulse bg-gray-200 rounded-xl h-64</code>) that disappear when images load.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">18. Block Access to Sensitive Files via .htaccess</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 85%</p>

<p class="text-gray-600 mb-4 leading-relaxed">No protection for <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">.sql</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">.env</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">.git</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">package.json</code>, or backup files if accidentally uploaded.</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Add to <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">.htaccess</code>:</p>
<pre class="bg-gray-100 rounded-lg p-4 mb-4 overflow-x-auto text-sm font-mono text-gray-700">&lt;FilesMatch "(\.sql|\.env|\.git|package\.json|\.bak|\.tmp)$"&gt;
    Require all denied
&lt;/FilesMatch&gt;</pre>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">Low Priority (Nice to Have)</h2>

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">19. Standardize Database Table Naming</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 85%</p>

<p class="text-gray-600 mb-4 leading-relaxed">Inconsistent prefixes: <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_profiles</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oregon_tires_contact_messages</code>, <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">customer_vehicles</code> (no prefix).</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Standardize all tables to <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">oretir_</code> prefix.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">20. Make All Phone Numbers Click-to-Call</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 95%</p>

<p class="text-gray-600 mb-4 leading-relaxed">Phone number in top bar is a <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;span&gt;</code>, not an <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;a href="tel:"&gt;</code>. Mobile users can't tap to call.</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Wrap all phone numbers in <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;a href="tel:5033679714"&gt;</code>.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">21. Add Skip-to-Content Link</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 80%</p>

<p class="text-gray-600 mb-4 leading-relaxed">Keyboard users must tab through the entire navigation to reach main content.</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Add a visually hidden link after <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;body&gt;</code> that becomes visible on focus: <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">&lt;a href="#main-content" class="sr-only focus:not-sr-only"&gt;Skip to main content&lt;/a&gt;</code>.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">22. Add Service Worker for Offline Support</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 80%</p>

<p class="text-gray-600 mb-4 leading-relaxed">Site completely breaks offline. Users can't view business hours or phone number from a cached page.</p>

<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Fix:</strong> Create <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">/sw.js</code> that caches the homepage, logo, and hero image for offline access.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">23. Consider Dark Mode Support</h3>
<p class="text-gray-600 mb-4 leading-relaxed">Detect system preference with <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">prefers-color-scheme: dark</code> and apply Tailwind dark mode classes.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">24. Add Web Vitals Monitoring</h3>
<p class="text-gray-600 mb-4 leading-relaxed">Track Core Web Vitals (LCP, FID, CLS) to measure real-user performance and identify regressions.</p>

<hr class="border-t border-gray-200 my-8">

<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">25. Prevent Password Logging on Auth Errors</h3>
<p class="text-gray-600 mb-4 leading-relaxed"><strong class="font-semibold text-gray-800">Confidence:</strong> 80%</p>

<p class="text-gray-600 mb-4 leading-relaxed">Login error handling could inadvertently log credentials. Use generic error messages and avoid <code class="bg-gray-100 px-1.5 py-0.5 rounded text-sm font-mono text-gray-700">console.error(err)</code> on auth failures.</p>

<hr class="border-t border-gray-200 my-8">

<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b border-gray-200">Priority Action Plan</h2>

<div class="overflow-x-auto mb-6">
  <table class="w-full border-collapse mb-6">
    <thead>
      <tr>
        <th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Week</th>
        <th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Focus</th>
        <th class="bg-gray-50 font-semibold text-gray-700 border border-gray-200 px-4 py-2 text-sm text-left">Items</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><strong class="font-semibold text-gray-800">1</strong></td>
        <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Security + SEO</td>
        <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">CSP headers, HTTPS redirect, robots.txt, sitemap.xml, OG image, missing meta tags</td>
      </tr>
      <tr>
        <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><strong class="font-semibold text-gray-800">2</strong></td>
        <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">UX + Accessibility</td>
        <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">ARIA labels, focus management, form validation, color contrast, lazy loading</td>
      </tr>
      <tr>
        <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><strong class="font-semibold text-gray-800">3</strong></td>
        <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Performance + Code Quality</td>
        <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Extract inline JS, build Tailwind at compile time, image optimization, analytics</td>
      </tr>
      <tr>
        <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600"><strong class="font-semibold text-gray-800">4</strong></td>
        <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Admin + Polish</td>
        <td class="border border-gray-200 px-4 py-2 text-sm text-gray-600">Bulk operations, complete translations, service worker, structured data, testing</td>
      </tr>
    </tbody>
  </table>
</div>

<hr class="border-t border-gray-200 my-8">

<p class="text-gray-600 mb-4 leading-relaxed"><em>Generated from a full code review of 5 files: index.html, admin/index.html, book-appointment/index.html, .htaccess, and database schema.</em></p>
</div>
        </div>

      </div>
    </div>
  </div>

<!-- NOTES MODAL -->
<div id="notes-modal" role="dialog" aria-modal="true" aria-labelledby="notes-modal-title" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-overlay">
  <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-lg mx-4 dark:bg-gray-800">
    <div class="flex justify-between items-center mb-4">
      <h3 id="notes-modal-title" class="text-lg font-bold text-gray-800" data-t="adminNotes">Admin Notes</h3>
      <button onclick="closeModal('notes-modal')" aria-label="Close" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
    </div>
    <textarea id="notes-text" rows="5" class="w-full border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" data-t="notesPlaceholder" placeholder="Add notes about this appointment..."></textarea>
    <div class="flex justify-end gap-3 mt-4">
      <button onclick="closeModal('notes-modal')" class="px-4 py-2 text-sm text-gray-600 hover:text-gray-800" data-t="cancelNotes">Cancel</button>
      <button onclick="saveNotes()" class="px-4 py-2 text-sm bg-brand text-white rounded-lg hover:bg-green-700" data-t="saveNotes">Save Notes</button>
    </div>
  </div>
</div>

<!-- ACCOUNT SETTINGS MODAL -->
<div id="account-modal" role="dialog" aria-modal="true" aria-labelledby="account-modal-title" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-overlay">
  <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto dark:bg-gray-800">
    <div class="flex justify-between items-center mb-6">
      <h3 id="account-modal-title" class="text-lg font-bold text-gray-800" data-t="accountSettingsTitle">Account Settings</h3>
      <button onclick="closeModal('account-modal')" aria-label="Close" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
    </div>
    <!-- Notification Email -->
    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
      <h4 class="text-sm font-semibold text-gray-700 mb-2" data-t="notificationEmail">Admin Notification Email</h4>
      <div class="flex gap-2">
        <input id="settings-notification-email" type="email" class="flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" placeholder="notification@email.com">
        <button onclick="updateNotificationEmail()" class="px-4 py-2 text-sm bg-brand text-white rounded-lg hover:bg-green-700" data-t="save">Save</button>
      </div>
    </div>
    <!-- Display Name -->
    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
      <h4 class="text-sm font-semibold text-gray-700 mb-2" data-t="displayName">Update Display Name</h4>
      <div class="flex gap-2">
        <input id="settings-name" type="text" class="flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" placeholder="Your name">
        <button onclick="updateDisplayName()" class="px-4 py-2 text-sm bg-brand text-white rounded-lg hover:bg-green-700" data-t="save">Save</button>
      </div>
    </div>
    <!-- Email -->
    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
      <h4 class="text-sm font-semibold text-gray-700 mb-2" data-t="updateEmail">Update Email</h4>
      <div class="flex gap-2">
        <input id="settings-email" type="email" class="flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" placeholder="New email">
        <button onclick="updateEmail()" class="px-4 py-2 text-sm bg-brand text-white rounded-lg hover:bg-green-700" data-t="save">Save</button>
      </div>
    </div>
    <!-- Password -->
    <div class="p-4 bg-gray-50 rounded-lg">
      <h4 class="text-sm font-semibold text-gray-700 mb-2" data-t="updatePassword">Update Password</h4>
      <div class="space-y-2">
        <input id="settings-password" type="password" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" placeholder="New password (min 6 chars)">
        <input id="settings-password-confirm" type="password" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" placeholder="Confirm new password">
        <button onclick="updatePassword()" class="w-full px-4 py-2 text-sm bg-brand text-white rounded-lg hover:bg-green-700" data-t="updatePassword">Update Password</button>
      </div>
    </div>
  </div>
</div>

<!-- EMAIL MODAL -->
<div id="email-modal" role="dialog" aria-modal="true" aria-labelledby="email-modal-title" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-overlay">
  <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto dark:bg-gray-800">
    <div class="flex justify-between items-center mb-4">
      <h3 id="email-modal-title" class="text-lg font-bold text-gray-800 dark:text-gray-100">Email Details</h3>
      <button onclick="closeModal('email-modal')" aria-label="Close" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
    </div>
    <h4 id="email-modal-subject" class="text-md font-semibold text-gray-700 mb-3 dark:text-gray-200"></h4>
    <div id="email-modal-meta" class="text-sm text-gray-600 space-y-1 mb-4 dark:text-gray-300"></div>
    <div id="email-modal-body" class="border rounded-lg bg-gray-50 p-4 min-h-[200px] overflow-auto max-h-[60vh] dark:bg-gray-700 dark:border-gray-600"></div>
  </div>
</div>

<!-- MESSAGE MODAL -->
<div id="message-modal" role="dialog" aria-modal="true" aria-labelledby="message-modal-title" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-overlay">
  <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-lg mx-4 dark:bg-gray-800">
    <div class="flex justify-between items-center mb-4">
      <h3 id="message-modal-title" class="text-lg font-bold text-gray-800 dark:text-gray-100">Message Details</h3>
      <button onclick="closeModal('message-modal')" aria-label="Close" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
    </div>
    <div id="message-modal-meta" class="text-sm text-gray-600 mb-4 dark:text-gray-300"></div>
    <div id="message-modal-body" class="border rounded-lg bg-gray-50 p-4 min-h-[100px] whitespace-pre-wrap dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100"></div>
    <div id="message-modal-status" class="mt-4"></div>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="hidden fixed bottom-4 right-4 z-50 bg-brand text-white px-6 py-3 rounded-lg shadow-lg transition-all"></div>

<script>
// ===== TRANSLATION SYSTEM =====
let currentLang = 'es'; // Admin defaults to Spanish

const adminT = {
  en: {
    // Login
    adminDashboard: 'Admin Dashboard',
    signInSubtitle: 'Sign in to manage your business',
    emailLabel: 'Email',
    passwordLabel: 'Password',
    signIn: 'Sign In',
    backToWebsite: '\u2190 Back to website',
    // Header
    headerTitle: 'Admin Dashboard',
    managementSubtitle: 'Oregon Tires Management',
    accountSettings: '\u2699\uFE0F Account Settings',
    viewSite: 'View Site',
    signOut: 'Sign Out',
    // Nav Tabs
    tabOverview: 'Overview',
    tabAppointments: 'Appointments',
    tabMessages: 'Messages',
    tabEmployees: 'Employees',
    tabGallery: 'Gallery',
    tabAnalytics: 'Analytics',
    tabDocs: 'Docs',
    // Overview
    dashboardOverview: 'Dashboard Overview',
    totalAppointments: 'Total Appointments',
    pending: 'Pending',
    confirmed: 'Confirmed',
    completed: 'Completed',
    upcoming14Days: 'Upcoming Appointments (14 Days)',
    employeeSchedule: 'Employee Schedule',
    next14Days: 'Next 14 days',
    awaitingConfirmation: 'Awaiting confirmation',
    readyToGo: 'Ready to go',
    finished: 'Finished',
    // Appointments
    appointmentsHeading: 'Appointments',
    calendarSubtitle: 'Calendar view with employee assignment',
    calendarViewBtn: 'Calendar View',
    listViewBtn: 'List View',
    prevDay: '\u25C0 Prev Day',
    nextDay: 'Next Day \u25B6',
    searchPlaceholder: 'Search by name, email, service...',
    allStatus: 'All Status',
    newStatus: 'New',
    cancelled: 'Cancelled',
    thCustomer: 'Customer',
    thService: 'Service',
    thDateTime: 'Date & Time',
    thContact: 'Contact',
    thEmployee: 'Employee',
    thStatus: 'Status',
    thActions: 'Actions',
    // Messages
    messagesWebsiteChanges: 'Messages & Website Changes',
    messagesSubtitle: 'Manage all messages and website change history',
    contactMessages: 'Contact Messages',
    websiteChanges: 'Website Changes',
    thMessage: 'Message',
    thDate: 'Date',
    // Employees
    employeeAdminMgmt: 'Employee & Admin Management',
    employeesSubtitle: 'Manage team members and admin access',
    addNewEmployee: 'Add New Employee',
    nameRequired: 'Name *',
    emailLabel2: 'Email',
    phone: 'Phone',
    role: 'Role',
    save: 'Save',
    cancel: 'Cancel',
    createAdminAccount: 'Create Admin Account',
    // Gallery
    galleryServiceImages: 'Gallery & Service Images',
    gallerySubTab: 'Gallery',
    serviceImagesSubTab: 'Service Images',
    addNewImage: 'Add New Image',
    imageFile: 'Image File *',
    titleRequired: 'Title *',
    language: 'Language',
    description: 'Description',
    uploadAndSave: 'Upload & Save',
    // Analytics
    analyticsDashboard: 'Analytics Dashboard',
    analyticsSubtitle: 'Overview of your business metrics',
    // Docs
    documentation: 'Documentation',
    docsSubtitle: 'Instruction manual, feature list, and improvement roadmap',
    docsManual: 'Manual',
    docsFeatures: 'Features',
    docsImprovements: 'Improvements',
    // Notes Modal
    adminNotes: 'Admin Notes',
    notesPlaceholder: 'Add notes about this appointment...',
    saveNotes: 'Save Notes',
    cancelNotes: 'Cancel',
    // Account Settings Modal
    accountSettingsTitle: 'Account Settings',
    notificationEmail: 'Admin Notification Email',
    displayName: 'Update Display Name',
    updateEmail: 'Update Email',
    updatePassword: 'Update Password',
    // Bulk Operations
    selectAll: 'Select All',
    selected: 'selected',
    selectedCount: '0 selected',
    changeStatus: 'Change Status',
    applyStatus: 'Apply',
    assignEmployee: 'Assign Employee',
    applyAssign: 'Assign',
    exportCsv: 'Export CSV',
    selectStatus: 'Select a status first',
    selectEmployee: 'Select an employee first',
    appointmentsUpdated: 'appointments updated',
    appointmentsAssigned: 'appointments assigned',
    // Dark Mode
    darkMode: 'Dark Mode',
    lightMode: 'Light Mode',
    // Dynamic/JS text
    noAppointments: 'No appointments found',
    noMessages: 'No messages found',
    loading: 'Loading...',
    confirmDelete: 'Are you sure you want to delete this?',
    saved: 'Saved successfully',
    invalidCredentials: 'Invalid credentials',
    accountLocked: 'Too many failed attempts. Please try again in {minutes} minutes.',
    attemptsRemaining: '{count} attempts remaining',
    passwordUpdateFailed: 'Could not update password. Please try again.',
    emailUpdateFailed: 'Could not update email. Please try again.',
    error: 'An error occurred',
    // Service Images
    svcHeroBackground: 'Hero Background Image', svcExpertTechnicians: 'Expert Technicians', svcQuickService: 'Quick Service', svcQualityParts: 'Quality Parts', svcBilingualSupport: 'Bilingual Support', svcTireServices: 'Tire Services', svcAutoMaintenance: 'Auto Maintenance', svcSpecializedServices: 'Specialized Services',
  },
  es: {
    // Login
    adminDashboard: 'Panel de Administraci\u00F3n',
    signInSubtitle: 'Inicia sesi\u00F3n para gestionar tu negocio',
    emailLabel: 'Correo electr\u00F3nico',
    passwordLabel: 'Contrase\u00F1a',
    signIn: 'Iniciar Sesi\u00F3n',
    backToWebsite: '\u2190 Volver al sitio web',
    // Header
    headerTitle: 'Panel de Administraci\u00F3n',
    managementSubtitle: 'Gesti\u00F3n de Oregon Tires',
    accountSettings: '\u2699\uFE0F Configuraci\u00F3n de Cuenta',
    viewSite: 'Ver Sitio',
    signOut: 'Cerrar Sesi\u00F3n',
    // Nav Tabs
    tabOverview: 'Resumen',
    tabAppointments: 'Citas',
    tabMessages: 'Mensajes',
    tabEmployees: 'Empleados',
    tabGallery: 'Galer\u00EDa',
    tabAnalytics: 'Anal\u00EDticas',
    tabDocs: 'Documentos',
    // Overview
    dashboardOverview: 'Resumen del Panel',
    totalAppointments: 'Total de Citas',
    pending: 'Pendientes',
    confirmed: 'Confirmadas',
    completed: 'Completadas',
    upcoming14Days: 'Pr\u00F3ximas Citas (14 D\u00EDas)',
    employeeSchedule: 'Horario de Empleados',
    next14Days: 'Pr\u00F3ximos 14 d\u00EDas',
    awaitingConfirmation: 'Esperando confirmaci\u00F3n',
    readyToGo: 'Listas para atender',
    finished: 'Finalizadas',
    // Appointments
    appointmentsHeading: 'Citas',
    calendarSubtitle: 'Vista de calendario con asignaci\u00F3n de empleados',
    calendarViewBtn: 'Vista Calendario',
    listViewBtn: 'Vista Lista',
    prevDay: '\u25C0 D\u00EDa Anterior',
    nextDay: 'D\u00EDa Siguiente \u25B6',
    searchPlaceholder: 'Buscar por nombre, correo, servicio...',
    allStatus: 'Todos los Estados',
    newStatus: 'Nuevo',
    cancelled: 'Cancelada',
    thCustomer: 'Cliente',
    thService: 'Servicio',
    thDateTime: 'Fecha y Hora',
    thContact: 'Contacto',
    thEmployee: 'Empleado',
    thStatus: 'Estado',
    thActions: 'Acciones',
    // Messages
    messagesWebsiteChanges: 'Mensajes y Cambios del Sitio',
    messagesSubtitle: 'Administrar todos los mensajes e historial de cambios',
    contactMessages: 'Mensajes de Contacto',
    websiteChanges: 'Cambios del Sitio',
    thMessage: 'Mensaje',
    thDate: 'Fecha',
    // Employees
    employeeAdminMgmt: 'Gesti\u00F3n de Empleados y Administradores',
    employeesSubtitle: 'Administrar miembros del equipo y acceso de admin',
    addNewEmployee: 'Agregar Nuevo Empleado',
    nameRequired: 'Nombre *',
    emailLabel2: 'Correo electr\u00F3nico',
    phone: 'Tel\u00E9fono',
    role: 'Rol',
    save: 'Guardar',
    cancel: 'Cancelar',
    createAdminAccount: 'Crear Cuenta de Administrador',
    // Gallery
    galleryServiceImages: 'Galer\u00EDa e Im\u00E1genes de Servicios',
    gallerySubTab: 'Galer\u00EDa',
    serviceImagesSubTab: 'Im\u00E1genes de Servicios',
    addNewImage: 'Agregar Nueva Imagen',
    imageFile: 'Archivo de Imagen *',
    titleRequired: 'T\u00EDtulo *',
    language: 'Idioma',
    description: 'Descripci\u00F3n',
    uploadAndSave: 'Subir y Guardar',
    // Analytics
    analyticsDashboard: 'Panel de Anal\u00EDticas',
    analyticsSubtitle: 'Resumen de las m\u00E9tricas de tu negocio',
    // Docs
    documentation: 'Documentaci\u00F3n',
    docsSubtitle: 'Manual de instrucciones, lista de funciones y mejoras',
    docsManual: 'Manual',
    docsFeatures: 'Caracter\u00EDsticas',
    docsImprovements: 'Mejoras',
    // Notes Modal
    adminNotes: 'Notas de Administraci\u00F3n',
    notesPlaceholder: 'Agregar notas sobre esta cita...',
    saveNotes: 'Guardar Notas',
    cancelNotes: 'Cancelar',
    // Account Settings Modal
    accountSettingsTitle: 'Configuraci\u00F3n de Cuenta',
    notificationEmail: 'Correo de Notificaciones de Admin',
    displayName: 'Actualizar Nombre',
    updateEmail: 'Actualizar Correo',
    updatePassword: 'Actualizar Contrase\u00F1a',
    // Bulk Operations
    selectAll: 'Seleccionar Todo',
    selected: 'seleccionados',
    selectedCount: '0 seleccionados',
    changeStatus: 'Cambiar Estado',
    applyStatus: 'Aplicar',
    assignEmployee: 'Asignar Empleado',
    applyAssign: 'Asignar',
    exportCsv: 'Exportar CSV',
    selectStatus: 'Seleccione un estado primero',
    selectEmployee: 'Seleccione un empleado primero',
    appointmentsUpdated: 'citas actualizadas',
    appointmentsAssigned: 'citas asignadas',
    // Dark Mode
    darkMode: 'Modo Oscuro',
    lightMode: 'Modo Claro',
    // Dynamic/JS text
    noAppointments: 'No se encontraron citas',
    noMessages: 'No se encontraron mensajes',
    loading: 'Cargando...',
    confirmDelete: '\u00BFEst\u00E1s seguro de que deseas eliminar esto?',
    saved: 'Guardado exitosamente',
    invalidCredentials: 'Credenciales inv\u00E1lidas',
    accountLocked: 'Demasiados intentos fallidos. Intente de nuevo en {minutes} minutos.',
    attemptsRemaining: '{count} intentos restantes',
    passwordUpdateFailed: 'No se pudo actualizar la contrase\u00F1a. Int\u00E9ntelo de nuevo.',
    emailUpdateFailed: 'No se pudo actualizar el correo. Int\u00E9ntelo de nuevo.',
    error: 'Ocurri\u00F3 un error',
    // Service Images
    svcHeroBackground: 'Imagen de Fondo Principal', svcExpertTechnicians: 'T\u00E9cnicos Expertos', svcQuickService: 'Servicio R\u00E1pido', svcQualityParts: 'Partes de Calidad', svcBilingualSupport: 'Soporte Biling\u00FCe', svcTireServices: 'Servicios de Llantas', svcAutoMaintenance: 'Mantenimiento Automotriz', svcSpecializedServices: 'Servicios Especializados',
  }
};

function toggleAdminLanguage() {
  currentLang = currentLang === 'en' ? 'es' : 'en';
  document.documentElement.lang = currentLang;
  document.getElementById('admin-lang-toggle').textContent = currentLang === 'en' ? 'ES' : 'EN';
  applyAdminTranslations();
}

function applyAdminTranslations() {
  document.querySelectorAll('[data-t]').forEach(function(el) {
    var key = el.getAttribute('data-t');
    if (adminT[currentLang][key]) {
      if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
        el.placeholder = adminT[currentLang][key];
      } else {
        el.textContent = adminT[currentLang][key];
      }
    }
  });
  // Toggle doc language content
  document.querySelectorAll('.doc-lang-en').forEach(function(el) {
    el.classList.toggle('hidden', currentLang !== 'en');
  });
  document.querySelectorAll('.doc-lang-es').forEach(function(el) {
    el.classList.toggle('hidden', currentLang !== 'es');
  });
}

// ===== DARK MODE =====
function toggleAdminDarkMode() {
  const html = document.documentElement;
  const isDark = html.classList.toggle('dark');
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
  document.getElementById('admin-dark-toggle').textContent = isDark ? '\u2600\uFE0F' : '\uD83C\uDF19';
}

(function() {
  const saved = localStorage.getItem('theme');
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  if (saved === 'dark' || (!saved && prefersDark)) {
    document.documentElement.classList.add('dark');
    const btn = document.getElementById('admin-dark-toggle');
    if (btn) btn.textContent = '\u2600\uFE0F';
  }
})();

// ===== SUPABASE =====
const sb = supabase.createClient(
  'https://vtknmauyvmuaryttnenx.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ0a25tYXV5dm11YXJ5dHRuZW54Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk1MDE1MDgsImV4cCI6MjA2NTA3NzUwOH0._bOyuxj1nRBw3U7Q3qCsDubBNg_EM-VLhQB0y5p9okY'
);

// ===== STATE =====
let appointments = [], messages = [], employees = [], emailLogs = [], galleryImages = [], serviceImages = [];
let currentNotesId = null, apptPage = 1, apptSortBy = 'created', apptSortOrder = 'desc';
let calDate = new Date(), calSelectedDate = new Date();
let adminUsers = [], currentUser = null;

// ===== RATE LIMITING =====
const MAX_LOGIN_ATTEMPTS = 5;
const LOCKOUT_DURATION_MS = 15 * 60 * 1000; // 15 minutes

function getLoginAttempts() {
  const data = JSON.parse(localStorage.getItem('loginAttempts') || '{"count":0,"firstAttempt":0}');
  if (Date.now() - data.firstAttempt > LOCKOUT_DURATION_MS) {
    localStorage.removeItem('loginAttempts');
    return { count: 0, firstAttempt: 0 };
  }
  return data;
}

function recordFailedAttempt() {
  const data = getLoginAttempts();
  if (data.count === 0) {
    data.firstAttempt = Date.now();
  }
  data.count++;
  localStorage.setItem('loginAttempts', JSON.stringify(data));
  return data;
}

function isLockedOut() {
  const data = getLoginAttempts();
  return data.count >= MAX_LOGIN_ATTEMPTS && (Date.now() - data.firstAttempt) < LOCKOUT_DURATION_MS;
}

function clearLoginAttempts() {
  localStorage.removeItem('loginAttempts');
}

function getRemainingLockoutTime() {
  const data = getLoginAttempts();
  const elapsed = Date.now() - data.firstAttempt;
  return Math.max(0, Math.ceil((LOCKOUT_DURATION_MS - elapsed) / 60000));
}

// ===== UTILS =====
function showToast(msg, isError) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = `fixed bottom-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white ${isError ? 'bg-red-600' : 'bg-brand'}`;
  setTimeout(() => t.classList.add('hidden'), 3000);
}
function statusBadge(s) { return `<span class="px-2 py-1 rounded-full text-xs font-medium status-${s||'new'}">${(s||'new').charAt(0).toUpperCase()+(s||'new').slice(1)}</span>`; }
function fmtDate(d) { if(!d) return '‚Äî'; return new Date(d+'T00:00:00').toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}); }
function fmtTime(t) { if(!t) return '‚Äî'; const [h,m]=t.split(':'); const hr=parseInt(h); return `${hr%12||12}:${m} ${hr>=12?'PM':'AM'}`; }
function fmtDateTime(d) { return new Date(d).toLocaleString(); }
function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
function esc(s) { if(!s) return ''; const d=document.createElement('div'); d.textContent=s; return d.innerHTML; }

// ===== AUTH =====
async function checkAdminStatus(uid, email) {
  const { data } = await sb.from('oretir_profiles').select('is_admin, project_id').eq('id', uid).eq('project_id', 'oregon-tires').maybeSingle();
  return data?.is_admin === true;
}

document.getElementById('login-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const email = document.getElementById('login-email').value, password = document.getElementById('login-password').value;
  const errorEl = document.getElementById('login-error'), btn = document.getElementById('login-btn');
  const lockoutEl = document.getElementById('lockout-message');
  btn.textContent = 'Signing in...'; btn.disabled = true; errorEl.classList.add('hidden');

  // Check lockout before attempting login
  if (isLockedOut()) {
    const minutes = getRemainingLockoutTime();
    lockoutEl.textContent = adminT[currentLang].accountLocked.replace('{minutes}', minutes);
    lockoutEl.classList.remove('hidden');
    btn.textContent = adminT[currentLang].signIn || 'Sign In'; btn.disabled = false;
    return;
  }
  lockoutEl.classList.add('hidden');

  try {
    const { data, error } = await sb.auth.signInWithPassword({ email, password });
    if (error) throw error;
    if (!await checkAdminStatus(data.user.id, data.user.email)) { await sb.auth.signOut(); throw new Error(adminT[currentLang].invalidCredentials); }
    clearLoginAttempts();
    showDashboard(data.user);
  } catch (err) {
    const attemptData = recordFailedAttempt();
    if (attemptData.count >= MAX_LOGIN_ATTEMPTS) {
      const minutes = getRemainingLockoutTime();
      lockoutEl.textContent = adminT[currentLang].accountLocked.replace('{minutes}', minutes);
      lockoutEl.classList.remove('hidden');
      errorEl.classList.add('hidden');
    } else {
      const remaining = MAX_LOGIN_ATTEMPTS - attemptData.count;
      const msg = adminT[currentLang].invalidCredentials + '. ' + adminT[currentLang].attemptsRemaining.replace('{count}', remaining);
      errorEl.textContent = msg;
      errorEl.classList.remove('hidden');
    }
  }
  finally { btn.textContent = adminT[currentLang].signIn || 'Sign In'; btn.disabled = false; }
});

async function signOut() { await sb.auth.signOut(); document.getElementById('admin-dashboard').classList.add('hidden'); document.getElementById('login-screen').classList.remove('hidden'); }

(async () => {
  const { data: { session } } = await sb.auth.getSession();
  if (session?.user && await checkAdminStatus(session.user.id, session.user.email)) showDashboard(session.user);
})();

function showDashboard(user) {
  currentUser = user;
  document.getElementById('login-screen').classList.add('hidden');
  document.getElementById('admin-dashboard').classList.remove('hidden');
  document.getElementById('admin-email').textContent = user.email;
  document.getElementById('admin-role').textContent = 'Admin';
  // Pre-fill account settings
  document.getElementById('settings-name').value = user.user_metadata?.full_name || '';
  document.getElementById('settings-email').value = user.email || '';
  loadAllData();
  setupRealtime();
  populateMonthFilter();
}

// ===== DATA =====
async function loadAllData() { await Promise.all([loadAppointments(), loadMessages(), loadEmployees(), loadEmailLogs(), loadGalleryImages(), loadServiceImages(), loadAdminUsers()]); }

async function loadAppointments() {
  const { data } = await sb.from('oretir_appointments').select('*').order('created_at', { ascending: false });
  appointments = data || [];
  renderOverview(); renderAppointments(); renderCalendar();
}
async function loadMessages() {
  const { data } = await sb.from('oretir_contact_messages').select('*').order('created_at', { ascending: false });
  messages = data || [];
  renderMessages(); renderOverview();
}
async function loadEmployees() {
  const { data } = await sb.from('oretir_employees').select('*').order('created_at', { ascending: false });
  employees = data || [];
  renderEmployees(); renderOverview();
  // Populate bulk assign employee dropdown
  var bulkEmpSelect = document.getElementById('bulk-employee');
  if (bulkEmpSelect) {
    var optionsHtml = '<option value="">' + (adminT[currentLang].assignEmployee || 'Assign Employee') + '</option>';
    employees.filter(function(e) { return e.is_active; }).forEach(function(emp) {
      optionsHtml += '<option value="' + emp.id + '">' + esc(emp.name) + '</option>';
    });
    bulkEmpSelect.innerHTML = optionsHtml;
  }
}
async function loadEmailLogs() {
  const { data } = await sb.from('oretir_email_logs').select('*').order('sent_at', { ascending: false }).limit(50);
  emailLogs = data || [];
  renderEmailLogs();
}
async function loadGalleryImages() {
  const { data } = await sb.from('oretir_gallery_images').select('*').order('display_order', { ascending: true });
  galleryImages = data || [];
  renderGallery();
}
async function loadServiceImages() {
  const { data } = await sb.from('oretir_service_images').select('*').eq('is_current', true).order('service_key');
  serviceImages = data || [];
  renderServiceImages();
}
async function loadAdminUsers() {
  const { data } = await sb.rpc('get_admin_users');
  adminUsers = data || [];
  renderEmployees();
}

function setupRealtime() {
  const ch = Math.random().toString(36).substr(2,9);
  sb.channel('admin-rt-'+ch)
    .on('postgres_changes',{event:'*',schema:'public',table:'oretir_appointments'},(p)=>{
      if(p.eventType==='INSERT') showToast(`New appointment from ${p.new?.first_name} ${p.new?.last_name}`);
      loadAppointments();
    })
    .on('postgres_changes',{event:'*',schema:'public',table:'oretir_contact_messages'},()=>loadMessages())
    .subscribe();
}

// ===== MONTH FILTER =====
function populateMonthFilter() {
  const sel = document.getElementById('appt-month');
  for (let i = 0; i < 24; i++) {
    const d = new Date(); d.setMonth(d.getMonth() - i);
    const val = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
    const opt = document.createElement('option');
    opt.value = val;
    opt.textContent = d.toLocaleDateString('en-US',{month:'long',year:'numeric'});
    sel.appendChild(opt);
  }
}

// ===== OVERVIEW =====
function renderOverview() {
  const today = new Date(); today.setHours(0,0,0,0);
  const in14 = new Date(today); in14.setDate(in14.getDate()+14);
  const upcoming = appointments.filter(a => { const d = new Date(a.preferred_date+'T00:00:00'); return d >= today && d < in14; });
  
  document.getElementById('stat-total').textContent = upcoming.length;
  document.getElementById('stat-pending').textContent = upcoming.filter(a=>a.status==='new').length;
  document.getElementById('stat-confirmed').textContent = upcoming.filter(a=>a.status==='confirmed').length;
  document.getElementById('stat-completed').textContent = upcoming.filter(a=>a.status==='completed').length;

  // Upcoming by date
  const container = document.getElementById('overview-upcoming');
  const byDate = {};
  for (let i=0; i<14; i++) { const d = new Date(today); d.setDate(d.getDate()+i); byDate[d.toISOString().split('T')[0]] = []; }
  upcoming.forEach(a => { if(byDate[a.preferred_date]) byDate[a.preferred_date].push(a); });
  
  container.innerHTML = Object.entries(byDate).map(([date, apts]) => {
    const d = new Date(date+'T00:00:00');
    const dayLabel = d.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'});
    const isToday = date === new Date().toISOString().split('T')[0];
    return `<div class="border-l-4 ${apts.length ? 'border-green-600 bg-green-50' : 'border-gray-300'} pl-4 py-2 rounded-r-lg ${isToday ? 'ring-2 ring-yellow-400 bg-yellow-50' : ''}">
      <div class="flex justify-between items-center mb-1">
        <h4 class="font-semibold text-sm ${isToday ? 'text-yellow-800' : ''}">${isToday ? '‚≠ê Today ‚Äî ' : ''}${dayLabel}</h4>
        ${apts.length ? `<span class="text-xs bg-green-600 text-white px-2 py-1 rounded-full font-bold">${apts.length} appt${apts.length>1?'s':''}</span>` : '<span class="text-xs text-gray-400 italic">Open</span>'}
      </div>
      ${apts.length ? apts.slice(0,3).map(a => `<div class="text-sm flex justify-between items-center bg-white p-2 rounded mb-1 border">
        <span><strong>${fmtTime(a.preferred_time)}</strong> ‚Äî ${esc(a.first_name)} ${esc(a.last_name)} <span class="text-gray-500 text-xs">(${esc(a.service)})</span></span>${statusBadge(a.status)}
      </div>`).join('') + (apts.length>3 ? `<p class="text-xs text-gray-400">+${apts.length-3} more</p>` : '') : ''}
    </div>`;
  }).join('');

  // Employee schedule
  const empContainer = document.getElementById('overview-employees');
  const activeEmps = employees.filter(e=>e.is_active);
  empContainer.innerHTML = activeEmps.length ? activeEmps.map(emp => {
    const empApts = upcoming.filter(a=>a.assigned_employee_id===emp.id);
    return `<div class="border rounded-lg p-4">
      <div class="flex justify-between items-center mb-2"><div><h4 class="font-medium">${esc(emp.name)}</h4><p class="text-sm text-gray-500">${esc(emp.email||'')}</p></div>
      <div class="text-right"><p class="text-sm font-medium">${empApts.length} appointments</p><p class="text-xs text-gray-500">~${(empApts.length*1.5).toFixed(1)} hours</p></div></div>
      ${empApts.length ? empApts.slice(0,2).map(a=>`<div class="text-sm flex items-center gap-2 bg-gray-50 p-2 rounded mb-1">üìÖ ${fmtDate(a.preferred_date)} ${fmtTime(a.preferred_time)}</div>`).join('') + (empApts.length>2?`<p class="text-xs text-gray-400">+${empApts.length-2} more</p>`:'') : '<p class="text-sm text-gray-400">No appointments in next 14 days</p>'}
    </div>`;
  }).join('') : '<p class="text-gray-500 text-center py-4">No active employees</p>';
}

// ===== CALENDAR =====
function renderCalendar() {
  const grid = document.getElementById('cal-grid');
  const y = calDate.getFullYear(), m = calDate.getMonth();
  document.getElementById('cal-month-label').textContent = calDate.toLocaleDateString('en-US',{month:'long',year:'numeric'});
  
  const firstDay = new Date(y,m,1).getDay(), daysInMonth = new Date(y,m+1,0).getDate();
  let html = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].map(d=>`<div class="font-bold text-xs text-gray-500 py-1">${d}</div>`).join('');
  for(let i=0;i<firstDay;i++) html += '<div></div>';
  for(let d=1;d<=daysInMonth;d++) {
    const dateStr = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const count = appointments.filter(a=>a.preferred_date===dateStr).length;
    const isSelected = calSelectedDate.toISOString().split('T')[0] === dateStr;
    const isToday = new Date().toISOString().split('T')[0] === dateStr;
    const hasAppts = count > 0;
    let cellClasses = 'p-1 text-center cursor-pointer rounded-lg hover:bg-gray-100 relative';
    if(isSelected) cellClasses += ' bg-brand text-white hover:bg-brand';
    else if(hasAppts) cellClasses += ' bg-green-100 border-2 border-green-500 font-bold';
    if(isToday && !isSelected) cellClasses += ' ring-2 ring-yellow-400';
    html += `<div onclick="selectCalDay('${dateStr}')" class="${cellClasses}">
      <div class="text-sm">${d}</div>
      ${count ? `<div class="text-xs ${isSelected?'text-white/80':'text-green-700'} font-bold">${count} appt${count>1?'s':''}</div>` : ''}
    </div>`;
  }
  grid.innerHTML = html;
  renderCalDay();
}
function selectCalDay(dateStr) { calSelectedDate = new Date(dateStr+'T00:00:00'); renderCalendar(); }
function calNavMonth(dir) { calDate.setMonth(calDate.getMonth()+dir); renderCalendar(); }
function calNavDay(dir) { calSelectedDate.setDate(calSelectedDate.getDate()+dir); calDate = new Date(calSelectedDate); renderCalendar(); }
function renderCalDay() {
  const dateStr = calSelectedDate.toISOString().split('T')[0];
  document.getElementById('cal-day-label').textContent = calSelectedDate.toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric',year:'numeric'});
  const dayApts = appointments.filter(a=>a.preferred_date===dateStr).sort((a,b)=>(a.preferred_time||'').localeCompare(b.preferred_time||''));
  const container = document.getElementById('cal-day-appointments');
  const activeEmps = employees.filter(e=>e.is_active);

  if (!dayApts.length) {
    container.innerHTML = '<div class="text-center py-12 text-gray-500"><div class="text-4xl mb-3">üìÖ</div><p class="text-lg font-medium">No appointments</p><p class="text-sm">This day is open for bookings</p></div>';
    return;
  }

  // Unassigned count
  const unassigned = dayApts.filter(a=>!a.assigned_employee_id).length;
  let headerHtml = '';
  if (unassigned > 0) {
    headerHtml = `<div class="bg-orange-50 border border-orange-300 rounded-lg p-3 mb-4 flex justify-between items-center">
      <span class="text-orange-800 font-medium">‚ö†Ô∏è ${unassigned} unassigned appointment${unassigned>1?'s':''}</span>
      <button onclick="quickAssignDay('${dateStr}')" class="bg-orange-600 text-white px-3 py-1 rounded text-sm hover:bg-orange-700">‚ö° Quick Assign All</button>
    </div>`;
  }

  container.innerHTML = headerHtml + dayApts.map(a => `
    <div class="border rounded-lg p-4 hover:shadow-md transition ${!a.assigned_employee_id ? 'border-orange-300 bg-orange-50/50' : 'hover:bg-gray-50'}">
      <div class="flex justify-between items-start gap-4">
        <div class="flex-1">
          <div class="flex items-center gap-2 mb-1">
            <span class="text-lg font-bold text-brand">${fmtTime(a.preferred_time)}</span>
            ${statusBadge(a.status)}
          </div>
          <h4 class="font-medium">${esc(a.first_name)} ${esc(a.last_name)}</h4>
          <p class="text-sm text-gray-600">${esc(a.service)}</p>
          <p class="text-sm text-gray-500">${esc(a.email)} ${a.phone?'‚Ä¢ '+esc(a.phone):''}</p>
          ${a.message ? `<p class="text-xs text-gray-500 mt-1 italic border-l-2 border-gray-300 pl-2">"${esc(a.message)}"</p>` : ''}
          ${a.admin_notes ? `<p class="text-xs text-blue-600 mt-1">üìù ${esc(a.admin_notes)}</p>` : ''}
        </div>
        <div class="flex flex-col gap-2 min-w-[180px]">
          <div>
            <label class="text-xs font-medium text-gray-500">Employee</label>
            <select onchange="updateApptAssignment('${a.id}',this.value)" class="w-full border rounded px-2 py-1.5 text-sm ${!a.assigned_employee_id ? 'border-orange-400 bg-orange-50' : 'border-green-400 bg-green-50'}">
              <option value="">‚Äî Unassigned ‚Äî</option>
              ${activeEmps.map(e=>`<option value="${e.id}" ${a.assigned_employee_id===e.id?'selected':''}>${esc(e.name)}</option>`).join('')}
            </select>
          </div>
          <div>
            <label class="text-xs font-medium text-gray-500">Status</label>
            <select onchange="updateApptStatus('${a.id}',this.value)" class="w-full border rounded px-2 py-1.5 text-sm">
              <option value="new" ${a.status==='new'?'selected':''}>New</option>
              <option value="confirmed" ${a.status==='confirmed'?'selected':''}>Confirmed</option>
              <option value="completed" ${a.status==='completed'?'selected':''}>Completed</option>
              <option value="cancelled" ${a.status==='cancelled'?'selected':''}>Cancelled</option>
            </select>
          </div>
          <button onclick="openNotesModal('${a.id}')" class="border rounded px-2 py-1 text-xs hover:bg-gray-100 text-center">üìù Notes</button>
        </div>
      </div>
    </div>
  `).join('');
}

// ===== APPOINTMENTS =====
function sortAppts(col) { if(apptSortBy===col) apptSortOrder=apptSortOrder==='asc'?'desc':'asc'; else { apptSortBy=col; apptSortOrder='desc'; } renderAppointments(); }

function renderAppointments() {
  const filter = document.getElementById('appt-filter').value;
  const search = document.getElementById('appt-search').value.toLowerCase();
  const month = document.getElementById('appt-month').value;
  const perPage = document.getElementById('appt-per-page').value;

  let filtered = appointments.filter(a => {
    if (filter !== 'all' && a.status !== filter) return false;
    if (month !== 'all') { const [y,m] = month.split('-'); const ad = new Date(a.preferred_date+'T00:00:00'); if(ad.getFullYear()!==parseInt(y)||ad.getMonth()+1!==parseInt(m)) return false; }
    if (search) { const s = `${a.first_name} ${a.last_name} ${a.email} ${a.phone||''} ${a.service} ${a.status}`.toLowerCase(); if(!s.includes(search)) return false; }
    return true;
  });

  filtered.sort((a,b) => {
    let cmp = 0;
    if(apptSortBy==='customer') cmp=`${a.first_name} ${a.last_name}`.localeCompare(`${b.first_name} ${b.last_name}`);
    else if(apptSortBy==='service') cmp=a.service.localeCompare(b.service);
    else if(apptSortBy==='status') cmp=a.status.localeCompare(b.status);
    else if(apptSortBy==='date') cmp=new Date(a.preferred_date).getTime()-new Date(b.preferred_date).getTime();
    else cmp=new Date(a.created_at).getTime()-new Date(b.created_at).getTime();
    return apptSortOrder==='asc'?cmp:-cmp;
  });

  const showAll = perPage === 'all';
  const pp = showAll ? filtered.length : parseInt(perPage);
  const totalPages = showAll ? 1 : Math.ceil(filtered.length / pp);
  if(apptPage > totalPages) apptPage = totalPages || 1;
  const start = (apptPage-1)*pp, end = start+pp;
  const page = filtered.slice(start, end);

  const tbody = document.getElementById('appointments-table');
  // NOTE: All user data is escaped via esc() helper before insertion ‚Äî XSS-safe
  tbody.innerHTML = page.length ? page.map(a => `
    <tr class="border-b hover:bg-gray-50">
      <td class="px-4 py-3"><input type="checkbox" class="appt-checkbox rounded" value="${a.id}" onchange="updateBulkToolbar()"></td>
      <td class="p-3"><div class="font-medium">${esc(a.first_name)} ${esc(a.last_name)}</div><div class="text-xs text-gray-500">Created: ${new Date(a.created_at).toLocaleDateString()}</div></td>
      <td class="p-3">${esc(a.service)}</td>
      <td class="p-3"><div class="font-medium">${fmtDate(a.preferred_date)}</div><div class="text-xs text-gray-500">${fmtTime(a.preferred_time)}</div>
        ${a.status==='completed'&&a.actual_duration_minutes?`<div class="text-xs text-green-700 font-medium mt-1">Completed in ${a.actual_duration_minutes}min</div>`:''}</td>
      <td class="p-3"><div class="text-sm">${esc(a.email)}</div>${a.phone?`<div class="text-xs text-gray-500">${esc(a.phone)}</div>`:''}</td>
      <td class="p-3 text-sm">${a.assigned_employee_id ? esc(employees.find(e=>e.id===a.assigned_employee_id)?.name||'Unknown') : '<span class="text-gray-400">Unassigned</span>'}</td>
      <td class="p-3">${statusBadge(a.status)}</td>
      <td class="p-3"><div class="flex flex-col gap-1">
        <select onchange="updateApptStatus('${a.id}',this.value)" class="border rounded px-2 py-1 text-xs">
          <option value="new" ${a.status==='new'?'selected':''}>New</option><option value="confirmed" ${a.status==='confirmed'?'selected':''}>Confirmed</option>
          <option value="completed" ${a.status==='completed'?'selected':''}>Completed</option><option value="cancelled" ${a.status==='cancelled'?'selected':''}>Cancelled</option>
        </select>
        <select onchange="updateApptAssignment('${a.id}',this.value)" class="border rounded px-2 py-1 text-xs">
          <option value="">Unassigned</option>${employees.filter(e=>e.is_active).map(e=>`<option value="${e.id}" ${a.assigned_employee_id===e.id?'selected':''}>${esc(e.name)}</option>`).join('')}
        </select>
        <button onclick="openNotesModal('${a.id}')" class="border rounded px-2 py-1 text-xs hover:bg-gray-100">üìù Notes</button>
      </div></td>
    </tr>
  `).join('') : '<tr><td colspan="8" class="p-6 text-center text-gray-500">No appointments found</td></tr>';
  // Reset select-all checkbox and bulk toolbar on re-render
  const selectAllCb = document.getElementById('select-all-appts');
  if (selectAllCb) selectAllCb.checked = false;
  updateBulkToolbar();

  // Pagination
  const pagDiv = document.getElementById('appt-pagination');
  if(totalPages > 1) {
    pagDiv.innerHTML = `<button onclick="apptPage=Math.max(1,apptPage-1);renderAppointments()" class="px-3 py-1 border rounded ${apptPage===1?'opacity-50':'hover:bg-gray-100'}" ${apptPage===1?'disabled':''}>‚Üê Prev</button>` +
      Array.from({length:totalPages},(_,i)=>`<button onclick="apptPage=${i+1};renderAppointments()" class="px-3 py-1 border rounded ${apptPage===i+1?'bg-brand text-white':'hover:bg-gray-100'}">${i+1}</button>`).join('') +
      `<button onclick="apptPage=Math.min(${totalPages},apptPage+1);renderAppointments()" class="px-3 py-1 border rounded ${apptPage===totalPages?'opacity-50':'hover:bg-gray-100'}" ${apptPage===totalPages?'disabled':''}>Next ‚Üí</button>`;
  } else pagDiv.innerHTML = '';
}

// ===== MESSAGES =====
function renderMessages() {
  const tbody = document.getElementById('messages-table');
  tbody.innerHTML = messages.length ? messages.map(m => `
    <tr class="border-b hover:bg-gray-50">
      <td class="p-3 font-medium text-brand-light">${esc(m.first_name)} ${esc(m.last_name)}</td>
      <td class="p-3 text-sm"><div>${esc(m.email)}</div>${m.phone?`<div class="text-xs text-gray-500">${esc(m.phone)}</div>`:''}</td>
      <td class="p-3 text-sm max-w-[400px]">
        <div class="line-clamp-2">${esc(m.message)}</div>
        ${m.message && m.message.length > 80 ? `<button onclick="openMessageModal('${m.id}')" class="text-brand-light text-xs font-medium hover:underline mt-1">Read full message ‚Üí</button>` : ''}
      </td>
      <td class="p-3 text-sm">${new Date(m.created_at).toLocaleDateString()}</td>
      <td class="p-3">
        <select onchange="updateMsgStatus('${m.id}',this.value)" class="border rounded px-2 py-1 text-xs">
          <option value="new" ${m.status==='new'?'selected':''}>New</option><option value="priority" ${m.status==='priority'?'selected':''}>Priority</option><option value="completed" ${m.status==='completed'?'selected':''}>Completed</option>
        </select>
        <button onclick="openMessageModal('${m.id}')" class="border rounded px-2 py-1 text-xs hover:bg-gray-100 mt-1 block w-full">üëÅ View</button>
      </td>
    </tr>
  `).join('') : '<tr><td colspan="5" class="p-6 text-center text-gray-500">No messages found</td></tr>';
}

// ===== EMAIL LOGS =====
function renderEmailLogs() {
  const container = document.getElementById('email-logs-list');
  if(!emailLogs.length) { container.innerHTML = '<div class="bg-white rounded-xl shadow p-8 text-center text-gray-500">üìß No emails have been sent yet.</div>'; return; }
  container.innerHTML = emailLogs.map(log => {
    const typeColors = {appointment_created:'bg-blue-100 text-blue-800',appointment_assigned:'bg-yellow-100 text-yellow-800',appointment_completed:'bg-green-100 text-green-800'};
    const typeLabels = {appointment_created:'Confirmation',appointment_assigned:'Assignment',appointment_completed:'Completion'};
    return `<div class="bg-white rounded-xl shadow p-4 hover:shadow-md transition">
      <div class="flex justify-between items-start">
        <div class="space-y-1">
          <div class="flex gap-2"><span class="px-2 py-1 rounded-full text-xs font-medium ${typeColors[log.email_type]||'bg-gray-100 text-gray-800'}">${typeLabels[log.email_type]||log.email_type}</span>
          <span class="px-2 py-1 rounded-full text-xs font-medium border">${log.recipient_type}</span></div>
          <h4 class="font-medium">${esc(log.subject)}</h4>
        </div>
        <button onclick="viewEmail('${log.id}')" class="border rounded px-3 py-1 text-sm hover:bg-gray-50">üëÅ View</button>
      </div>
      <div class="flex justify-between items-center text-sm text-gray-500 mt-2">
        <div>üë§ ${esc(log.recipient_name)} ‚Ä¢ üìß ${esc(log.recipient_email)}</div>
        <div>üìÖ ${new Date(log.sent_at).toLocaleDateString()} üïê ${new Date(log.sent_at).toLocaleTimeString()}</div>
      </div>
    </div>`;
  }).join('');
}
function viewEmail(id) {
  const log = emailLogs.find(l=>l.id===id); if(!log) return;
  document.getElementById('email-modal-subject').textContent = log.subject;
  document.getElementById('email-modal-meta').innerHTML = `
    <div><strong>To:</strong> ${esc(log.recipient_name)} (${esc(log.recipient_email)})</div>
    <div><strong>Type:</strong> ${esc(log.email_type)}</div>
    <div><strong>Sent:</strong> ${fmtDateTime(log.sent_at)}</div>
    <div><strong>Message ID:</strong> ${esc(log.resend_message_id||'N/A')}</div>`;
  const bodyContainer = document.getElementById('email-modal-body');
  bodyContainer.textContent = '';
  const iframe = document.createElement('iframe');
  iframe.sandbox = 'allow-same-origin';
  iframe.style.cssText = 'width:100%;min-height:200px;border:none;';
  bodyContainer.appendChild(iframe);
  iframe.srcdoc = log.body || '';
  iframe.onload = function() { iframe.style.height = iframe.contentDocument.body.scrollHeight + 'px'; };
  document.getElementById('email-modal').classList.remove('hidden');
}

function openMessageModal(id) {
  const m = messages.find(msg => msg.id === id); if(!m) return;
  document.getElementById('message-modal-meta').innerHTML = `
    <div class="grid grid-cols-2 gap-4">
      <div><strong>Name:</strong> ${esc(m.first_name)} ${esc(m.last_name)}</div>
      <div><strong>Email:</strong> ${esc(m.email)}</div>
      ${m.phone ? `<div><strong>Phone:</strong> ${esc(m.phone)}</div>` : ''}
      <div><strong>Date:</strong> ${new Date(m.created_at).toLocaleString()}</div>
    </div>`;
  document.getElementById('message-modal-body').textContent = m.message;
  document.getElementById('message-modal-status').innerHTML = `
    <select onchange="updateMsgStatus('${m.id}',this.value)" class="border rounded px-3 py-2 text-sm">
      <option value="new" ${m.status==='new'?'selected':''}>New</option>
      <option value="priority" ${m.status==='priority'?'selected':''}>Priority</option>
      <option value="completed" ${m.status==='completed'?'selected':''}>Completed</option>
    </select>`;
  document.getElementById('message-modal').classList.remove('hidden');
}

// ===== EMPLOYEES =====
function toggleAddEmployeeForm() { document.getElementById('add-employee-form').classList.toggle('hidden'); }
function toggleAddAdminForm() { document.getElementById('add-admin-form').classList.toggle('hidden'); }

function renderEmployees() {
  const container = document.getElementById('employees-content');
  const active = employees.filter(e=>e.is_active), inactive = employees.filter(e=>!e.is_active);
  // Find admins not in employee list
  const empEmails = employees.map(e => (e.email||'').toLowerCase()).filter(Boolean);
  const adminOnly = adminUsers.filter(u => !empEmails.includes(u.email.toLowerCase()));
  
  container.innerHTML = `
    <div class="flex justify-end gap-2 mb-4">
      <button onclick="toggleAddEmployeeForm()" class="bg-brand text-white px-4 py-2 rounded-lg text-sm">+ Add Employee</button>
      <button onclick="toggleAddAdminForm()" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm">+ Add Admin</button>
    </div>
    ${adminOnly.length ? `<h3 class="font-bold text-green-700 mb-3">üõ° Dashboard Admins (${adminOnly.length})</h3>
      <div class="space-y-3 mb-6">${adminOnly.map(u => `
        <div class="border border-green-200 rounded-lg bg-green-50 p-4 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="h-10 w-10 bg-green-600 rounded-full flex items-center justify-center text-white font-bold">üõ°</div>
            <div>
              <div class="flex items-center gap-2"><span class="font-medium">${esc(u.name)}</span><span class="bg-green-600 text-white px-2 py-0.5 rounded-full text-xs">Admin</span></div>
              <div class="text-sm text-gray-600">${esc(u.email)}</div>
              <div class="text-sm text-gray-500">${u.last_sign_in_at ? 'Last login: '+new Date(u.last_sign_in_at).toLocaleDateString() : 'Created: '+new Date(u.created_at).toLocaleDateString()}</div>
            </div>
          </div>
          <button onclick="revokeAdmin('${u.id}')" class="text-red-600 border border-red-200 px-3 py-1 rounded-lg text-sm hover:bg-red-50">üóë Revoke Admin</button>
        </div>
      `).join('')}</div>` : ''}
    <h3 class="font-bold text-brand mb-3">Active Employees (${active.length})</h3>
    <div class="space-y-3 mb-6">${active.length ? active.map(renderEmployeeCard).join('') : '<p class="text-gray-500">No active employees</p>'}</div>
    ${inactive.length ? `<h3 class="font-bold text-gray-500 mb-3">Inactive Employees (${inactive.length})</h3><div class="space-y-3">${inactive.map(e=>renderEmployeeCard(e,true)).join('')}</div>` : ''}
  `;
}

function renderEmployeeCard(emp, inactive) {
  const upcoming = appointments.filter(a => a.assigned_employee_id===emp.id && new Date(a.preferred_date+'T00:00:00') >= new Date(new Date().toISOString().split('T')[0]+'T00:00:00'));
  const isEmpAdmin = adminUsers.some(u => u.email && emp.email && u.email.toLowerCase() === emp.email.toLowerCase());
  return `<div class="border rounded-lg p-4 ${inactive?'bg-gray-50':isEmpAdmin?'bg-green-50 border-green-200':'bg-white'}" id="emp-card-${emp.id}">
    <div id="emp-view-${emp.id}">
      <div class="flex items-center justify-between">
        <div class="flex-1">
          <div class="flex items-center gap-2">
            <span class="font-medium">${esc(emp.name)}</span>
            <span class="text-xs px-2 py-1 rounded-full ${emp.role==='Manager'?'bg-blue-100 text-blue-800':'bg-gray-100 text-gray-800'}">${emp.role||'Employee'}</span>
            ${isEmpAdmin?'<span class="text-xs px-2 py-1 rounded-full bg-green-600 text-white">üõ° Admin</span>':''}
            ${inactive?'<span class="text-xs px-2 py-1 rounded-full bg-gray-200 text-gray-600">Inactive</span>':''}
          </div>
          <div class="text-sm text-gray-600">${emp.email?esc(emp.email):''}${emp.email&&emp.phone?' ‚Ä¢ ':''}${emp.phone?esc(emp.phone):''}</div>
          ${!inactive && upcoming.length ? `<div class="mt-2 p-2 bg-blue-50 rounded text-sm">üìÖ <span class="text-blue-800 font-medium">${upcoming.length} upcoming</span>
            ${upcoming[0]?` ‚Ä¢ Next: ${fmtDate(upcoming[0].preferred_date)}`:''}</div>` : ''}
        </div>
        <div class="flex items-center gap-2">
          <button onclick="startEditEmployee('${emp.id}')" class="border rounded px-3 py-1 text-xs text-gray-600 hover:bg-gray-100">‚úèÔ∏è Edit</button>
          <button onclick="toggleEmployeeStatus('${emp.id}',${!emp.is_active})" class="border rounded px-3 py-1 text-xs ${inactive?'text-green-600 hover:bg-green-50':'text-red-600 hover:bg-red-50'}">${inactive?'‚ö° Activate':'‚èª Deactivate'}</button>
          ${!inactive && emp.email && !isEmpAdmin ? `<button onclick="makeAdmin('${esc(emp.email)}','${esc(emp.name)}')" class="border rounded px-3 py-1 text-xs text-blue-600 hover:bg-blue-50">üõ° Make Admin</button>` : ''}
          ${isEmpAdmin ? `<button onclick="revokeAdminByEmail('${esc(emp.email)}')" class="border rounded px-3 py-1 text-xs text-red-600 hover:bg-red-50">üõ° Revoke Admin</button>` : ''}
        </div>
      </div>
    </div>
    <div id="emp-edit-${emp.id}" class="hidden">
      <div class="grid md:grid-cols-4 gap-3 items-end">
        <div><label class="text-xs font-medium">Name *</label><input id="edit-emp-name-${emp.id}" value="${esc(emp.name)}" class="w-full p-2 border rounded mt-1 text-sm"></div>
        <div><label class="text-xs font-medium">Email</label><input id="edit-emp-email-${emp.id}" value="${esc(emp.email||'')}" class="w-full p-2 border rounded mt-1 text-sm"></div>
        <div><label class="text-xs font-medium">Phone</label><input id="edit-emp-phone-${emp.id}" value="${esc(emp.phone||'')}" class="w-full p-2 border rounded mt-1 text-sm"></div>
        <div><label class="text-xs font-medium">Role</label><select id="edit-emp-role-${emp.id}" class="w-full p-2 border rounded mt-1 text-sm"><option value="Employee" ${emp.role==='Employee'?'selected':''}>Employee</option><option value="Manager" ${emp.role==='Manager'?'selected':''}>Manager</option></select></div>
      </div>
      <div class="flex gap-2 mt-3">
        <button onclick="saveEditEmployee('${emp.id}')" class="bg-brand text-white px-4 py-2 rounded-lg text-sm">üíæ Save</button>
        <button onclick="cancelEditEmployee('${emp.id}')" class="border px-4 py-2 rounded-lg text-sm">Cancel</button>
      </div>
    </div>
  </div>`;
}

// ===== GALLERY =====
function toggleAddGalleryForm() { document.getElementById('add-gallery-form').classList.toggle('hidden'); }

function renderGallery() {
  const container = document.getElementById('gallery-grid');
  container.innerHTML = galleryImages.length ? galleryImages.map(img => `
    <div class="border rounded-lg bg-white p-3 flex items-start gap-4">
      <img src="${esc(img.image_url)}" alt="${esc(img.title)}" class="w-20 h-20 object-cover rounded">
      <div class="flex-1">
        <div class="flex justify-between items-start">
          <div><h4 class="font-medium">${esc(img.title)}</h4><p class="text-sm text-gray-600 capitalize">${img.language||'english'} ‚Ä¢ Order: ${img.display_order||0} ‚Ä¢ ${img.is_active!==false?'Active':'Inactive'}</p>
          ${img.description?`<p class="text-sm text-gray-500 mt-1">${esc(img.description)}</p>`:''}</div>
          <button onclick="deleteGalleryImage('${img.id}','${esc(img.image_url)}')" class="text-red-600 border border-red-200 px-2 py-1 rounded text-xs hover:bg-red-50">üóë</button>
        </div>
      </div>
    </div>
  `).join('') : '<div class="text-center py-8 text-gray-500">No gallery images found. Add your first image above.</div>';
}

async function uploadGalleryImage() {
  const file = document.getElementById('gallery-file').files[0];
  const title = document.getElementById('gallery-title').value;
  if(!file||!title) { showToast('Please select a file and enter a title', true); return; }
  const btn = document.getElementById('gallery-upload-btn'); btn.textContent = 'Uploading...'; btn.disabled = true;
  try {
    const ext = file.name.split('.').pop();
    const path = `gallery/${Date.now()}.${ext}`;
    const { error: upErr } = await sb.storage.from('gallery-images').upload(path, file);
    if(upErr) throw upErr;
    const { data: { publicUrl } } = sb.storage.from('gallery-images').getPublicUrl(path);
    const { error } = await sb.from('oretir_gallery_images').insert([{
      title, image_url: publicUrl, description: document.getElementById('gallery-desc').value,
      language: document.getElementById('gallery-lang').value, is_active: true
    }]);
    if(error) throw error;
    showToast('Image uploaded!'); toggleAddGalleryForm(); loadGalleryImages();
    document.getElementById('gallery-file').value=''; document.getElementById('gallery-title').value=''; document.getElementById('gallery-desc').value='';
  } catch(e) { showToast('Upload failed: '+e.message, true); }
  finally { btn.textContent='üíæ Upload & Save'; btn.disabled=false; }
}

async function deleteGalleryImage(id, url) {
  if(!confirm('Delete this image permanently?')) return;
  try {
    const pathMatch = url.match(/gallery-images\/(.+)$/);
    if(pathMatch) await sb.storage.from('gallery-images').remove([pathMatch[1]]);
    await sb.from('oretir_gallery_images').delete().eq('id', id);
    showToast('Image deleted'); loadGalleryImages();
  } catch(e) { showToast('Delete failed', true); }
}

// ===== ASSET PATH NORMALIZER =====
const ASSET_PATH_MAP = {
  '1290fb5e-e45c-4fc3-b523-e71d756ec1ef.png': 'logo.png',
  'afc0de17-b407-4b29-b6a2-6f44d5dcad0d.png': 'hero-bg.png',
  'b0182aa8-dde3-4175-8f09-21b6122f47f4.png': 'favicon.png',
};
function normalizeAssetPath(url) {
  if (!url || typeof url !== 'string') return url;
  if (!url.includes('/lovable-uploads/')) return url;
  let normalized = url.replace('/lovable-uploads/', '/assets/');
  for (const [uuid, name] of Object.entries(ASSET_PATH_MAP))
    normalized = normalized.replace(uuid, name);
  return normalized;
}

// ===== SERVICE IMAGES =====
function renderServiceImages() {
  const services = [
    {key:'hero-background',tKey:'svcHeroBackground'},{key:'expert-technicians',tKey:'svcExpertTechnicians'},
    {key:'fast-cars',tKey:'svcQuickService'},{key:'quality-car-parts',tKey:'svcQualityParts'},
    {key:'bilingual-support',tKey:'svcBilingualSupport'},{key:'tire-shop',tKey:'svcTireServices'},
    {key:'auto-repair',tKey:'svcAutoMaintenance'},{key:'specialized-tools',tKey:'svcSpecializedServices'}
  ];
  const container = document.getElementById('service-images-grid');
  const matched = services.map(s => ({ ...s, img: serviceImages.find(i=>i.service_key===s.key) }));
  container.innerHTML = matched.map(s => {
    const title = (adminT[currentLang] && adminT[currentLang][s.tKey]) || s.key;
    const imgUrl = s.img ? normalizeAssetPath(s.img.image_url) : null;
    return `
    <div class="bg-white rounded-xl shadow overflow-hidden">
      <div class="p-4"><h3 class="font-bold text-brand">${title}</h3><p class="text-xs text-gray-500">${s.key}</p></div>
      <div class="relative h-48 bg-gray-100 overflow-hidden">
        ${imgUrl ? `<div class="absolute inset-0 bg-cover" style="background-image:url(${imgUrl});background-position:${s.img.position_x||50}% ${s.img.position_y||50}%;background-size:${(s.img.scale||1)*100}%"></div>
          <div class="absolute inset-0 bg-black/30"></div>
          <div class="absolute top-2 right-2"><span class="bg-green-500 text-white px-2 py-1 rounded-full text-xs">üïê Live</span></div>`
          : '<div class="flex items-center justify-center h-full text-gray-400">No image uploaded</div>'}
      </div>
      ${s.img ? `<div class="p-4 border-t bg-gray-50 space-y-3">
        <div>
          <label class="text-xs font-medium text-gray-600">Horizontal Position: <span id="pos-x-val-${s.key}">${s.img.position_x||50}%</span></label>
          <input type="range" min="0" max="100" value="${s.img.position_x||50}" id="pos-x-${s.key}" oninput="document.getElementById('pos-x-val-${s.key}').textContent=this.value+'%';previewPosition('${s.key}')" class="w-full h-2 accent-green-700">
        </div>
        <div>
          <label class="text-xs font-medium text-gray-600">Vertical Position: <span id="pos-y-val-${s.key}">${s.img.position_y||50}%</span></label>
          <input type="range" min="0" max="100" value="${s.img.position_y||50}" id="pos-y-${s.key}" oninput="document.getElementById('pos-y-val-${s.key}').textContent=this.value+'%';previewPosition('${s.key}')" class="w-full h-2 accent-green-700">
        </div>
        <div>
          <label class="text-xs font-medium text-gray-600">Zoom: <span id="scale-val-${s.key}">${((s.img.scale||1)*100).toFixed(0)}%</span></label>
          <input type="range" min="100" max="300" value="${((s.img.scale||1)*100).toFixed(0)}" id="scale-${s.key}" oninput="document.getElementById('scale-val-${s.key}').textContent=this.value+'%';previewPosition('${s.key}')" class="w-full h-2 accent-green-700">
        </div>
        <button onclick="saveImagePosition('${s.key}','${s.img.id}')" class="bg-brand text-white px-4 py-2 rounded-lg text-sm w-full">üíæ Save Position & Crop</button>
      </div>` : ''}
      <div class="p-4 border-t">
        <label class="text-sm font-medium">Upload New Image</label>
        <div class="flex gap-2 mt-1">
          <input type="file" accept="image/*" id="svc-file-${s.key}" class="flex-1 text-sm border rounded p-1">
          <button onclick="uploadServiceImage('${s.key}')" class="bg-brand text-white px-3 py-1 rounded text-sm">‚¨Ü Upload</button>
        </div>
      </div>
    </div>
  `}).join('');
}

function previewPosition(key) {
  const card = document.querySelector(`#service-images-grid [style*="${key}"]`)?.closest('.relative');
  if (!card) return;
  const bg = card.querySelector('[style*="background-image"]');
  if (!bg) return;
  const x = document.getElementById('pos-x-'+key)?.value || 50;
  const y = document.getElementById('pos-y-'+key)?.value || 50;
  const s = document.getElementById('scale-'+key)?.value || 100;
  bg.style.backgroundPosition = `${x}% ${y}%`;
  bg.style.backgroundSize = `${s}%`;
}

async function saveImagePosition(key, imageId) {
  const x = parseInt(document.getElementById('pos-x-'+key)?.value || 50);
  const y = parseInt(document.getElementById('pos-y-'+key)?.value || 50);
  const s = parseInt(document.getElementById('scale-'+key)?.value || 100) / 100;
  try {
    const { error } = await sb.from('oretir_service_images').update({ position_x: x, position_y: y, scale: s }).eq('id', imageId);
    if (error) throw error;
    showToast('Position saved & live on website!');
    loadServiceImages();
  } catch(e) { showToast('Save failed: '+e.message, true); }
}

async function uploadServiceImage(key) {
  const input = document.getElementById('svc-file-'+key);
  const file = input?.files?.[0]; if(!file) { showToast('Select a file first', true); return; }
  try {
    const ext = file.name.split('.').pop();
    const path = `service-images/${key}-${Date.now()}.${ext}`;
    const { error: upErr } = await sb.storage.from('gallery-images').upload(path, file);
    if(upErr) throw upErr;
    const { data: { publicUrl } } = sb.storage.from('gallery-images').getPublicUrl(path);
    // Mark old as not current
    await sb.from('oretir_service_images').update({is_current:false}).eq('service_key',key);
    // Insert new
    const svcTitles = {'hero-background':'Hero Background','expert-technicians':'Expert Technicians','fast-cars':'Quick Service','quality-car-parts':'Quality Parts','bilingual-support':'Bilingual Support','tire-shop':'Tire Services','auto-repair':'Auto Maintenance','specialized-tools':'Specialized Services'};
    await sb.from('oretir_service_images').insert([{service_key:key,title:svcTitles[key]||key,image_url:publicUrl,is_current:true}]);
    showToast('Image is now live!'); input.value=''; loadServiceImages();
  } catch(e) { showToast('Upload failed: '+e.message, true); }
}

// ===== ANALYTICS =====
function renderAnalytics() {
  const total = appointments.length;
  const newA = appointments.filter(a=>a.status==='new').length;
  const confirmed = appointments.filter(a=>a.status==='confirmed').length;
  const completed = appointments.filter(a=>a.status==='completed').length;
  const cancelled = appointments.filter(a=>a.status==='cancelled').length;
  const thisWeek = new Date(); thisWeek.setDate(thisWeek.getDate()-7);
  const recent = appointments.filter(a=>new Date(a.created_at)>thisWeek).length;
  const totalMsgs = messages.length;
  const unreadMsgs = messages.filter(m=>m.status==='new').length;

  // Customers
  const custMap = {};
  appointments.forEach(a => {
    const k = a.email.toLowerCase();
    if(!custMap[k]) custMap[k] = {name:`${a.first_name} ${a.last_name}`,email:a.email,count:0,services:[]};
    custMap[k].count++; custMap[k].services.push(a.service);
  });
  const totalCustomers = Object.keys(custMap).length;
  const recurring = Object.values(custMap).filter(c=>c.count>1).length;

  // Avg time
  const withTime = appointments.filter(a=>a.status==='completed'&&a.actual_duration_minutes);
  const avgTime = withTime.length ? Math.round(withTime.reduce((s,a)=>s+(a.actual_duration_minutes||0),0)/withTime.length) : 0;

  // Employee stats
  const empStats = employees.filter(e=>e.is_active).map(e => {
    const eApts = appointments.filter(a=>a.assigned_employee_id===e.id);
    const eDone = eApts.filter(a=>a.status==='completed'&&a.actual_duration_minutes);
    const totalTime = eDone.reduce((s,a)=>s+(a.actual_duration_minutes||0),0);
    return { name: e.name, total: eApts.length, completed: eDone.length, totalTime, avgTime: eDone.length ? Math.round(totalTime/eDone.length) : 0 };
  });

  // Time frequency
  const timeCounts = {};
  appointments.forEach(a => { timeCounts[a.preferred_time] = (timeCounts[a.preferred_time]||0)+1; });
  const topTimes = Object.entries(timeCounts).sort((a,b)=>b[1]-a[1]).slice(0,10);

  document.getElementById('analytics-content').innerHTML = `
    <div class="grid md:grid-cols-2 gap-6 mb-6">
      <div class="bg-gray-50 p-4 rounded-lg border hover:bg-gray-100 cursor-pointer"><h3 class="font-semibold">Total Appointments</h3><p class="text-3xl font-bold text-brand">${total}</p></div>
      <div class="bg-gray-50 p-4 rounded-lg border hover:bg-gray-100 cursor-pointer"><h3 class="font-semibold">This Week</h3><p class="text-3xl font-bold text-brand">${recent}</p></div>
    </div>
    <div class="grid md:grid-cols-4 gap-4 mb-6">
      <div class="bg-blue-50 p-4 rounded-lg border"><h3 class="text-sm text-blue-800">New</h3><p class="text-2xl font-bold text-blue-600">${newA}</p></div>
      <div class="bg-green-50 p-4 rounded-lg border"><h3 class="text-sm text-green-800">Confirmed</h3><p class="text-2xl font-bold text-green-600">${confirmed}</p></div>
      <div class="bg-gray-50 p-4 rounded-lg border"><h3 class="text-sm text-gray-800">Completed</h3><p class="text-2xl font-bold text-gray-600">${completed}</p></div>
      <div class="bg-red-50 p-4 rounded-lg border"><h3 class="text-sm text-red-800">Cancelled</h3><p class="text-2xl font-bold text-red-600">${cancelled}</p></div>
    </div>
    <div class="grid md:grid-cols-2 gap-6 mb-6">
      <div class="bg-white rounded-xl shadow p-6">
        <h3 class="text-lg font-bold text-brand mb-4">üì¨ Messages</h3>
        <div class="grid grid-cols-2 gap-4">
          <div class="bg-gray-50 p-4 rounded-lg"><p class="text-sm text-gray-600">Total</p><p class="text-2xl font-bold">${totalMsgs}</p></div>
          <div class="bg-gray-50 p-4 rounded-lg"><p class="text-sm text-gray-600">Unread</p><p class="text-2xl font-bold text-blue-600">${unreadMsgs}</p></div>
        </div>
      </div>
      <div class="bg-white rounded-xl shadow p-6">
        <h3 class="text-lg font-bold text-brand mb-4">üë• Customers</h3>
        <div class="grid grid-cols-2 gap-4">
          <div class="bg-gray-50 p-4 rounded-lg"><p class="text-sm text-gray-600">Total</p><p class="text-2xl font-bold">${totalCustomers}</p></div>
          <div class="bg-purple-50 p-4 rounded-lg"><p class="text-sm text-gray-600">Recurring</p><p class="text-2xl font-bold text-purple-600">${recurring}</p></div>
        </div>
      </div>
    </div>
    ${avgTime ? `<div class="bg-white rounded-xl shadow p-6 mb-6"><h3 class="text-lg font-bold text-brand mb-4">‚è± Time Tracking</h3>
      <p>Average appointment time: <strong>${avgTime} minutes</strong> (from ${withTime.length} completed)</p></div>` : ''}
    ${empStats.length ? `<div class="bg-white rounded-xl shadow p-6 mb-6"><h3 class="text-lg font-bold text-brand mb-4">üë∑ Employee Performance</h3>
      <table class="w-full text-sm"><thead><tr class="border-b"><th class="text-left p-2">Employee</th><th class="p-2">Total</th><th class="p-2">Completed</th><th class="p-2">Total Time</th><th class="p-2">Avg Time</th></tr></thead>
      <tbody>${empStats.map(e=>`<tr class="border-b"><td class="p-2 font-medium">${esc(e.name)}</td><td class="p-2 text-center">${e.total}</td><td class="p-2 text-center">${e.completed}</td><td class="p-2 text-center">${e.totalTime}min</td><td class="p-2 text-center">${e.avgTime}min</td></tr>`).join('')}</tbody></table></div>` : ''}
    ${topTimes.length ? `<div class="bg-white rounded-xl shadow p-6"><h3 class="text-lg font-bold text-brand mb-4">üïê Popular Appointment Times</h3>
      <div class="space-y-2">${topTimes.map(([time,count])=>{
        const pct = Math.round(count/total*100);
        return `<div class="flex items-center gap-3"><span class="w-20 text-sm font-medium">${fmtTime(time)}</span><div class="flex-1 bg-gray-200 rounded-full h-4"><div class="bg-brand rounded-full h-4" style="width:${pct}%"></div></div><span class="text-sm text-gray-600">${count}</span></div>`;
      }).join('')}</div></div>` : ''}
  `;
}

// ===== ACTIONS =====
async function updateApptStatus(id, status) {
  if(status==='confirmed') { const a=appointments.find(x=>x.id===id); if(!a?.assigned_employee_id) { showToast('Assign an employee before confirming',true); loadAppointments(); return; } }
  const { error } = await sb.from('oretir_appointments').update({ status }).eq('id', id);
  if(error) { showToast('Error: '+error.message, true); return; }
  showToast(`Status ‚Üí ${status}`);
  // Send email on completion
  if(status==='completed') { try { await sb.functions.invoke('send-appointment-emails',{body:{type:'appointment_completed',appointmentId:id}}); } catch(e){} }
  loadAppointments();
}

async function updateApptAssignment(id, empId) {
  const update = { assigned_employee_id: empId || null };
  if(empId) update.status = 'confirmed';
  const { error } = await sb.from('oretir_appointments').update(update).eq('id', id);
  if(error) { showToast('Error: '+error.message, true); return; }
  showToast(empId ? 'Employee assigned & confirmed' : 'Assignment removed');
  if(empId) { try { await sb.functions.invoke('send-appointment-emails',{body:{type:'appointment_assigned',appointmentId:id}}); } catch(e){} }
  loadAppointments();
}

// ===== BULK OPERATIONS =====
function toggleSelectAll(checked) {
  document.querySelectorAll('.appt-checkbox').forEach(function(cb) { cb.checked = checked; });
  updateBulkToolbar();
}

function updateBulkToolbar() {
  const checked = document.querySelectorAll('.appt-checkbox:checked');
  const toolbar = document.getElementById('bulk-toolbar');
  const countEl = document.getElementById('bulk-count');
  if (!toolbar || !countEl) return;
  if (checked.length > 0) {
    toolbar.classList.remove('hidden');
    countEl.textContent = checked.length + ' ' + (adminT[currentLang].selected || 'selected');
  } else {
    toolbar.classList.add('hidden');
  }
}

async function applyBulkStatus() {
  const status = document.getElementById('bulk-status').value;
  if (!status) { showToast(adminT[currentLang].selectStatus || 'Select a status first', true); return; }
  const ids = Array.from(document.querySelectorAll('.appt-checkbox:checked')).map(function(cb) { return cb.value; });
  if (!ids.length) return;
  for (var i = 0; i < ids.length; i++) {
    await sb.from('oretir_appointments').update({ status: status }).eq('id', ids[i]);
  }
  showToast(ids.length + ' ' + (adminT[currentLang].appointmentsUpdated || 'appointments updated'));
  loadAppointments();
}

async function applyBulkAssign() {
  const empId = document.getElementById('bulk-employee').value;
  if (!empId) { showToast(adminT[currentLang].selectEmployee || 'Select an employee first', true); return; }
  const ids = Array.from(document.querySelectorAll('.appt-checkbox:checked')).map(function(cb) { return cb.value; });
  if (!ids.length) return;
  for (var i = 0; i < ids.length; i++) {
    await sb.from('oretir_appointments').update({ assigned_employee_id: empId, status: 'confirmed' }).eq('id', ids[i]);
  }
  showToast(ids.length + ' ' + (adminT[currentLang].appointmentsAssigned || 'appointments assigned'));
  loadAppointments();
}

function exportAppointmentsCsv() {
  const rows = document.querySelectorAll('#appointments-table tr');
  if (!rows.length || (rows.length === 1 && rows[0].querySelector('td[colspan]'))) {
    showToast(adminT[currentLang].noAppointments || 'No appointments to export', true);
    return;
  }
  const headers = ['Customer', 'Service', 'Date', 'Time', 'Phone', 'Email', 'Employee', 'Status'];
  var csv = headers.join(',') + '\n';
  rows.forEach(function(row) {
    var cells = row.querySelectorAll('td');
    if (cells.length >= 8) {
      var rowData = Array.from(cells).slice(1, -1).map(function(cell) {
        var text = cell.textContent.trim().replace(/"/g, '""');
        return '"' + text + '"';
      });
      csv += rowData.join(',') + '\n';
    }
  });
  var blob = new Blob([csv], { type: 'text/csv' });
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a');
  a.href = url;
  a.download = 'appointments-' + new Date().toISOString().slice(0, 10) + '.csv';
  a.click();
  URL.revokeObjectURL(url);
}

async function updateMsgStatus(id, status) {
  const { error } = await sb.from('oretir_contact_messages').update({ status }).eq('id', id);
  if(error) { showToast('Error', true); return; }
  showToast(`Message ‚Üí ${status}`); loadMessages();
}

function openNotesModal(id) {
  currentNotesId = id;
  const a = appointments.find(x=>x.id===id);
  document.getElementById('notes-text').value = a?.admin_notes || '';
  document.getElementById('notes-modal').classList.remove('hidden');
}
async function saveNotes() {
  if(!currentNotesId) return;
  const notes = document.getElementById('notes-text').value;
  await sb.from('oretir_appointments').update({ admin_notes: notes }).eq('id', currentNotesId);
  showToast('Notes saved'); closeModal('notes-modal'); loadAppointments();
}

async function addEmployee() {
  const name = document.getElementById('new-emp-name').value;
  const email = document.getElementById('new-emp-email').value || null;
  if(!name) { showToast('Name is required', true); return; }
  const { error } = await sb.from('oretir_employees').insert([{
    name, email,
    phone: document.getElementById('new-emp-phone').value||null,
    role: document.getElementById('new-emp-role').value
  }]);
  if(error) { showToast('Error: '+error.message, true); return; }
  // Create auth account so employee can log in (if email provided)
  if(email) {
    try {
      await sb.functions.invoke('create-employee-account', { body: { email, employeeName: name } });
      showToast('Employee added & login credentials sent via email!');
    } catch(e) { showToast('Employee added but could not send login email: ' + e.message, true); }
  } else {
    showToast('Employee added!');
  }
  toggleAddEmployeeForm();
  document.getElementById('new-emp-name').value=''; document.getElementById('new-emp-email').value='';
  document.getElementById('new-emp-phone').value=''; loadEmployees();
}

async function toggleEmployeeStatus(id, newStatus) {
  await sb.from('oretir_employees').update({ is_active: newStatus }).eq('id', id);
  showToast(`Employee ${newStatus?'activated':'deactivated'}`); loadEmployees();
}

function startEditEmployee(id) {
  document.getElementById('emp-view-'+id).classList.add('hidden');
  document.getElementById('emp-edit-'+id).classList.remove('hidden');
}
function cancelEditEmployee(id) {
  document.getElementById('emp-edit-'+id).classList.add('hidden');
  document.getElementById('emp-view-'+id).classList.remove('hidden');
}
async function saveEditEmployee(id) {
  const name = document.getElementById('edit-emp-name-'+id).value;
  if(!name) { showToast('Name is required', true); return; }
  const { error } = await sb.from('oretir_employees').update({
    name, email: document.getElementById('edit-emp-email-'+id).value || null,
    phone: document.getElementById('edit-emp-phone-'+id).value || null,
    role: document.getElementById('edit-emp-role-'+id).value
  }).eq('id', id);
  if(error) { showToast('Error: '+error.message, true); return; }
  showToast('Employee updated!'); loadEmployees();
}

async function makeAdmin(email, name) {
  try {
    const { error } = await sb.rpc('set_admin_by_email', { user_email: email, admin_status: true, target_project_id: 'oregon-tires' });
    if(error) {
      if(error.message.includes('not found')) {
        await sb.functions.invoke('create-employee-account', { body: { email, employeeName: name } });
        await sb.rpc('set_admin_by_email', { user_email: email, admin_status: true, target_project_id: 'oregon-tires' });
        showToast('Account created & admin access granted');
      } else throw error;
    } else showToast('Admin access granted');
    loadAdminUsers();
  } catch(e) { showToast('Failed: '+e.message, true); }
}

async function addAdmin() {
  const email = document.getElementById('new-admin-email').value;
  if(!email) return;
  await makeAdmin(email, email.split('@')[0]);
  document.getElementById('new-admin-email').value=''; toggleAddAdminForm();
}

async function revokeAdmin(userId) {
  if(!confirm('Revoke admin access?')) return;
  await sb.from('oretir_profiles').update({ is_admin: false }).eq('id', userId);
  showToast('Admin access revoked'); loadAdminUsers(); loadEmployees();
}

async function revokeAdminByEmail(email) {
  if(!confirm('Revoke admin access for ' + email + '?')) return;
  const admin = adminUsers.find(u => u.email.toLowerCase() === email.toLowerCase());
  if(admin) {
    await sb.from('oretir_profiles').update({ is_admin: false }).eq('id', admin.id);
    showToast('Admin access revoked'); loadAdminUsers(); loadEmployees();
  } else { showToast('Admin not found', true); }
}

// ===== TAB SWITCHING =====
function switchTab(tab) {
  document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
  document.querySelectorAll('.tab-btn').forEach(el => { el.classList.remove('tab-active'); el.classList.add('text-white','hover:bg-green-600'); el.setAttribute('aria-selected', 'false'); });
  document.getElementById('tab-' + tab).classList.remove('hidden');
  const btn = document.querySelector(`.tab-btn[data-tab="${tab}"]`);
  if(btn) { btn.classList.add('tab-active'); btn.classList.remove('text-white','hover:bg-green-600'); btn.setAttribute('aria-selected', 'true'); }
  if(tab==='analytics') renderAnalytics();
  if(tab==='appointments') renderCalendar();
}

// Sub-tab switching for Appointments (Calendar vs List)
function switchApptView(view) {
  document.getElementById('appt-subtab-calendar').classList.toggle('hidden', view !== 'calendar');
  document.getElementById('appt-subtab-list').classList.toggle('hidden', view !== 'list');
  document.getElementById('appt-view-calendar').className = view === 'calendar' ? 'px-4 py-2 rounded-lg text-sm font-medium bg-brand text-white' : 'px-4 py-2 rounded-lg text-sm font-medium border hover:bg-gray-50';
  document.getElementById('appt-view-list').className = view === 'list' ? 'px-4 py-2 rounded-lg text-sm font-medium bg-brand text-white' : 'px-4 py-2 rounded-lg text-sm font-medium border hover:bg-gray-50';
  if(view === 'calendar') renderCalendar();
  if(view === 'list') renderAppointments();
}

// Sub-tab switching for Documentation (Manual / Features / Improvements)
function switchDocsView(view) {
  document.getElementById('docs-subtab-manual').classList.toggle('hidden', view !== 'manual');
  document.getElementById('docs-subtab-features').classList.toggle('hidden', view !== 'features');
  document.getElementById('docs-subtab-improvements').classList.toggle('hidden', view !== 'improvements');
  document.getElementById('docs-view-manual').className = view === 'manual' ? 'px-4 py-2 rounded-lg text-sm font-medium bg-brand text-white' : 'px-4 py-2 rounded-lg text-sm font-medium border hover:bg-gray-50';
  document.getElementById('docs-view-features').className = view === 'features' ? 'px-4 py-2 rounded-lg text-sm font-medium bg-brand text-white' : 'px-4 py-2 rounded-lg text-sm font-medium border hover:bg-gray-50';
  document.getElementById('docs-view-improvements').className = view === 'improvements' ? 'px-4 py-2 rounded-lg text-sm font-medium bg-brand text-white' : 'px-4 py-2 rounded-lg text-sm font-medium border hover:bg-gray-50';
}

// Quick assign all unassigned appointments for a day
function quickAssignDay(dateStr) {
  const dayApts = appointments.filter(a => a.preferred_date === dateStr && !a.assigned_employee_id);
  const activeEmps = employees.filter(e => e.is_active);
  if(!activeEmps.length) { showToast('No active employees to assign', true); return; }
  dayApts.forEach((apt, i) => {
    const emp = activeEmps[i % activeEmps.length];
    updateApptAssignment(apt.id, emp.id);
  });
}

// Sub-tab switching for Messages
function switchMessagesSubTab(sub) {
  document.getElementById('msg-subtab-contacts').classList.toggle('hidden', sub !== 'contacts');
  document.getElementById('msg-subtab-emaillogs').classList.toggle('hidden', sub !== 'emaillogs');
  document.getElementById('msg-sub-contacts').className = sub === 'contacts' ? 'px-4 py-2 rounded-lg text-sm font-medium bg-brand text-white' : 'px-4 py-2 rounded-lg text-sm font-medium border hover:bg-gray-50';
  document.getElementById('msg-sub-emaillogs').className = sub === 'emaillogs' ? 'px-4 py-2 rounded-lg text-sm font-medium bg-brand text-white' : 'px-4 py-2 rounded-lg text-sm font-medium border hover:bg-gray-50';
  if(sub === 'emaillogs') loadEmailLogs();
}

// Sub-tab switching for Gallery
function switchGallerySubTab(sub) {
  document.getElementById('gal-subtab-gallery').classList.toggle('hidden', sub !== 'gallery');
  document.getElementById('gal-subtab-serviceimgs').classList.toggle('hidden', sub !== 'serviceimgs');
  document.getElementById('gal-sub-gallery').className = sub === 'gallery' ? 'px-4 py-2 rounded-lg text-sm font-medium bg-brand text-white' : 'px-4 py-2 rounded-lg text-sm font-medium border hover:bg-gray-50';
  document.getElementById('gal-sub-serviceimgs').className = sub === 'serviceimgs' ? 'px-4 py-2 rounded-lg text-sm font-medium bg-brand text-white' : 'px-4 py-2 rounded-lg text-sm font-medium border hover:bg-gray-50';
  document.getElementById('gallery-add-btn').classList.toggle('hidden', sub !== 'gallery');
  if(sub === 'serviceimgs') loadServiceImages();
}

// ===== ACCOUNT SETTINGS =====
function openAccountSettings() {
  if(currentUser) {
    document.getElementById('settings-name').value = currentUser.user_metadata?.full_name || '';
    document.getElementById('settings-email').value = currentUser.email || '';
  }
  document.getElementById('settings-password').value = '';
  document.getElementById('settings-password-confirm').value = '';
  // Load notification email setting
  sb.from('oretir_settings').select('setting_value').eq('setting_key', 'admin_email').maybeSingle().then(({ data }) => {
    document.getElementById('settings-notification-email').value = data?.setting_value || (currentUser ? currentUser.email : '');
  });
  document.getElementById('account-modal').classList.remove('hidden');
}

async function updateNotificationEmail() {
  const email = document.getElementById('settings-notification-email').value.trim();
  if(!email) { showToast('Email is required', true); return; }
  const { error } = await sb.from('oretir_settings').update({ setting_value: email }).eq('setting_key', 'admin_email');
  if(error) {
    // Try insert if row doesn't exist
    const { error: insertErr } = await sb.from('oretir_settings').insert({ setting_key: 'admin_email', setting_value: email });
    if(insertErr) { showToast('Error: ' + insertErr.message, true); return; }
  }
  showToast('Notification email updated to ' + email);
}

async function updateAccountName() {
  const name = document.getElementById('settings-name').value.trim();
  if(!name) { showToast('Name is required', true); return; }
  const { error } = await sb.auth.updateUser({ data: { full_name: name } });
  if(error) { showToast('Error: ' + error.message, true); return; }
  document.getElementById('admin-email').textContent = name;
  currentUser.user_metadata = { ...currentUser.user_metadata, full_name: name };
  showToast('Name updated successfully');
}

async function updateAccountEmail() {
  const email = document.getElementById('settings-email').value.trim();
  if(!email) { showToast('Email is required', true); return; }
  const { error } = await sb.auth.updateUser({ email });
  if(error) { showToast(adminT[currentLang].emailUpdateFailed, true); return; }
  showToast('Confirmation email sent to both old and new addresses');
}

async function updateAccountPassword() {
  const pw = document.getElementById('settings-password').value;
  const pwConfirm = document.getElementById('settings-password-confirm').value;
  if(!pw || pw.length < 6) { showToast('Password must be at least 6 characters', true); return; }
  if(pw !== pwConfirm) { showToast('Passwords do not match', true); return; }
  const { error } = await sb.auth.updateUser({ password: pw });
  if(error) { showToast(adminT[currentLang].passwordUpdateFailed, true); return; }
  document.getElementById('settings-password').value = '';
  document.getElementById('settings-password-confirm').value = '';
  showToast('Password updated successfully');
}

// Close modals on overlay click
document.querySelectorAll('.modal-overlay').forEach(m => m.addEventListener('click', (e) => { if(e.target===m) m.classList.add('hidden'); }));

// Close modals on Escape key
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    document.querySelectorAll('.modal-overlay:not(.hidden)').forEach(modal => {
      modal.classList.add('hidden');
    });
  }
});

// Apply default language translations on page load
applyAdminTranslations();
</script>
</body>
</html>
